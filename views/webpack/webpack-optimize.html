<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <!-- 为了可以访问第三方图床的图片，才添加了这句代码，如果你的图片是存在本地的，去掉这句代码即可 -->
    <meta id="referrer" name="referrer" content="never" />
    <!-- <meta id="referrer" name="referrer" content="always" /> -->
    <title>webpack 优化篇 | 全栈修炼</title>
    <meta name="description" content="GolderBrother的博客" />
    <link rel="icon" href="/blog/assets/favicon.ico">  <link rel="preload" href="/blog/assets/css/0.styles.2dde6c16.css" as="style"><link rel="preload" href="/blog/assets/js/app.74817549.js" as="script"><link rel="preload" href="/blog/assets/js/2.f761193d.js" as="script"><link rel="preload" href="/blog/assets/js/181.326c1f42.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.ea66aff3.js"><link rel="prefetch" href="/blog/assets/js/100.1650309e.js"><link rel="prefetch" href="/blog/assets/js/101.dd5cdc51.js"><link rel="prefetch" href="/blog/assets/js/102.81a755d8.js"><link rel="prefetch" href="/blog/assets/js/103.84d1e041.js"><link rel="prefetch" href="/blog/assets/js/104.6bb79eda.js"><link rel="prefetch" href="/blog/assets/js/105.ac0fa491.js"><link rel="prefetch" href="/blog/assets/js/106.e7f21162.js"><link rel="prefetch" href="/blog/assets/js/107.a932b9dd.js"><link rel="prefetch" href="/blog/assets/js/108.08337848.js"><link rel="prefetch" href="/blog/assets/js/109.0a8ac1ac.js"><link rel="prefetch" href="/blog/assets/js/11.2b17f742.js"><link rel="prefetch" href="/blog/assets/js/110.63f713ce.js"><link rel="prefetch" href="/blog/assets/js/111.3ded28af.js"><link rel="prefetch" href="/blog/assets/js/112.feb77183.js"><link rel="prefetch" href="/blog/assets/js/113.ca7a3dfe.js"><link rel="prefetch" href="/blog/assets/js/114.278aaabb.js"><link rel="prefetch" href="/blog/assets/js/115.3f930fa5.js"><link rel="prefetch" href="/blog/assets/js/116.0686a02f.js"><link rel="prefetch" href="/blog/assets/js/117.22090497.js"><link rel="prefetch" href="/blog/assets/js/118.d7f089fa.js"><link rel="prefetch" href="/blog/assets/js/119.3c8db627.js"><link rel="prefetch" href="/blog/assets/js/12.d4feb8d0.js"><link rel="prefetch" href="/blog/assets/js/120.e516c49a.js"><link rel="prefetch" href="/blog/assets/js/121.d702cc4d.js"><link rel="prefetch" href="/blog/assets/js/122.13d4f773.js"><link rel="prefetch" href="/blog/assets/js/123.6905c46b.js"><link rel="prefetch" href="/blog/assets/js/124.ccac9465.js"><link rel="prefetch" href="/blog/assets/js/125.3fad187d.js"><link rel="prefetch" href="/blog/assets/js/126.065c2aad.js"><link rel="prefetch" href="/blog/assets/js/127.d4aef2ae.js"><link rel="prefetch" href="/blog/assets/js/128.00766f11.js"><link rel="prefetch" href="/blog/assets/js/129.51d245ca.js"><link rel="prefetch" href="/blog/assets/js/13.21c8139a.js"><link rel="prefetch" href="/blog/assets/js/130.82b8009d.js"><link rel="prefetch" href="/blog/assets/js/131.fb8da159.js"><link rel="prefetch" href="/blog/assets/js/132.2484fde1.js"><link rel="prefetch" href="/blog/assets/js/133.177fe1b1.js"><link rel="prefetch" href="/blog/assets/js/134.5611fa2b.js"><link rel="prefetch" href="/blog/assets/js/135.4d1053c3.js"><link rel="prefetch" href="/blog/assets/js/136.2973975f.js"><link rel="prefetch" href="/blog/assets/js/137.7c44ba09.js"><link rel="prefetch" href="/blog/assets/js/138.16973a68.js"><link rel="prefetch" href="/blog/assets/js/139.2f797054.js"><link rel="prefetch" href="/blog/assets/js/14.8cf70ab3.js"><link rel="prefetch" href="/blog/assets/js/140.f94ba770.js"><link rel="prefetch" href="/blog/assets/js/141.69f9800f.js"><link rel="prefetch" href="/blog/assets/js/142.b567c447.js"><link rel="prefetch" href="/blog/assets/js/143.f1ee0ada.js"><link rel="prefetch" href="/blog/assets/js/144.138163b4.js"><link rel="prefetch" href="/blog/assets/js/145.e3bee357.js"><link rel="prefetch" href="/blog/assets/js/146.3a9fd8c7.js"><link rel="prefetch" href="/blog/assets/js/147.0b8e88a6.js"><link rel="prefetch" href="/blog/assets/js/148.81da2cf3.js"><link rel="prefetch" href="/blog/assets/js/149.d44d0121.js"><link rel="prefetch" href="/blog/assets/js/15.ea38d450.js"><link rel="prefetch" href="/blog/assets/js/150.7665d423.js"><link rel="prefetch" href="/blog/assets/js/151.1ab5f781.js"><link rel="prefetch" href="/blog/assets/js/152.620db4ac.js"><link rel="prefetch" href="/blog/assets/js/153.695d756f.js"><link rel="prefetch" href="/blog/assets/js/154.ee82e0a2.js"><link rel="prefetch" href="/blog/assets/js/155.d7bc8987.js"><link rel="prefetch" href="/blog/assets/js/156.95cf0d01.js"><link rel="prefetch" href="/blog/assets/js/157.76159f7e.js"><link rel="prefetch" href="/blog/assets/js/158.e27d7f12.js"><link rel="prefetch" href="/blog/assets/js/159.84d58dcb.js"><link rel="prefetch" href="/blog/assets/js/16.7794197c.js"><link rel="prefetch" href="/blog/assets/js/160.44f17ac0.js"><link rel="prefetch" href="/blog/assets/js/161.a9fc1420.js"><link rel="prefetch" href="/blog/assets/js/162.953ffb8f.js"><link rel="prefetch" href="/blog/assets/js/163.d4b64d04.js"><link rel="prefetch" href="/blog/assets/js/164.d718bdc2.js"><link rel="prefetch" href="/blog/assets/js/165.464562ce.js"><link rel="prefetch" href="/blog/assets/js/166.3486924a.js"><link rel="prefetch" href="/blog/assets/js/167.044ce06a.js"><link rel="prefetch" href="/blog/assets/js/168.81e22c48.js"><link rel="prefetch" href="/blog/assets/js/169.4c4a576c.js"><link rel="prefetch" href="/blog/assets/js/17.7083b50c.js"><link rel="prefetch" href="/blog/assets/js/170.4b71dfab.js"><link rel="prefetch" href="/blog/assets/js/171.d2051e87.js"><link rel="prefetch" href="/blog/assets/js/172.eeb81923.js"><link rel="prefetch" href="/blog/assets/js/173.aafb24fa.js"><link rel="prefetch" href="/blog/assets/js/174.2e261a79.js"><link rel="prefetch" href="/blog/assets/js/175.aafd75a2.js"><link rel="prefetch" href="/blog/assets/js/176.b7681070.js"><link rel="prefetch" href="/blog/assets/js/177.e9bdb5f5.js"><link rel="prefetch" href="/blog/assets/js/178.4a3ca305.js"><link rel="prefetch" href="/blog/assets/js/179.40201a86.js"><link rel="prefetch" href="/blog/assets/js/18.3dbb7741.js"><link rel="prefetch" href="/blog/assets/js/180.68c6346e.js"><link rel="prefetch" href="/blog/assets/js/182.92780c32.js"><link rel="prefetch" href="/blog/assets/js/183.65f40b5a.js"><link rel="prefetch" href="/blog/assets/js/19.78fd69da.js"><link rel="prefetch" href="/blog/assets/js/20.be39648e.js"><link rel="prefetch" href="/blog/assets/js/21.80a318b4.js"><link rel="prefetch" href="/blog/assets/js/22.4040efb3.js"><link rel="prefetch" href="/blog/assets/js/23.dbb39e0a.js"><link rel="prefetch" href="/blog/assets/js/24.f27f8467.js"><link rel="prefetch" href="/blog/assets/js/25.448302be.js"><link rel="prefetch" href="/blog/assets/js/26.78106ffa.js"><link rel="prefetch" href="/blog/assets/js/27.2a65554d.js"><link rel="prefetch" href="/blog/assets/js/28.55501022.js"><link rel="prefetch" href="/blog/assets/js/29.af733838.js"><link rel="prefetch" href="/blog/assets/js/3.df759ff3.js"><link rel="prefetch" href="/blog/assets/js/30.8ce1d72b.js"><link rel="prefetch" href="/blog/assets/js/31.7925ec43.js"><link rel="prefetch" href="/blog/assets/js/32.f9892d98.js"><link rel="prefetch" href="/blog/assets/js/33.afd7fd02.js"><link rel="prefetch" href="/blog/assets/js/34.ee49fe13.js"><link rel="prefetch" href="/blog/assets/js/35.0e4f5335.js"><link rel="prefetch" href="/blog/assets/js/36.96311e99.js"><link rel="prefetch" href="/blog/assets/js/37.fb3163b1.js"><link rel="prefetch" href="/blog/assets/js/38.778ed95b.js"><link rel="prefetch" href="/blog/assets/js/39.0531a2e1.js"><link rel="prefetch" href="/blog/assets/js/4.bb581d32.js"><link rel="prefetch" href="/blog/assets/js/40.ec9153c6.js"><link rel="prefetch" href="/blog/assets/js/41.2e9e71db.js"><link rel="prefetch" href="/blog/assets/js/42.af718b8a.js"><link rel="prefetch" href="/blog/assets/js/43.7a4efaa6.js"><link rel="prefetch" href="/blog/assets/js/44.21916db9.js"><link rel="prefetch" href="/blog/assets/js/45.c02e6427.js"><link rel="prefetch" href="/blog/assets/js/46.c95ab531.js"><link rel="prefetch" href="/blog/assets/js/47.d505fc9f.js"><link rel="prefetch" href="/blog/assets/js/48.9291572a.js"><link rel="prefetch" href="/blog/assets/js/49.79fd5fda.js"><link rel="prefetch" href="/blog/assets/js/5.cc289552.js"><link rel="prefetch" href="/blog/assets/js/50.40ff6888.js"><link rel="prefetch" href="/blog/assets/js/51.d16aa2b4.js"><link rel="prefetch" href="/blog/assets/js/52.4528f49d.js"><link rel="prefetch" href="/blog/assets/js/53.b16b42d4.js"><link rel="prefetch" href="/blog/assets/js/54.4fff7e01.js"><link rel="prefetch" href="/blog/assets/js/55.6832b1c5.js"><link rel="prefetch" href="/blog/assets/js/56.d16f1707.js"><link rel="prefetch" href="/blog/assets/js/57.de08e9ba.js"><link rel="prefetch" href="/blog/assets/js/58.6ca6f21b.js"><link rel="prefetch" href="/blog/assets/js/59.e518317a.js"><link rel="prefetch" href="/blog/assets/js/6.4efa9fa4.js"><link rel="prefetch" href="/blog/assets/js/60.935521f1.js"><link rel="prefetch" href="/blog/assets/js/61.ce9eda13.js"><link rel="prefetch" href="/blog/assets/js/62.e6c745bf.js"><link rel="prefetch" href="/blog/assets/js/63.647fd8d7.js"><link rel="prefetch" href="/blog/assets/js/64.4c9b4781.js"><link rel="prefetch" href="/blog/assets/js/65.80857907.js"><link rel="prefetch" href="/blog/assets/js/66.b89b796a.js"><link rel="prefetch" href="/blog/assets/js/67.b9798c32.js"><link rel="prefetch" href="/blog/assets/js/68.49b67f24.js"><link rel="prefetch" href="/blog/assets/js/69.665837ff.js"><link rel="prefetch" href="/blog/assets/js/7.b94332e9.js"><link rel="prefetch" href="/blog/assets/js/70.ce57ed8e.js"><link rel="prefetch" href="/blog/assets/js/71.71ae5067.js"><link rel="prefetch" href="/blog/assets/js/72.69c7c32d.js"><link rel="prefetch" href="/blog/assets/js/73.6b47b8f7.js"><link rel="prefetch" href="/blog/assets/js/74.bd6cd299.js"><link rel="prefetch" href="/blog/assets/js/75.297a83bc.js"><link rel="prefetch" href="/blog/assets/js/76.e49268ee.js"><link rel="prefetch" href="/blog/assets/js/77.6efa828f.js"><link rel="prefetch" href="/blog/assets/js/78.c38cb032.js"><link rel="prefetch" href="/blog/assets/js/79.478e1642.js"><link rel="prefetch" href="/blog/assets/js/8.80c6038b.js"><link rel="prefetch" href="/blog/assets/js/80.ff9e57e9.js"><link rel="prefetch" href="/blog/assets/js/81.e3dbf4d0.js"><link rel="prefetch" href="/blog/assets/js/82.270df640.js"><link rel="prefetch" href="/blog/assets/js/83.3bc7036f.js"><link rel="prefetch" href="/blog/assets/js/84.a3ccc99e.js"><link rel="prefetch" href="/blog/assets/js/85.7cdab723.js"><link rel="prefetch" href="/blog/assets/js/86.9f0c2ccd.js"><link rel="prefetch" href="/blog/assets/js/87.b7e93260.js"><link rel="prefetch" href="/blog/assets/js/88.557a99bb.js"><link rel="prefetch" href="/blog/assets/js/89.16a0d8d1.js"><link rel="prefetch" href="/blog/assets/js/9.4fbaf7a8.js"><link rel="prefetch" href="/blog/assets/js/90.52190781.js"><link rel="prefetch" href="/blog/assets/js/91.b9507740.js"><link rel="prefetch" href="/blog/assets/js/92.c0eb92c0.js"><link rel="prefetch" href="/blog/assets/js/93.ca3ba1d1.js"><link rel="prefetch" href="/blog/assets/js/94.a8ffcee7.js"><link rel="prefetch" href="/blog/assets/js/95.23fe688e.js"><link rel="prefetch" href="/blog/assets/js/96.b5d64bc6.js"><link rel="prefetch" href="/blog/assets/js/97.c41d4d64.js"><link rel="prefetch" href="/blog/assets/js/98.c415501d.js"><link rel="prefetch" href="/blog/assets/js/99.ab069b22.js"> <link rel="stylesheet" href="/blog/assets/css/0.styles.2dde6c16.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/assets/logo.jpg" alt="全栈修炼" class="logo"> <span class="site-name can-hide">全栈修炼</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/guide/" class="nav-link">主页</a></div><div class="nav-item"><a href="/blog/views/" class="nav-link router-link-active">大前端</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/views/webpack/webpack-optimize.html" class="nav-link router-link-exact-active router-link-active">zh-CN</a></li><li class="dropdown-item"><!----> <a href="/blog/en/" class="nav-link">en-US</a></li></ul></div></div> <a href="https://github.com/GolderBrother/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/guide/" class="nav-link">主页</a></div><div class="nav-item"><a href="/blog/views/" class="nav-link router-link-active">大前端</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/views/webpack/webpack-optimize.html" class="nav-link router-link-exact-active router-link-active">zh-CN</a></li><li class="dropdown-item"><!----> <a href="/blog/en/" class="nav-link">en-US</a></li></ul></div></div> <a href="https://github.com/GolderBrother/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/blog/views/" class="sidebar-link">大前端知识大集合</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>GitHub 软技能</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/github/follow.html" class="sidebar-link">GitHub 挖宝技巧</a></li><li><a href="/blog/views/github/star.html" class="sidebar-link">GitHub 吸星大法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>浏览器工作原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/browser/input-url-course.html" class="sidebar-link">导航流程：从输入 URL 到页面展示，这中间发生了什么</a></li><li><a href="/blog/views/browser/dom-bind-event.html" class="sidebar-link">一个DOM元素绑定多个事件时，先执行冒泡还是捕获</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>css</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/css/css-skills1.html" class="sidebar-link">10 个让你受益匪浅的 css 使用技巧</a></li><li><a href="/blog/views/css/css-knowledge.html" class="sidebar-link">你未必知道的 49 个 CSS 知识点</a></li><li><a href="/blog/views/css/css-knowledge2.html" class="sidebar-link">你未必知道的 49 个 CSS 知识点二~</a></li><li><a href="/blog/views/css/css-center.html" class="sidebar-link">一起搞懂 CSS 水平居中与垂直居中的 16 个方法</a></li><li><a href="/blog/views/css/css-flex.html" class="sidebar-link">弹性盒子中 flex: 0 1 auto 表示什么意思</a></li><li><a href="/blog/views/css/css-BFC.html" class="sidebar-link">CSS 中的 BFC 详解</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>移动端h5</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/h5/h5-demo1.html" class="sidebar-link">移动端 H5 和 Hybrid 相关基础技术概览</a></li><li><a href="/blog/views/mobile/mobile-skill.html" class="sidebar-link">总结移动端 H5 开发常用技巧</a></li><li><a href="/blog/views/mobile/mobile-optmization.html" class="sidebar-link">关于移动端体验优化经验总结</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Javascript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/javascript/js-skills.html" class="sidebar-link">你可能不知道的 JS 开发技巧</a></li><li><a href="/blog/views/javascript/js-skills2.html" class="sidebar-link">一个合格的中级前端er需要掌握的 28 个 JavaScript 技巧</a></li><li><a href="/blog/views/javascript/js-utils.html" class="sidebar-link">书到用时方恨少，一大波 JS 开发工具函数来了</a></li><li><a href="/blog/views/javascript/js-utils2.html" class="sidebar-link">前端常用的 60 余种工具方法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Typescript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/typescript/ts-demo.html" class="sidebar-link">TypeScript 高级用法详解</a></li><li><a href="/blog/views/typescript/ts-difficult.html" class="sidebar-link">TypeScript 重难点梳理</a></li><li><a href="/blog/views/typescript/ts-problem.html" class="sidebar-link">TS 常见问题整理（60 多个）</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue.js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/vue/vue-ts.html" class="sidebar-link">Vue + TS + El 搭建博客及踩坑记</a></li><li><a href="/blog/views/vue/vue-lazyload.html" class="sidebar-link">vue 路由懒加载及组件懒加载</a></li><li><a href="/blog/views/vue/vue-skills-36.html" class="sidebar-link">Vue 开发必须知道的 36 个技巧</a></li><li><a href="/blog/views/vue/vue-interview.html" class="sidebar-link">30 道 Vue 面试题，内含详细讲解（涵盖入门到精通，自测 Vue 掌握程度）</a></li><li><a href="/blog/views/vue/vue-interview/part-one/note.html" class="sidebar-link">Vue 面试题汇总</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React.js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/react/react-hooks.html" class="sidebar-link">React Hooks 相关 API 总结</a></li><li><a href="/blog/views/react/react-lifecycle.html" class="sidebar-link">React v16.0 前的生命周期</a></li><li><a href="/blog/views/react/react-skill.html" class="sidebar-link">5 个技巧助你编写更好的 React 代码</a></li><li><a href="/blog/views/react/react-nice-library.html" class="sidebar-link">5 个很棒的 React.js 库，值得你亲手试试！</a></li><li><a href="/blog/views/react/react-interview.html" class="sidebar-link">35 道咱们必须要清楚的 React 面试题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React-Native</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/react-native/RN&amp;Native-message.html" class="sidebar-link">React Native 跟原生之间的通信</a></li><li><a href="/blog/views/react-native/ReactNative&amp;Flutter&amp;uni-app.html" class="sidebar-link">一、技术学习成本和难度</a></li><li><a href="/blog/views/react-native/ReactNative&amp;Flutter&amp;uni-app.html" class="sidebar-link">一、技术学习成本和难度</a></li><li><a href="/blog/views/react-native/codepush-config.html" class="sidebar-link">RN 配置热更新+使用文档</a></li><li><a href="/blog/views/react-native/codepush-deploy.html" class="sidebar-link">React Native + 热更新(Code Push) 部署文档</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/webpack/webpack1.html" class="sidebar-link">一大波 Webpack 面试题来啦~</a></li><li><a href="/blog/views/webpack/webpack-optimize.html" class="active sidebar-link">webpack 优化篇</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/views/webpack/webpack-optimize.html#_1-项目初始化" class="sidebar-link">1.项目初始化</a></li><li class="sidebar-sub-header"><a href="/blog/views/webpack/webpack-optimize.html#_2-数据分析" class="sidebar-link">2.数据分析</a></li><li class="sidebar-sub-header"><a href="/blog/views/webpack/webpack-optimize.html#_3-编译时间优化" class="sidebar-link">3.编译时间优化</a></li><li class="sidebar-sub-header"><a href="/blog/views/webpack/webpack-optimize.html#_4-编译体积优化" class="sidebar-link">4.编译体积优化</a></li><li class="sidebar-sub-header"><a href="/blog/views/webpack/webpack-optimize.html#_5-运行速度优化" class="sidebar-link">5.运行速度优化</a></li><li class="sidebar-sub-header"><a href="/blog/views/webpack/webpack-optimize.html#_6-附录" class="sidebar-link">6.附录</a></li><li class="sidebar-sub-header"><a href="/blog/views/webpack/webpack-optimize.html#最后" class="sidebar-link">最后</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端跨域相关</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/cors/corssOrigin-pro.html" class="sidebar-link">10 种跨域解决方案（附终极方案）</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>vite</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/vite/vite-study.html" class="sidebar-link">vite原理剖析</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>cli</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/cli/james-cli.html" class="sidebar-link">手撸一个自己的前端脚手架</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Node.js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/node/node1.html" class="sidebar-link">/views/node/node1.html</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端设计模式之美</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/fe-design/fe-design-9.html" class="sidebar-link">前端应知应会的 9 种设计模式(详细篇)</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端数据结构之美</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/data-structure/data-structure.html" class="sidebar-link">前端数据结构之美</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端算法学习指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/algorithms/sort.html" class="sidebar-link">十大经典算法</a></li><li><a href="/blog/views/algorithms/interview.html" class="sidebar-link">面试必刷-《剑指 offer》刷题小结</a></li><li><a href="/blog/views/algorithms/string.html" class="sidebar-link">字符串相关算法</a></li><li><a href="/blog/views/algorithms/array.html" class="sidebar-link">数组串相关算法</a></li><li><a href="/blog/views/algorithms/linklist.html" class="sidebar-link">链表相关算法题</a></li><li><a href="/blog/views/algorithms/tree.html" class="sidebar-link">二叉树相关算法</a></li><li><a href="/blog/views/algorithms/tencent/array&amp;string.html" class="sidebar-link">腾讯算法题-数组与字符串</a></li><li><a href="/blog/views/algorithms/tencent/number.html" class="sidebar-link">腾讯算法题-数学与数字</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端面试集锦</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/fe-interview/alibaba.html" class="sidebar-link">阿里面试题</a></li><li><a href="/blog/views/fe-interview/bytedance.html" class="sidebar-link">字节跳动面试题</a></li><li><a href="/blog/views/fe-interview/bytedance-algorithms.html" class="sidebar-link">字节跳动算法题</a></li><li><a href="/blog/views/fe-interview/tencent.html" class="sidebar-link">微信面试题</a></li><li><a href="/blog/views/fe-interview/classic-layout.html" class="sidebar-link">掌握两大经典布局方案</a></li><li><a href="/blog/views/fe-interview/web-safe.html" class="sidebar-link">谈谈 web 安全问题及解决方案</a></li><li><a href="/blog/views/fe-interview/http&amp;https.html" class="sidebar-link">http2/http3 协议有什么优劣</a></li><li><a href="/blog/views/fe-interview/webpack-performance-optimization.html" class="sidebar-link">Webpack 性能优化你知道哪些</a></li><li><a href="/blog/views/fe-interview/webpack-principle.html" class="sidebar-link">说说 webpack 打包的原理</a></li><li><a href="/blog/views/fe-interview/webpack-HMR.html" class="sidebar-link">HMR 的原理是什么</a></li><li><a href="/blog/views/fe-interview/chrome-start-process.html" class="sidebar-link">Chrome 打开一个页面需要启动多少进程？分别有哪些进程</a></li><li><a href="/blog/views/fe-interview/dns-prefetch.html" class="sidebar-link">谈谈你对 dns-prefetch 的理解</a></li><li><a href="/blog/views/fe-interview/browser-cache.html" class="sidebar-link">浏览器缓存一探究竟~</a></li><li><a href="/blog/views/fe-interview/send-content-to-browser.html" class="sidebar-link">如何保证页面文件能被完整送达浏览器</a></li><li><a href="/blog/views/fe-interview/browser-render.html" class="sidebar-link">浏览器渲染过程是怎样的</a></li><li><a href="/blog/views/fe-interview/browser-reflow&amp;repain.html" class="sidebar-link">如何理解回流和重绘</a></li><li><a href="/blog/views/fe-interview/renderEngine-createNewLayer.html" class="sidebar-link">渲染引擎什么情况下才会为特定的节点创建新的图层</a></li><li><a href="/blog/views/fe-interview/UDP&amp;TCP-different.html" class="sidebar-link">UDP 和 TCP 有什么区别</a></li><li><a href="/blog/views/fe-interview/js-modules.html" class="sidebar-link">说说 js 的模块化</a></li><li><a href="/blog/views/fe-interview/lazyMan.html" class="sidebar-link">实现一个 LazyMan，可以按照以下方式调用</a></li><li><a href="/blog/views/fe-interview/handwriting-promise.html" class="sidebar-link">少年，来，手写一个 Promise 吧</a></li><li><a href="/blog/views/fe-interview/fetch&amp;ajax-diference.html" class="sidebar-link">请说下 fetch 和 ajax 的区别吧</a></li><li><a href="/blog/views/fe-interview/browser-input-url.html" class="sidebar-link">细说浏览器输入 URL 后发生了什么</a></li><li><a href="/blog/views/fe-interview/picture-optimization.html" class="sidebar-link">前端的图片优化方案你知道多少</a></li><li><a href="/blog/views/fe-interview/node-eventLoop.html" class="sidebar-link">来，说说 node 的事件循环机制吧</a></li><li><a href="/blog/views/fe-interview/browser-eventLoop.html" class="sidebar-link">小伙子，谈谈浏览器端的事件循环吧</a></li><li><a href="/blog/views/fe-interview/setTimeout&amp;setImmediate.html" class="sidebar-link">node中的setTimeout 和 setImmediate有什么区别</a></li><li><a href="/blog/views/fe-interview/js-interview.html" class="sidebar-link">收集一些 javascript 相关的面试题</a></li><li><a href="/blog/views/fe-interview/fuck-interview.html" class="sidebar-link">那些恶心的面试题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端必知必会的网络基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/network/http-interview.html" class="sidebar-link">HTTP 灵魂之问，巩固你的 HTTP 知识体系</a></li><li><a href="/blog/views/network/tcp-interview.html" class="sidebar-link">TCP 协议灵魂之问，巩固你的网络底层基础</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端应知应会的Nginx知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/nginx/nginx-details.html" class="sidebar-link">Nginx 从入门到实践，万字详解！</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端必不可少的git知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/git/git-command-animation.html" class="sidebar-link">相见恨晚的 Git 命令动画演示，一看就懂！</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端性能优化专题，让你的网站飞起来吧</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/performance/code-split.html" class="sidebar-link">项目不知道如何做性能优化？不妨试试代码分割吧</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端高手进阶专题，告别小菜鸟</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/fe-advanced/ad1.html" class="sidebar-link">你真的熟悉 HTML 标签吗？</a></li><li><a href="/blog/views/fe-advanced/ad2.html" class="sidebar-link">如何高效操作 DOM 元素？</a></li><li><a href="/blog/views/fe-advanced/ad3.html" class="sidebar-link">3 个使用场景助你用好 DOM 事件</a></li><li><a href="/blog/views/fe-advanced/ad6.html" class="sidebar-link">浏览器如何渲染页面？</a></li><li><a href="/blog/views/fe-advanced/ad7.html" class="sidebar-link">关于 JavaScript 的数据类型，你知多少</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack-优化篇"><a href="#webpack-优化篇" class="header-anchor">#</a> webpack 优化篇</h1> <h2 id="_1-项目初始化"><a href="#_1-项目初始化" class="header-anchor">#</a> 1.项目初始化</h2> <h3 id="_1-1-安装"><a href="#_1-1-安装" class="header-anchor">#</a> 1.1 安装</h3> <div class="language-js extra-class"><pre class="language-js"><code>cnpm i webpack webpack<span class="token operator">-</span>cli html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server cross<span class="token operator">-</span>env <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h3 id="_1-2-webpack-config-js"><a href="#_1-2-webpack-config-js" class="header-anchor">#</a> 1.2 webpack.config.js</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
  devtool<span class="token operator">:</span> <span class="token string">&quot;source-map&quot;</span><span class="token punctuation">,</span>
  context<span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    main<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;main.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_1-3-package-json"><a href="#_1-3-package-json" class="header-anchor">#</a> 1.3 package.json</h3> <div class="language-json extra-class"><pre class="language-json"><code>  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack serve&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="_2-数据分析"><a href="#_2-数据分析" class="header-anchor">#</a> 2.数据分析</h2> <h3 id="_2-1-日志美化"><a href="#_2-1-日志美化" class="header-anchor">#</a> 2.1 日志美化</h3> <ul><li><a href="https://www.npmjs.com/package/friendly-errors-webpack-plugin" target="_blank" rel="noopener noreferrer">friendly-errors-webpack-plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可以识别某些类别的 webpack 错误，并清理，聚合和优先级，以提供更好的开发人员体验</li></ul> <h4 id="_2-1-1-安装"><a href="#_2-1-1-安装" class="header-anchor">#</a> 2.1.1 安装</h4> <div class="language-js extra-class"><pre class="language-js"><code>cnpm i friendly<span class="token operator">-</span>errors<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin  node<span class="token operator">-</span>notifier <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h4 id="_2-1-2-webpack-config-js"><a href="#_2-1-2-webpack-config-js" class="header-anchor">#</a> 2.1.2 webpack.config.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> FriendlyErrorsWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;friendly-errors-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> notifier <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;node-notifier&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">ICON</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;icon.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
  devtool<span class="token operator">:</span> <span class="token string">&quot;source-map&quot;</span><span class="token punctuation">,</span>
  context<span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    main<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;main.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">FriendlyErrorsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function-variable function">onErrors</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">severity<span class="token punctuation">,</span> errors</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> error <span class="token operator">=</span> errors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        notifier<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          title<span class="token operator">:</span> <span class="token string">&quot;Webpack编译失败&quot;</span><span class="token punctuation">,</span>
          message<span class="token operator">:</span> severity <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span> error<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
          subtitle<span class="token operator">:</span> error<span class="token punctuation">.</span>file <span class="token operator">||</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
          icon<span class="token operator">:</span> <span class="token constant">ICON</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-2-速度分析"><a href="#_2-2-速度分析" class="header-anchor">#</a> 2.2 速度分析</h3> <ul><li><a href="https://www.npmjs.com/package/speed-measure-webpack5-plugin" target="_blank" rel="noopener noreferrer">speed-measure-webpack5-plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可以分析打包速度</li></ul> <h4 id="_2-2-1-安装"><a href="#_2-2-1-安装" class="header-anchor">#</a> 2.2.1 安装</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>cnpm i speed-measure-webpack5-plugin -D
</code></pre></div><h4 id="_2-2-2-webpack-config-js"><a href="#_2-2-2-webpack-config-js" class="header-anchor">#</a> 2.2.2 webpack.config.js</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> SpeedMeasureWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'speed-measure-webpack5-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> smw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeedMeasureWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> smw<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
  devtool<span class="token operator">:</span> <span class="token string">'source-map'</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-3-文件体积监控"><a href="#_2-3-文件体积监控" class="header-anchor">#</a> 2.3 文件体积监控</h3> <ul><li><a href="https://www.npmjs.com/package/webpack-bundle-analyzer" target="_blank" rel="noopener noreferrer">webpack-bundle-analyzer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是一个 webpack 的插件，需要配合 webpack 和 webpack-cli 一起使用。这个插件的功能是生成代码分析报告，帮助提升代码质量和网站性能</li> <li>它可以直观分析打包出的文件包含哪些，大小占比如何，模块包含关系，依赖项，文件是否重复，压缩后大小如何，针对这些，我们可以进行文件分割等操作。</li></ul> <h4 id="_2-3-1-安装"><a href="#_2-3-1-安装" class="header-anchor">#</a> 2.3.1 安装</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>cnpm i webpack-bundle-analyzer -D
</code></pre></div><h4 id="_2-3-2-编译启动"><a href="#_2-3-2-编译启动" class="header-anchor">#</a> 2.3.2 编译启动</h4> <h5 id="_2-3-2-1-webpack-config-js"><a href="#_2-3-2-1-webpack-config-js" class="header-anchor">#</a> 2.3.2.1 webpack.config.js</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> BundleAnalyzerPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-bundle-analyzer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_2-3-2-2-package-json"><a href="#_2-3-2-2-package-json" class="header-anchor">#</a> 2.3.2.2 package.json</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack serve&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;dev&quot;</span><span class="token operator">:</span><span class="token string">&quot;webpack  --progress&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="_2-3-3-单独启动"><a href="#_2-3-3-单独启动" class="header-anchor">#</a> 2.3.3 单独启动</h4> <h5 id="_2-3-3-1-webpack-config-js"><a href="#_2-3-3-1-webpack-config-js" class="header-anchor">#</a> 2.3.3.1 webpack.config.js</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> BundleAnalyzerPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-bundle-analyzer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      analyzerMode<span class="token operator">:</span> <span class="token string">&quot;disabled&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 不启动展示打包报告的http服务器</span>
      generateStatsFile<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否生成stats.json文件</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_2-3-3-2-package-json"><a href="#_2-3-3-2-package-json" class="header-anchor">#</a> 2.3.3.2 package.json</h5> <div class="language-json extra-class"><pre class="language-json"><code>  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack serve&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span><span class="token string">&quot;webpack  --progress&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-bundle-analyzer --port 8888 ./dist/stats.json&quot;</span>
  <span class="token punctuation">}</span>
</code></pre></div><h2 id="_3-编译时间优化"><a href="#_3-编译时间优化" class="header-anchor">#</a> 3.编译时间优化</h2> <ul><li>减少要处理的文件</li> <li>缩小查找的范围</li></ul> <h3 id="_3-1-缩小查找范围"><a href="#_3-1-缩小查找范围" class="header-anchor">#</a> 3.1 缩小查找范围</h3> <h4 id="_3-1-1-extensions"><a href="#_3-1-1-extensions" class="header-anchor">#</a> 3.1.1 extensions</h4> <ul><li>指定<code>extensions</code>之后可以不用在<code>require</code>或是<code>import</code>的时候加文件扩展名</li> <li>查找的时候会依次尝试添加扩展名进行匹配</li></ul> <div class="language-json extra-class"><pre class="language-json"><code>  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;.js&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;.jsx&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;.json&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span><span class="token punctuation">{</span>
</code></pre></div><h4 id="_3-1-2-alias"><a href="#_3-1-2-alias" class="header-anchor">#</a> 3.1.2 alias</h4> <ul><li>配置别名可以加快 webpack 查找模块的速度</li> <li>每当引入 bootstrap 模块的时候，它会直接引入<code>bootstrap</code>,而不需要从<code>node_modules</code>文件夹中按模块的查找规则查找</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>cnpm i bootstrap css<span class="token operator">-</span>loader style<span class="token operator">-</span>loader <span class="token operator">-</span><span class="token constant">S</span>
<span class="token keyword">const</span> bootstrap <span class="token operator">=</span>  path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'node_modules/bootstrap/dist/css/bootstrap.css'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> smw<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
  devtool<span class="token operator">:</span> <span class="token string">'source-map'</span><span class="token punctuation">,</span>
  context<span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    main<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;main.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;.js&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;.jsx&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;.json&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    alias<span class="token operator">:</span><span class="token punctuation">{</span>bootstrap<span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span><span class="token punctuation">{</span>
    rules<span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
              use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-1-3-modules"><a href="#_3-1-3-modules" class="header-anchor">#</a> 3.1.3 modules</h4> <ul><li>对于直接声明依赖名的模块 webpack 会使用类似<code>Node.js</code>一样进行路径搜索，搜索<code>node_modules</code>目录</li> <li>如果可以确定项目内所有的第三方依赖模块都是在<strong>项目根目录</strong>下的<code>node_modules</code>中的话可以直接指定</li> <li>默认配置</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;.js&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;.jsx&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;.json&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    alias<span class="token operator">:</span><span class="token punctuation">{</span>bootstrap<span class="token punctuation">}</span><span class="token punctuation">,</span>
    modules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'node_modules'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><ul><li>直接指定</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    modules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'C:/node_modules'</span><span class="token punctuation">,</span><span class="token string">'node_modules'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-1-4-mainfields"><a href="#_3-1-4-mainfields" class="header-anchor">#</a> 3.1.4 mainFields</h4> <ul><li>默认情况下<code>package.json</code> 文件则按照文件中 <code>main</code> 字段的文件名来查找文件</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token comment">// 配置 target === &quot;web&quot; 或者 target === &quot;webworker&quot; 时 mainFields 默认值是：</span>
  mainFields<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'browser'</span><span class="token punctuation">,</span> <span class="token string">'module'</span><span class="token punctuation">,</span> <span class="token string">'main'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// target 的值为其他时，mainFields 默认值为：</span>
  mainFields<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;main&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-1-5-mainfiles"><a href="#_3-1-5-mainfiles" class="header-anchor">#</a> 3.1.5 mainFiles</h4> <ul><li>当目录下没有 <code>package.json</code> 文件时，我们说会默认使用目录下的 <code>index.js</code>这个文件</li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code>resolve: {
<span class="token unchanged">  mainFiles: ['index']
</span>},
</code></pre></div><h4 id="_3-1-6-oneof"><a href="#_3-1-6-oneof" class="header-anchor">#</a> 3.1.6 oneOf</h4> <ul><li>每个文件对于 rules 中的所有规则都会遍历一遍，如果使用 oneOf 就可以解决该问题，只要能匹配一个即可退出</li> <li>在 oneOf 中不能两个配置处理同一种类型文件</li></ul> <p>webpack.config.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>rules<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    oneOf<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
        include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">&quot;thread-loader&quot;</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              workers<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              cacheDirectory<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;cache-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;logger-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-1-7-external"><a href="#_3-1-7-external" class="header-anchor">#</a> 3.1.7 external</h4> <ul><li>如果我们想引用一个库，但是又不想让 webpack 打包，并且又不影响我们在程序中以 CMD、AMD 或者 window/global 全局等方式进行使用，那就可以通过配置<code>externals</code></li></ul> <h5 id="_3-1-7-1-安装"><a href="#_3-1-7-1-安装" class="header-anchor">#</a> 3.1.7.1 安装</h5> <div class="language-bash extra-class"><pre class="language-bash"><code>cnpm i jquery html-webpack-externals-plugin -D
</code></pre></div><h5 id="_3-1-7-2-使用-jquery"><a href="#_3-1-7-2-使用-jquery" class="header-anchor">#</a> 3.1.7.2 使用 jquery</h5> <p>src/index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> jQuery <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;jquery&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> jQuery <span class="token keyword">from</span> <span class="token string">&quot;jquery&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_3-1-7-3-index-html"><a href="#_3-1-7-3-index-html" class="header-anchor">#</a> 3.1.7.3 index.html</h5> <p>src/index.html</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcss.com/jquery/3.4.1/jquery.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h5 id="_3-1-7-4-webpack-config-js"><a href="#_3-1-7-4-webpack-config-js" class="header-anchor">#</a> 3.1.7.4 webpack.config.js</h5> <p>webpack.config.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> externals<span class="token operator">:</span> <span class="token punctuation">{</span>
   jquery<span class="token operator">:</span> <span class="token string">'jQuery'</span><span class="token punctuation">,</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 module<span class="token operator">:</span> <span class="token punctuation">{</span>
</code></pre></div><h4 id="_3-1-8-resolveloader"><a href="#_3-1-8-resolveloader" class="header-anchor">#</a> 3.1.8 resolveLoader</h4> <p><code>resolve.resolveLoader</code>用于配置解析 loader 时的 resolve 配置,默认的配置</p> <h6 id="_3-1-8-1-logger-loader-js"><a href="#_3-1-8-1-logger-loader-js" class="header-anchor">#</a> 3.1.8.1 logger-loader.js</h6> <p>loaders\logger-loader.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;logger-loader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> source<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader<span class="token punctuation">;</span>
</code></pre></div><h5 id="_3-1-8-2-webpack-config-js"><a href="#_3-1-8-2-webpack-config-js" class="header-anchor">#</a> 3.1.8.2 webpack.config.js</h5> <p>webpack.config.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.jsx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.json&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span> bootstrap <span class="token punctuation">}</span><span class="token punctuation">,</span>
    modules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  resolveLoader<span class="token operator">:</span> <span class="token punctuation">{</span>
    modules<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;loaders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;logger-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-2-noparse"><a href="#_3-2-noparse" class="header-anchor">#</a> 3.2 noParse</h3> <ul><li><code>module.noParse</code> 字段，可以用于配置哪些模块文件的内容<strong>不需要进行解析</strong></li> <li>不需要解析依赖（即无依赖） 的第三方大型类库等，可以通过这个字段来配置，以提高整体的构建速度</li> <li>使用 <code>noParse</code> 进行忽略的模块文件中不能使用 <code>import</code>、<code>require</code> 等语法</li></ul> <h4 id="_3-2-1-src-index-js"><a href="#_3-2-1-src-index-js" class="header-anchor">#</a> 3.2.1 src\index.js</h4> <p>src\index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> title <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-2-2-src-title-js"><a href="#_3-2-2-src-title-js" class="header-anchor">#</a> 3.2.2 src\title.js</h4> <p>src\title.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-2-3-src-name-js"><a href="#_3-2-3-src-name-js" class="header-anchor">#</a> 3.2.3 src\name.js</h4> <p>src\name.js</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token string">&quot;james&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-2-4-webpack-config-js"><a href="#_3-2-4-webpack-config-js" class="header-anchor">#</a> 3.2.4 webpack.config.js</h4> <div class="language-diff extra-class"><pre class="language-diff"><code>module.exports = {
<span class="token unchanged">  module: {
       noParse: /title.js/, // 正则表达式
  }
</span>}
</code></pre></div><h3 id="_3-3-ignoreplugin"><a href="#_3-3-ignoreplugin" class="header-anchor">#</a> 3.3 IgnorePlugin</h3> <ul><li><a href="https://webpack.js.org/plugins/ignore-plugin/" target="_blank" rel="noopener noreferrer">ignore-plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>用于<strong>忽略某些特定的模块</strong>，让 webpack 不把这些指定的模块打包进去</li> <li>requestRegExp 匹配(test)资源请求路径的正则表达式。</li> <li>contextRegExp （可选）匹配(test)资源上下文（目录）的正则表达式。</li> <li>moment 会将所有本地化内容和核心功能一起打包,你可使用 <code>IgnorePlugin</code> 在打包时忽略本地化内容</li></ul> <h4 id="_3-3-1-安装"><a href="#_3-3-1-安装" class="header-anchor">#</a> 3.3.1 安装</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>cnpm i moment -S
</code></pre></div><h4 id="_3-3-2-src-index-js"><a href="#_3-3-2-src-index-js" class="header-anchor">#</a> 3.3.2 src\index.js</h4> <p>src\index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> moment <span class="token keyword">from</span> <span class="token string">&quot;moment&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>moment<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-3-3-webpack-config-js"><a href="#_3-3-3-webpack-config-js" class="header-anchor">#</a> 3.3.3 webpack.config.js</h4> <p>webpack.config.js</p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"> plugins:[
    new webpack.IgnorePlugin({
      resourceRegExp: /^\.\/locale$/,
      contextRegExp: /moment$/
    })
 ]
</span></code></pre></div><h3 id="_3-4-thread-loader-多进程"><a href="#_3-4-thread-loader-多进程" class="header-anchor">#</a> 3.4 thread-loader(多进程)</h3> <ul><li>把<a href="https://webpack.js.org/loaders/thread-loader/" target="_blank" rel="noopener noreferrer">thread-loader<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>放置在其他 loader 之前， 放置在这个 loader 之后的 loader 就会在一个单独的 worker 池(worker pool)中运行</li> <li>include 表示哪些目录中的 <code>.js</code> 文件<strong>需要进行</strong> <code>babel-loader</code></li> <li>exclude 表示哪些目录中的 <code>.js</code> 文件<strong>不要进行</strong> <code>babel-loader</code></li> <li><code>exclude</code> 的优先级高于 <code>include</code>,尽量避免 <code>exclude</code>，更倾向于使用 <code>include</code></li></ul> <h4 id="_3-4-1-安装"><a href="#_3-4-1-安装" class="header-anchor">#</a> 3.4.1 安装</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>cnpm  i thread-loader babel-loader @babel/core @babel/preset-env -D
</code></pre></div><h4 id="_3-4-2-webpack-config-js"><a href="#_3-4-2-webpack-config-js" class="header-anchor">#</a> 3.4.2 webpack.config.js</h4> <p>webpack.config.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>rules<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
    include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span>
    use<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> <span class="token string">'thread-loader'</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>workers<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'babel-loader'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'logger-loader'</span><span class="token punctuation">,</span> <span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="_3-5-利用缓存"><a href="#_3-5-利用缓存" class="header-anchor">#</a> 3.5 利用缓存</h3> <ul><li>利用缓存可以提升重复构建的速度</li></ul> <h4 id="_3-5-1-babel-loader"><a href="#_3-5-1-babel-loader" class="header-anchor">#</a> 3.5.1 babel-loader</h4> <ul><li>Babel 在转义 js 文件过程中消耗性能较高，将<a href="https://www.npmjs.com/package/babel-loader" target="_blank" rel="noopener noreferrer">babel-loader<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>执行的结果缓存起来，当重新打包构建时会尝试读取缓存，从而<strong>提高打包构建速度、降低消耗</strong></li> <li>默认存放位置是<code>node_modules/.cache/babel-loader</code></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
use<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> <span class="token string">'thread-loader'</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
          workers<span class="token operator">:</span> <span class="token number">3</span>
      <span class="token punctuation">}</span><span class="token constant">P</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
          cacheDirectory<span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="_3-5-2-cache-loader"><a href="#_3-5-2-cache-loader" class="header-anchor">#</a> 3.5.2 cache-loader</h4> <ul><li>在一些性能开销较大的<a href="https://www.npmjs.com/package/cache-loader" target="_blank" rel="noopener noreferrer">cache-loader<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>之前添加此 <code>loader</code>,可以以将结果缓存中磁盘中</li> <li>默认保存在 <code>node_modules/.cache/cache-loader</code> 目录下</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>cnpm i  cache-loader -D
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
use<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'cache-loader'</span><span class="token punctuation">,</span>
    <span class="token string">'logger-loader'</span><span class="token punctuation">,</span>
    <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
    <span class="token string">'css-loader'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-5-3-hard-source-webpack-plugin"><a href="#_3-5-3-hard-source-webpack-plugin" class="header-anchor">#</a> 3.5.3 hard-source-webpack-plugin</h4> <ul><li><code>HardSourceWebpackPlugin</code>为<code>模块</code>提供了中间缓存,缓存默认的存放路径是 <code>node_modules/.cache/hard-source</code></li> <li>配置<code>hard-source-webpack-plugin</code>后，首次构建时间并不会有太大的变化，但是从第二次开始，构建时间大约可以减少<code>80%</code>左右</li> <li><a href="https://github.com/webpack/webpack/issues/6527" target="_blank" rel="noopener noreferrer">webpack5<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中已经内置了模块缓存,不需要再使用此插件</li></ul> <h5 id="_3-5-3-1-安装"><a href="#_3-5-3-1-安装" class="header-anchor">#</a> 3.5.3.1 安装</h5> <div class="language-bash extra-class"><pre class="language-bash"><code>cnpm i  hard-source-webpack-plugin -D
</code></pre></div><h5 id="_3-5-3-2-webpack-config-js"><a href="#_3-5-3-2-webpack-config-js" class="header-anchor">#</a> 3.5.3.2 webpack.config.js</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span>  HardSourceWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'hard-source-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HardSourceWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_4-编译体积优化"><a href="#_4-编译体积优化" class="header-anchor">#</a> 4.编译体积优化</h2> <h3 id="_4-1-压缩-js、css、html-和图片"><a href="#_4-1-压缩-js、css、html-和图片" class="header-anchor">#</a> 4.1 压缩 JS、CSS、HTML 和图片</h3> <ul><li><a href="https://www.npmjs.com/package/optimize-css-assets-webpack-plugin" target="_blank" rel="noopener noreferrer">optimize-css-assets-webpack-plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是一个优化和压缩 CSS 资源的插件</li> <li><a href="https://www.npmjs.com/package/terser-webpack-plugin" target="_blank" rel="noopener noreferrer">terser-webpack-plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是一个优化和压缩 JS 资源的插件</li> <li><a href="https://www.npmjs.com/package/image-webpack-loader" target="_blank" rel="noopener noreferrer">image-webpack-loader<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可以帮助我们对图片进行压缩和优化</li></ul> <h4 id="_4-1-1-安装"><a href="#_4-1-1-安装" class="header-anchor">#</a> 4.1.1 安装</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>cnpm i terser<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin optimize<span class="token operator">-</span>css<span class="token operator">-</span>assets<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin image<span class="token operator">-</span>webpack<span class="token operator">-</span>loader <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h4 id="_4-1-2-webpack-config-js"><a href="#_4-1-2-webpack-config-js" class="header-anchor">#</a> 4.1.2 webpack.config.js</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token keyword">const</span> OptimizeCssAssetsWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-css-assets-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  devtool<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    minimize<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
   module<span class="token operator">:</span><span class="token punctuation">{</span>
     rules<span class="token operator">:</span><span class="token punctuation">[</span>
         <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex">/\.(png|svg|jpg|gif|jpeg|ico)$/</span><span class="token punctuation">,</span>
          use<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
           <span class="token punctuation">{</span>
             loader<span class="token operator">:</span> <span class="token string">'image-webpack-loader'</span><span class="token punctuation">,</span>
             options<span class="token operator">:</span> <span class="token punctuation">{</span>
               mozjpeg<span class="token operator">:</span> <span class="token punctuation">{</span>
                 progressive<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                 quality<span class="token operator">:</span> <span class="token number">65</span>
               <span class="token punctuation">}</span><span class="token punctuation">,</span>
               optipng<span class="token operator">:</span> <span class="token punctuation">{</span>
                 enabled<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
               <span class="token punctuation">}</span><span class="token punctuation">,</span>
               pngquant<span class="token operator">:</span> <span class="token punctuation">{</span>
                 quality<span class="token operator">:</span> <span class="token string">'65-90'</span><span class="token punctuation">,</span>
                 speed<span class="token operator">:</span> <span class="token number">4</span>
               <span class="token punctuation">}</span><span class="token punctuation">,</span>
               gifsicle<span class="token operator">:</span> <span class="token punctuation">{</span>
                 interlaced<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
               <span class="token punctuation">}</span><span class="token punctuation">,</span>
               webp<span class="token operator">:</span> <span class="token punctuation">{</span>
                 quality<span class="token operator">:</span> <span class="token number">75</span>
               <span class="token punctuation">}</span>
             <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>
     minify<span class="token operator">:</span> <span class="token punctuation">{</span>
        collapseWhitespace<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        removeComments<span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token keyword">new</span> <span class="token class-name">OptimizeCssAssetsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-2-清除无用的-css"><a href="#_4-2-清除无用的-css" class="header-anchor">#</a> 4.2 清除无用的 CSS</h3> <ul><li><a href="https://www.npmjs.com/package/purgecss-webpack-plugin" target="_blank" rel="noopener noreferrer">purgecss-webpack-plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>单独提取 CSS 并清除用不到的 CSS</li></ul> <h4 id="_4-2-1-安装"><a href="#_4-2-1-安装" class="header-anchor">#</a> 4.2.1 安装</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>cnpm i purgecss-webpack-plugin mini-css-extract-plugin  -D
</code></pre></div><h4 id="_4-2-3-src-index-js"><a href="#_4-2-3-src-index-js" class="header-anchor">#</a> 4.2.3 src\index.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;./index.css&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_4-2-4-src-index-css"><a href="#_4-2-4-src-index-css" class="header-anchor">#</a> 4.2.4 src\index.css</h4> <p>src\index.css</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">body</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">#root</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">#other</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_4-2-5-src-index-html"><a href="#_4-2-5-src-index-html" class="header-anchor">#</a> 4.2.5 src\index.html</h4> <p>src\index.html</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_4-2-6-package-json"><a href="#_4-2-6-package-json" class="header-anchor">#</a> 4.2.6 package.json</h4> <p>package.json</p> <div class="language-json extra-class"><pre class="language-json"><code>  <span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;**/*.css&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="_4-2-7-webpack-config-js"><a href="#_4-2-7-webpack-config-js" class="header-anchor">#</a> 4.2.7 webpack.config.js</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mini-css-extract-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> PurgecssPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;purgecss-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;glob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">PATHS</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  src<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
       <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
        include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
     <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
       filename<span class="token operator">:</span> <span class="token string">&quot;[name].css&quot;</span><span class="token punctuation">,</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token keyword">new</span> <span class="token class-name">PurgecssPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
       paths<span class="token operator">:</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">PATHS</span><span class="token punctuation">.</span>src<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/**/*</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>  <span class="token punctuation">{</span> nodir<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-3-tree-shaking"><a href="#_4-3-tree-shaking" class="header-anchor">#</a> 4.3 Tree Shaking</h3> <ul><li>一个模块可以有多个方法，只要其中某个方法使用到了，则整个文件都会被打到 bundle 里面去，tree shaking 就是只把<strong>用到的方法</strong>打入 bundle,<strong>没用到的方法</strong>会<code>uglify</code>阶段擦除掉</li> <li>原理是利用 es6 模块的特点,只能作为模块顶层语句出现,import 的模块名只能是字符串常量</li></ul> <h4 id="_4-3-1-开启"><a href="#_4-3-1-开启" class="header-anchor">#</a> 4.3.1 开启</h4> <ul><li>webpack 默认支持,可在<code>production mode</code>下默认开启</li> <li>在 package.json 中配置：
<ul><li>&quot;sideEffects&quot;: false 所有的代码都没有副作用（都可以进行 tree shaking）</li> <li>可能会把 <code>css和@babel/polyfill</code>文件干掉 可以设置 <code>&quot;sideEffects&quot;:[&quot;*.css&quot;]</code></li></ul></li></ul> <h4 id="_4-3-2-没有导入和使用"><a href="#_4-3-2-没有导入和使用" class="header-anchor">#</a> 4.3.2 没有导入和使用</h4> <p>functions.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">&quot;func1&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">&quot;func2&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> func1<span class="token punctuation">,</span> func2 <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> func2 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./functions&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> result2 <span class="token operator">=</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_4-3-3-代码不会被执行，不可到达"><a href="#_4-3-3-代码不会被执行，不可到达" class="header-anchor">#</a> 4.3.3 代码不会被执行，不可到达</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_4-3-4-代码执行的结果不会被用到"><a href="#_4-3-4-代码执行的结果不会被用到" class="header-anchor">#</a> 4.3.4 代码执行的结果不会被用到</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> func2 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./functions&quot;</span><span class="token punctuation">;</span>
<span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_4-3-5-代码中只写不读的变量"><a href="#_4-3-5-代码中只写不读的变量" class="header-anchor">#</a> 4.3.5 代码中只写不读的变量</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> aabbcc <span class="token operator">=</span> <span class="token string">&quot;aabbcc&quot;</span><span class="token punctuation">;</span>
aabbcc <span class="token operator">=</span> <span class="token string">&quot;eeffgg&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-4-scope-hoisting"><a href="#_4-4-scope-hoisting" class="header-anchor">#</a> 4.4 Scope Hoisting</h3> <ul><li>Scope Hoisting 可以让 Webpack 打包出来的代码文件更小、运行的更快， 它又译作 &quot;作用域提升&quot;，是在 Webpack3 中新推出的功能。</li> <li>scope hoisting 的原理是将所有的模块按照引用顺序放在一个函数作用域里，然后适当地重命名一些变量以防止命名冲突</li> <li>这个功能在 mode 为<code>production</code>下默认开启,开发环境要用 <code>webpack.optimizeModuleConcatenationPlugin</code>插件</li></ul> <p>hello.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> str <span class="token keyword">from</span> <span class="token string">&quot;./hello.js&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>main.js</p> <div class="language-js: extra-class"><pre class="language-text"><code>var hello = ('hello');
console.log(hello);
</code></pre></div><h2 id="_5-运行速度优化"><a href="#_5-运行速度优化" class="header-anchor">#</a> 5.运行速度优化</h2> <h3 id="_5-1-代码分割"><a href="#_5-1-代码分割" class="header-anchor">#</a> 5.1 代码分割</h3> <ul><li>对于大的 Web 应用来讲，将所有的代码都放在一个文件中显然是不够有效的，特别是当你的某些代码块是在某些特殊的时候才会被用到。</li> <li>webpack 有一个功能就是将你的代码库分割成 chunks 语块，当代码运行到需要它们的时候再进行加载</li></ul> <h4 id="_5-1-1-入口点分割"><a href="#_5-1-1-入口点分割" class="header-anchor">#</a> 5.1.1 入口点分割</h4> <ul><li>Entry Points：入口文件设置的时候可以配置</li> <li>这种方法的问题
<ul><li>如果入口 chunks 之间包含重复的模块(lodash)，那些重复模块都会被引入到各个 bundle 中</li> <li>不够灵活，并且不能将核心应用程序逻辑进行动态拆分代码</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>entry<span class="token operator">:</span> <span class="token punctuation">{</span>
  index<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  login<span class="token operator">:</span> <span class="token string">&quot;./src/login.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_5-1-2-懒加载"><a href="#_5-1-2-懒加载" class="header-anchor">#</a> 5.1.2 懒加载</h4> <ul><li>用户当前需要用什么功能就只加载这个功能对应的代码，也就是所谓的按需加载，在给单页应用做按需加载优化时</li> <li>一般采用以下原则：
<ul><li>对网站功能进行划分，每一类功能就对应一个 chunk</li> <li>对于首次打开页面需要的功能直接加载，尽快展示给用户，某些依赖大量代码的功能点可以按需加载</li> <li>被分割出去的代码需要一个按需加载的时机</li></ul></li></ul> <h5 id="_5-1-2-1-hello-js"><a href="#_5-1-2-1-hello-js" class="header-anchor">#</a> 5.1.2.1 hello.js</h5> <p>hello.js</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_5-1-2-2-index-js"><a href="#_5-1-2-2-index-js" class="header-anchor">#</a> 5.1.2.2 index.js</h5> <div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#clickBtn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>default<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_5-1-2-3-index-html"><a href="#_5-1-2-3-index-html" class="header-anchor">#</a> 5.1.2.3 index.html</h5> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>clickBtn<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点我<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_5-1-3-prefetch"><a href="#_5-1-3-prefetch" class="header-anchor">#</a> 5.1.3 prefetch</h4> <ul><li>使用预先拉取，你表示该模块<strong>可能以后会用到</strong>。浏览器会在<strong>空闲时间</strong>下载该模块</li> <li><code>prefetch</code>的作用是告诉浏览器未来可能会使用到的某个资源，浏览器就会在<strong>闲时去加载</strong>对应的资源，若能预测到用户的行为，比如懒加载，点击到其它页面等则相当于提前预加载了需要的资源</li> <li>此导入会让<code>&lt;link rel=&quot;prefetch&quot; as=&quot;script&quot; href=&quot;http://localhost:8080/hello.js&quot;&gt;</code>被添加至页面的头部。因此浏览器会在<strong>空闲时间预先拉取该文件</strong>。</li></ul> <p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#clickBtn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span>
    <span class="token comment">/* webpackChunkName: 'hello', webpackPrefetch: true */</span> <span class="token string">&quot;./hello&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>default<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_5-1-6-提取公共代码"><a href="#_5-1-6-提取公共代码" class="header-anchor">#</a> 5.1.6 提取公共代码</h4> <ul><li><p>怎么配置单页应用?怎么配置多页应用?</p> <h5 id="_5-1-6-1-为什么需要提取公共代码"><a href="#_5-1-6-1-为什么需要提取公共代码" class="header-anchor">#</a> 5.1.6.1 为什么需要提取公共代码</h5></li> <li><p>大网站有多个页面，每个页面由于采用<strong>相同技术栈和样式代码</strong>，会包含很多公共代码，如果都包含进来会有问题</p></li> <li><p>相同的资源被重复的加载，浪费用户的流量和服务器的成本；</p></li> <li><p>每个页面需要加载的资源太大，导致网页首屏加载缓慢，影响用户体验。</p></li> <li><p>如果能把公共代码抽离成单独文件进行加载能进行优化，可以减少网络传输流量，降低服务器成本</p></li></ul> <h5 id="_5-1-6-2-如何提取"><a href="#_5-1-6-2-如何提取" class="header-anchor">#</a> 5.1.6.2 如何提取</h5> <ul><li>基础类库，方便长期缓存</li> <li>页面之间的公用代码</li> <li>各个页面单独生成文件</li></ul> <h5 id="_5-1-6-3-splitchunks"><a href="#_5-1-6-3-splitchunks" class="header-anchor">#</a> 5.1.6.3 splitChunks</h5> <ul><li><p>split-chunks-plugin</p> <h5 id="_5-1-6-3-1-module-chunk-bundle"><a href="#_5-1-6-3-1-module-chunk-bundle" class="header-anchor">#</a> 5.1.6.3.1 module chunk bundle</h5></li> <li><p>module：就是 js 的模块化 webpack 支持 commonJS、ES6 等模块化规范，简单来说就是你通过 import 语句引入的代码</p></li> <li><p>chunk: chunk 是 webpack 根据功能拆分出来的，包含三种情况</p> <ul><li>你的项目入口（entry）</li> <li>通过 import()动态引入的代码</li> <li>通过 splitChunks 拆分出来的代码</li></ul></li> <li><p>bundle：bundle 是 webpack 打包之后的各个文件，一般就是和 chunk 是一对一的关系，<strong>bundle 就是对 chunk 进行编译压缩打包等处理之后的产出</strong></p></li></ul> <h5 id="_5-1-6-3-2-默认配置"><a href="#_5-1-6-3-2-默认配置" class="header-anchor">#</a> 5.1.6.3.2 默认配置</h5> <p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
    chunkFilename<span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    page1<span class="token operator">:</span> <span class="token string">&quot;./src/page1.js&quot;</span><span class="token punctuation">,</span>
    page2<span class="token operator">:</span> <span class="token string">&quot;./src/page2.js&quot;</span><span class="token punctuation">,</span>
    page3<span class="token operator">:</span> <span class="token string">&quot;./src/page3.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
      chunks<span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
      minSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      minRemainingSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      maxSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      maxAsyncRequests<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      maxInitialRequests<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
      automaticNameDelimiter<span class="token operator">:</span> <span class="token string">&quot;~&quot;</span><span class="token punctuation">,</span>
      enforceSizeThreshold<span class="token operator">:</span> <span class="token number">50000</span><span class="token punctuation">,</span>
      cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
        defaultVendors<span class="token operator">:</span> <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex">/[\\/]node_modules[\\/]/</span><span class="token punctuation">,</span>
          priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>
          reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
          reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>src\page1.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> utils1 <span class="token keyword">from</span> <span class="token string">&quot;./module1&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> utils2 <span class="token keyword">from</span> <span class="token string">&quot;./module2&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">&quot;jquery&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>utils1<span class="token punctuation">,</span> utils2<span class="token punctuation">,</span> $<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;asyncModule1&quot; */</span> <span class="token string">&quot;./asyncModule1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>src\page2.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> utils1 <span class="token keyword">from</span> <span class="token string">&quot;./module1&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> utils2 <span class="token keyword">from</span> <span class="token string">&quot;./module2&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">&quot;jquery&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>utils1<span class="token punctuation">,</span> utils2<span class="token punctuation">,</span> $<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>src\page3.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> utils1 <span class="token keyword">from</span> <span class="token string">&quot;./module1&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> utils3 <span class="token keyword">from</span> <span class="token string">&quot;./module3&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">&quot;jquery&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>utils1<span class="token punctuation">,</span> utils3<span class="token punctuation">,</span> $<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>src\module1.js</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;module1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>src\module2.js</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;module2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>src\module3.js</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;module3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>src\asyncModule1.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">;</span>
                             Asset       Size                     Chunks             Chunk Names
             asyncModule1<span class="token punctuation">.</span>chunk<span class="token punctuation">.</span>js  <span class="token number">740</span> bytes               asyncModule1  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  asyncModule1
                        index<span class="token punctuation">.</span>html  <span class="token number">498</span> bytes                             <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
                          page1<span class="token punctuation">.</span>js   <span class="token number">10.6</span> KiB                      page1  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  page1
              page1<span class="token operator">~</span>page2<span class="token punctuation">.</span>chunk<span class="token punctuation">.</span>js  <span class="token number">302</span> bytes                page1<span class="token operator">~</span>page2  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  page1<span class="token operator">~</span>page2
        page1<span class="token operator">~</span>page2<span class="token operator">~</span>page3<span class="token punctuation">.</span>chunk<span class="token punctuation">.</span>js  <span class="token number">308</span> bytes          page1<span class="token operator">~</span>page2<span class="token operator">~</span>page3  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  page1<span class="token operator">~</span>page2<span class="token operator">~</span>page3
                          page2<span class="token punctuation">.</span>js   <span class="token number">7.52</span> KiB                      page2  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  page2
                          page3<span class="token punctuation">.</span>js   <span class="token number">7.72</span> KiB                      page3  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  page3
     vendors<span class="token operator">~</span>asyncModule1<span class="token punctuation">.</span>chunk<span class="token punctuation">.</span>js    <span class="token number">532</span> KiB       vendors<span class="token operator">~</span>asyncModule1  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  vendors<span class="token operator">~</span>asyncModule1
vendors<span class="token operator">~</span>page1<span class="token operator">~</span>page2<span class="token operator">~</span>page3<span class="token punctuation">.</span>chunk<span class="token punctuation">.</span>js    <span class="token number">282</span> KiB  vendors<span class="token operator">~</span>page1<span class="token operator">~</span>page2<span class="token operator">~</span>page3  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  vendors<span class="token operator">~</span>page1<span class="token operator">~</span>page2<span class="token operator">~</span>page3
Entrypoint page1 <span class="token operator">=</span> vendors<span class="token operator">~</span>page1<span class="token operator">~</span>page2<span class="token operator">~</span>page3<span class="token punctuation">.</span>chunk<span class="token punctuation">.</span>js page1<span class="token operator">~</span>page2<span class="token operator">~</span>page3<span class="token punctuation">.</span>chunk<span class="token punctuation">.</span>js page1<span class="token operator">~</span>page2<span class="token punctuation">.</span>chunk<span class="token punctuation">.</span>js page1<span class="token punctuation">.</span>js
Entrypoint page2 <span class="token operator">=</span> vendors<span class="token operator">~</span>page1<span class="token operator">~</span>page2<span class="token operator">~</span>page3<span class="token punctuation">.</span>chunk<span class="token punctuation">.</span>js page1<span class="token operator">~</span>page2<span class="token operator">~</span>page3<span class="token punctuation">.</span>chunk<span class="token punctuation">.</span>js page1<span class="token operator">~</span>page2<span class="token punctuation">.</span>chunk<span class="token punctuation">.</span>js page2<span class="token punctuation">.</span>js
Entrypoint page3 <span class="token operator">=</span> vendors<span class="token operator">~</span>page1<span class="token operator">~</span>page2<span class="token operator">~</span>page3<span class="token punctuation">.</span>chunk<span class="token punctuation">.</span>js page1<span class="token operator">~</span>page2<span class="token operator">~</span>page3<span class="token punctuation">.</span>chunk<span class="token punctuation">.</span>js page3<span class="token punctuation">.</span>js
</code></pre></div><p>引用下珠峰的图片：<br> <img src="http://img.zhufengpeixun.cn/splitChunks.jpg" alt="splitChunks"></p> <h3 id="_5-2-cdn"><a href="#_5-2-cdn" class="header-anchor">#</a> 5.2 CDN</h3> <ul><li>最影响用户体验的是网页首次打开时的加载等待。 导致这个问题的根本是网络传输过程耗时大，CDN 的作用就是加速网络传输。</li> <li>CDN 又叫内容分发网络，通过把资源部署到世界各地，用户在访问时按照就近原则从离用户最近的服务器获取资源，从而加速资源的获取速度</li> <li>用户使用浏览器第一次访问我们的站点时，该页面引入了各式各样的静态资源，如果我们能做到持久化缓存的话，可以在 http 响应头加上 Cache-control 或 Expires 字段来设置缓存，浏览器可以将这些资源一一缓存到本地</li> <li>用户在后续访问的时候，如果需要再次请求同样的静态资源，且静态资源没有过期，那么浏览器可以直接走本地缓存而不用再通过网络请求资源</li> <li>缓存配置
<ul><li><strong>HTML 文件不缓存，放在自己的服务器上，关闭自己服务器的缓存，静态资源的 URL 变成指向 CDN 服务器的地址</strong></li> <li>静态的 JavaScript、CSS、图片等文件开启 CDN 和缓存，并且文件名带上 HASH 值</li> <li>为了并行加载不阻塞，把不同的静态资源分配到不同的 CDN 服务器上</li></ul></li> <li>域名限制
<ul><li>同一时刻针对同一个域名的资源并行请求是有限制</li> <li>可以把这些静态资源分散到不同的 CDN 服务上去</li> <li>多个域名后会增加域名解析时间</li> <li>可以通过在 HTML HEAD 标签中 加入去<strong>预解析域名</strong>，以降低域名解析带来的延迟</li></ul></li></ul> <p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mini-css-extract-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> PurgecssPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;purgecss-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;terser-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> OptimizeCSSAssetsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;optimize-css-assets-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> UploadPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./plugins/UploadPlugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;glob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">PATHS</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    src<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
  devtool<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  context<span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    main<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;[name].[hash].js&quot;</span><span class="token punctuation">,</span>
    chunkFilename<span class="token operator">:</span> <span class="token string">&quot;[name].[hash].chunk.js&quot;</span><span class="token punctuation">,</span>
    publicPath<span class="token operator">:</span> <span class="token string">&quot;http://img.golderbrother.cn/&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    minimize<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">//压缩JS</span>
      <span class="token comment">/* new TerserPlugin({
        sourceMap: false,
        extractComments: false,
      }),
      //压缩CSS
      new OptimizeCSSAssetsPlugin({}), */</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">//自动分割第三方模块和公共模块</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
      chunks<span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span> <span class="token comment">//默认作用于异步chunk，值为all/initial/async</span>
      minSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//默认值是30kb,代码块的最小尺寸</span>
      minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//被多少模块共享,在分割之前模块的被引用次数</span>
      maxAsyncRequests<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">//限制异步模块内部的并行最大请求数的，说白了你可以理解为是每个import()它里面的最大并行请求数量</span>
      maxInitialRequests<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">//限制入口的拆分数量</span>
      name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//打包后的名称，默认是chunk的名字通过分隔符（默认是～）分隔开，如vendor~</span>
      automaticNameDelimiter<span class="token operator">:</span> <span class="token string">&quot;~&quot;</span><span class="token punctuation">,</span> <span class="token comment">//默认webpack将会使用入口名和代码块的名称生成命名,比如 'vendors~main.js'</span>
      cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">//设置缓存组用来抽取满足不同规则的chunk,下面以生成common为例</span>
        vendors<span class="token operator">:</span> <span class="token punctuation">{</span>
          chunks<span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
          test<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span> <span class="token comment">//条件</span>
          priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">///优先级，一个chunk很可能满足多个缓存组，会被抽取到优先级高的缓存组中,为了能够让自定义缓存组有更高的优先级(默认0),默认缓存组的priority属性为负值.</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        commons<span class="token operator">:</span> <span class="token punctuation">{</span>
          chunks<span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
          minSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//最小提取字节数</span>
          minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">//最少被几个chunk引用</span>
          priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
          reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//如果该chunk中引用了已经被抽取的chunk，直接引用该chunk，不会重复打包代码</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//为了长期缓存保持运行时代码块是单独的文件</span>
    <span class="token comment">/*  runtimeChunk: {
      name: (entrypoint) =&gt; `runtime-${entrypoint.name}`,
    }, */</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.js/</span><span class="token punctuation">,</span>
        include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              presets<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> modules<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">&quot;@babel/preset-react&quot;</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
        include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.(png|svg|jpg|gif|jpeg|ico)$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;file-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">&quot;image-webpack-loader&quot;</span><span class="token punctuation">,</span>
            <span class="token comment">// 有各种配置，可以调整你要压缩后图片的质量</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              mozjpeg<span class="token operator">:</span> <span class="token punctuation">{</span>
                progressive<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                quality<span class="token operator">:</span> <span class="token number">65</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              optipng<span class="token operator">:</span> <span class="token punctuation">{</span>
                enabled<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              pngquant<span class="token operator">:</span> <span class="token punctuation">{</span>
                quality<span class="token operator">:</span> <span class="token string">&quot;65-90&quot;</span><span class="token punctuation">,</span>
                speed<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              gifsicle<span class="token operator">:</span> <span class="token punctuation">{</span>
                interlaced<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              webp<span class="token operator">:</span> <span class="token punctuation">{</span>
                quality<span class="token operator">:</span> <span class="token number">75</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      inject<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      template<span class="token operator">:</span> <span class="token string">&quot;./src/index.html&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">&quot;[name].[hash].css&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">PurgecssPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      paths<span class="token operator">:</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">PATHS</span><span class="token punctuation">.</span>src<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/**/*</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span> nodir<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">UploadPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_6-附录"><a href="#_6-附录" class="header-anchor">#</a> 6.附录</h2> <h3 id="_6-1-环境"><a href="#_6-1-环境" class="header-anchor">#</a> 6.1 环境</h3> <h4 id="_6-1-1-模式-mode"><a href="#_6-1-1-模式-mode" class="header-anchor">#</a> 6.1.1 模式(mode)</h4> <ul><li>日常的前端开发工作中，一般都会有两套构建环境</li> <li>一套开发时使用，构建结果用于本地开发调试，不进行代码压缩，打印 debug 信息，包含 sourcemap 文件</li> <li>一套构建后的结果是直接应用于线上的，即代码都是压缩后，运行时不打印 debug 信息，静态文件不包括 sourcemap</li> <li>webpack 4.x 版本引入了 <a href="https://webpack.docschina.org/configuration/mode/" target="_blank" rel="noopener noreferrer">mode<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的概念</li> <li>当你指定使用 <code>production</code> mode 时，默认会启用各种性能优化的功能，包括构建结果优化以及 webpack 运行性能优化</li> <li>而如果是 <code>development</code> mode 的话，则会开启 debug 工具，运行时打印详细的错误信息，以及更加快速的增量编译构建</li></ul> <table><thead><tr><th style="text-align:left;">选项</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">development</td> <td style="text-align:left;">会将 process.env.NODE_ENV 的值设为 development。启用 NamedChunksPlugin 和 NamedModulesPlugin</td></tr> <tr><td style="text-align:left;">production</td> <td style="text-align:left;">会将 process.env.NODE_ENV 的值设为 production。启用 FlagDependencyUsagePlugin, FlagIncludedChunksPlugin, ModuleConcatenationPlugin, NoEmitOnErrorsPlugin, OccurrenceOrderPlugin, SideEffectsFlagPlugin 和 UglifyJsPlugin</td></tr></tbody></table> <h4 id="_6-1-2-环境差异"><a href="#_6-1-2-环境差异" class="header-anchor">#</a> 6.1.2 环境差异</h4> <ul><li>开发环境
<ul><li>需要生成 sourcemap 文件</li> <li>需要打印 debug 信息</li> <li>需要 live reload 或者 hot reload 的功能</li></ul></li> <li>生产环境
<ul><li>可能需要分离 CSS 成单独的文件，以便多个页面共享同一个 CSS 文件</li> <li>需要压缩 HTML/CSS/JS 代码</li> <li>需要压缩图片</li></ul></li> <li>其默认值为 production</li></ul> <h4 id="_6-1-3-区分环境"><a href="#_6-1-3-区分环境" class="header-anchor">#</a> 6.1.3 区分环境</h4> <ul><li><code>--mode</code>用来设置<strong>模块内</strong>的<code>process.env.NODE_ENV</code></li> <li><code>--env</code>用来设置 <strong>webpack 配置文件</strong>的函数参数</li> <li><a href="https://www.npmjs.com/package/cross-env" target="_blank" rel="noopener noreferrer">cross-env<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>用来设置 node 环境的<code>process.env.NODE_ENV</code></li> <li><a href="https://www.npmjs.com/package/dotenv" target="_blank" rel="noopener noreferrer">dotenv<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可以按需加载不同的环境变量文件</li> <li><a href="https://webpack.js.org/plugins/define-plugin" target="_blank" rel="noopener noreferrer">define-plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>用来配置在<code>编译时候</code>用的<code>全局常量</code></li></ul> <h5 id="_6-1-3-1-安装"><a href="#_6-1-3-1-安装" class="header-anchor">#</a> 6.1.3.1 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>cnpm i cross<span class="token operator">-</span>env dotenv terser<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin optimize<span class="token operator">-</span>css<span class="token operator">-</span>assets<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h5 id="_6-1-3-2-mode-默认值"><a href="#_6-1-3-2-mode-默认值" class="header-anchor">#</a> 6.1.3.2 mode 默认值</h5> <ul><li>webpack 的 mode 默认为<code>production</code></li> <li><code>webpack serve</code>的 mode 默认为<code>development</code></li> <li>可以在模块内通过<code>process.env.NODE_ENV</code>获取当前的环境变量,无法在<code>webpack配置文件</code>中获取此变量</li></ul> <div class="language-json extra-class"><pre class="language-json"><code>  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack serve&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>index.js</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// development | production</span>
</code></pre></div><p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;NODE_ENV&quot;</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
</code></pre></div><h5 id="_6-1-3-3-命令行传-mode"><a href="#_6-1-3-3-命令行传-mode" class="header-anchor">#</a> 6.1.3.3 命令行传 mode</h5> <ul><li><p>同配置 1</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --mode=production&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --mode=development serve&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div></li></ul> <h5 id="_6-1-3-4-命令行配置-env"><a href="#_6-1-3-4-命令行配置-env" class="header-anchor">#</a> 6.1.3.4 命令行配置 env</h5> <ul><li>无法在模块内通过<code>process.env.NODE_ENV</code>访问</li> <li>可以通过<code>webpack 配置文件中</code>中通过<code>函数</code>获取当前环境变量</li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack serve --env=development&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --env=production&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>index.js</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
</code></pre></div><p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'NODE_ENV'</span><span class="token punctuation">,</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// undefined</span>
<span class="token keyword">const</span> TerserWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> OptimizeCssAssetsWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-css-assets-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">env</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'env'</span><span class="token punctuation">,</span>env<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// {development:true} | {production:true}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>        optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>          minimize<span class="token operator">:</span>env<span class="token operator">&amp;&amp;</span>env<span class="token punctuation">.</span>production<span class="token punctuation">,</span>
<span class="token operator">+</span>          minimizer<span class="token operator">:</span> <span class="token punctuation">(</span>env <span class="token operator">&amp;&amp;</span> env<span class="token punctuation">.</span>production<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span>
<span class="token operator">+</span>            <span class="token keyword">new</span> <span class="token class-name">TerserWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
<span class="token operator">+</span>              parallel<span class="token operator">:</span> <span class="token boolean">true</span><span class="token comment">//开启多进程并行压缩</span>
<span class="token operator">+</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token operator">+</span>            <span class="token keyword">new</span> <span class="token class-name">OptimizeCssAssetsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">+</span>          <span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token operator">+</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_6-1-3-5-mode-配置"><a href="#_6-1-3-5-mode-配置" class="header-anchor">#</a> 6.1.3.5 mode 配置</h5> <ul><li><p>和命令行配置 2 一样</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h5 id="_6-1-3-6-defineplugin"><a href="#_6-1-3-6-defineplugin" class="header-anchor">#</a> 6.1.3.6 DefinePlugin</h5> <ul><li>设置全局变量(不是<code>window</code>),所有模块都能读取到该变量的值</li> <li>可以在任意模块内通过 <code>process.env.NODE_ENV</code> 获取当前的环境变量</li> <li>但无法在<code>node环境</code>(webpack 配置文件中)下获取当前的环境变量</li></ul> <h6 id="_6-1-3-6-1-webpack-config-js"><a href="#_6-1-3-6-1-webpack-config-js" class="header-anchor">#</a> 6.1.3.6.1 webpack.config.js</h6> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;process.env.NODE_ENV&quot;</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;NODE_ENV&quot;</span><span class="token punctuation">,</span> <span class="token constant">NODE_ENV</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error ！！！</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token string">&quot;process.env.NODE_ENV&quot;</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">&quot;development&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//注意用双引号引起来，否则就成变量了</span>
      <span class="token constant">NODE_ENV</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">&quot;production&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h6 id="_6-1-3-6-2-src-index-js"><a href="#_6-1-3-6-2-src-index-js" class="header-anchor">#</a> 6.1.3.6.2 src/index.js</h6> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  production</span>
</code></pre></div><h6 id="_6-1-3-6-3-src-logger-js"><a href="#_6-1-3-6-3-src-logger-js" class="header-anchor">#</a> 6.1.3.6.3 src/logger.js</h6> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">logger</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">==</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>console<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h6 id="_6-1-4-cross-env"><a href="#_6-1-4-cross-env" class="header-anchor">#</a> 6.1.4 cross-env</h6> <ul><li>只能设置<code>node环境</code>下的变量 NODE_ENV</li></ul> <p>package.json</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=development webpack&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;process.env.NODE_ENV&quot;</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// development</span>
</code></pre></div><h4 id="_6-1-4-env"><a href="#_6-1-4-env" class="header-anchor">#</a> 6.1.4 env</h4> <h5 id="_6-1-4-1-env"><a href="#_6-1-4-1-env" class="header-anchor">#</a> 6.1.4.1 .env</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">NODE_ENV</span> <span class="token operator">=</span> development<span class="token punctuation">;</span>
</code></pre></div><h5 id="_6-1-4-2-webpack-config-js"><a href="#_6-1-4-2-webpack-config-js" class="header-anchor">#</a> 6.1.4.2 webpack.config.js</h5> <p>webpack.config.js</p> <div class="language-diff extra-class"><pre class="language-diff"><code>require('dotenv').config({path: path.resolve(__dirname,'.env')})
console.log(process.env.NODE_ENV);
</code></pre></div><h3 id="_6-2-javascript-兼容性"><a href="#_6-2-javascript-兼容性" class="header-anchor">#</a> 6.2 JavaScript 兼容性</h3> <h4 id="_6-2-1-babel"><a href="#_6-2-1-babel" class="header-anchor">#</a> 6.2.1 Babel</h4> <ul><li><a href="https://www.babeljs.cn/docs/index.html" target="_blank" rel="noopener noreferrer">Babel<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是一个 JavaScript 编译器</li> <li>Babel 是一个工具链，主要用于将 ECMAScript 2015+ 版本的代码转换为向后兼容的 JavaScript 语法，以便能够运行在当前和旧版本的浏览器或其他环境中</li> <li>Babel 能为你做的事情
<ul><li>语法转换</li></ul></li></ul> <h5 id="_6-2-1-1-安装"><a href="#_6-2-1-1-安装" class="header-anchor">#</a> 6.2.1.1 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>cnpm i @babel<span class="token operator">/</span>core @babel<span class="token operator">/</span>cli <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h5 id="_6-2-1-2-命令行使用"><a href="#_6-2-1-2-命令行使用" class="header-anchor">#</a> 6.2.1.2 命令行使用</h5> <h6 id="_6-2-1-2-1-src-index-js"><a href="#_6-2-1-2-1-src-index-js" class="header-anchor">#</a> 6.2.1.2.1 src\index.js</h6> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">sum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h6 id="_6-2-1-2-2-package-json"><a href="#_6-2-1-2-2-package-json" class="header-anchor">#</a> 6.2.1.2.2 package.json</h6> <div class="language-json extra-class"><pre class="language-json"><code>  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;babel src --out-dir dist --watch&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="_6-2-2-插件"><a href="#_6-2-2-插件" class="header-anchor">#</a> 6.2.2 插件</h4> <ul><li>Babel 是一个编译器（输入源码 =&gt; 输出编译后的代码）。就像其他编译器一样，编译过程分为三个阶段：<strong>解析、转换和打印输出</strong>。</li> <li>现在，Babel 虽然开箱即用，但是什么动作都不做。它基本上类似于 <code>const babel = code =&gt; code</code>; ，将代码解析之后再输出同样的代码。如果想要 Babel 做一些实际的工作，就需要为其添加<a href="https://www.babeljs.cn/docs/plugins" target="_blank" rel="noopener noreferrer">插件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h5 id="_6-2-2-1-安装"><a href="#_6-2-2-1-安装" class="header-anchor">#</a> 6.2.2.1 安装</h5> <div class="language-bash extra-class"><pre class="language-bash"><code>cnpm i @babel/plugin-transform-arrow-functions -D
</code></pre></div><h5 id="_6-2-2-2-babelrc"><a href="#_6-2-2-2-babelrc" class="header-anchor">#</a> 6.2.2.2 .babelrc</h5> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/plugin-transform-arrow-functions&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_6-2-3-预设"><a href="#_6-2-3-预设" class="header-anchor">#</a> 6.2.3 预设</h4> <ul><li>不想自己动手组合插件？没问题！<a href="https://www.babeljs.cn/docs/presets" target="_blank" rel="noopener noreferrer">preset<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 可以作为 Babel 插件的组合</li> <li><a href="https://www.babeljs.cn/docs/babel-preset-env" target="_blank" rel="noopener noreferrer">@babel/preset-env<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可以让你使用最新的 JavaScript 语法,而不需要去管理语法转换器(并且可选的支持目标浏览器环境的 polyfills)</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;pluginA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pluginB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pluginC&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_6-2-3-1-安装"><a href="#_6-2-3-1-安装" class="header-anchor">#</a> 6.2.3.1 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>cnpm install <span class="token operator">--</span>save<span class="token operator">-</span>dev @babel<span class="token operator">/</span>preset<span class="token operator">-</span>env
</code></pre></div><h5 id="_6-2-3-2-babelrc"><a href="#_6-2-3-2-babelrc" class="header-anchor">#</a> 6.2.3.2 .babelrc</h5> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="_6-2-3-3-browsers"><a href="#_6-2-3-3-browsers" class="header-anchor">#</a> 6.2.3.3 browsers</h5> <ul><li><code>@babel/preset-env</code> 会根据你配置的目标环境，生成插件列表来编译</li> <li>可以使用 <code>.browserslistrc</code> 文件来指定目标环境</li> <li><a href="https://github.com/browserslist/browserslist" target="_blank" rel="noopener noreferrer">browserslist<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>详细配置</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//.browserslistrc</span>
<span class="token operator">&gt;</span> <span class="token number">0.25</span><span class="token operator">%</span>
not dead
last <span class="token number">2</span> Chrome versions
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.js?$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">{</span>
          loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span> <span class="token punctuation">{</span>
            presets<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                  useBuiltIns<span class="token operator">:</span><span class="token string">'usage'</span><span class="token punctuation">,</span>
                  corejs<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
<span class="token operator">+</span>                 targets<span class="token operator">:</span> <span class="token string">&quot;&gt; 0.25%, not dead&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">]</span>
           <span class="token punctuation">]</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="_6-2-4-polyfill"><a href="#_6-2-4-polyfill" class="header-anchor">#</a> 6.2.4 polyfill</h4> <ul><li><a href="https://www.babeljs.cn/docs/babel-preset-env" target="_blank" rel="noopener noreferrer">@babel/preset-env<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>默认只转换新的 javascript 语法，而不转换新的 API，比如 Iterator, Generator, Set, Maps, Proxy, Reflect,Symbol,Promise 等全局对象。以及一些在全局对象上的方法(比如 Object.assign)都不会转码</li> <li>比如说，ES6 在 Array 对象上新增了 Array.from 方法，Babel 就不会转码这个方法，如果想让这个方法运行，必须使用 babel-polyfill 来转换等</li> <li><code>polyfill</code>的中文意思是<strong>垫片</strong>,所谓垫片就是垫平不同浏览器或者不同环境下的差异，让新的内置函数、实例方法等在低版本浏览器中也可以使用</li> <li>官方给出<a href="https://www.babeljs.cn/docs/babel-polyfill" target="_blank" rel="noopener noreferrer">@babel/polyfill<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和 <code>babel-runtime</code> 两种解决方案来解决这种全局对象或全局对象方法不足的问题</li> <li><code>babel-runtime</code>适合在组件和类库项目中使用，而<code>babel-polyfill</code>适合在业务项目中使用。</li></ul> <h5 id="_6-2-4-1-polyfill"><a href="#_6-2-4-1-polyfill" class="header-anchor">#</a> 6.2.4.1 polyfill</h5> <ul><li><a href="https://www.babeljs.cn/docs/babel-polyfill" target="_blank" rel="noopener noreferrer">@babel/polyfill<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>模块可以模拟完整的 ES2015+ 环境</li> <li>这意味着可以使用诸如 <code>Promise</code> 和 <code>WeakMap</code> 之类的新的内置对象、 <code>Array.from</code> 或 <code>Object.assign</code> 之类的静态方法、<code>Array.prototype.includes</code> 之类的实例方法以及生成器函数</li> <li>它是通过向全局对象和内置对象的<code>prototype</code>上添加方法来实现的。比如运行环境中不支持 Array.prototype.find 方法，引入 polyfill, 我们就可以使用 es6 方法来编写了，但是缺点就是会造成全局空间污染</li> <li>V7.4.0 版本开始，<code>@babel/polyfill</code> 已经被废弃</li></ul> <h6 id="_6-2-4-1-1-安装"><a href="#_6-2-4-1-1-安装" class="header-anchor">#</a> 6.2.4.1.1 安装</h6> <div class="language-bash extra-class"><pre class="language-bash"><code>cnpm <span class="token function">install</span> --save @babel/polyfill core-js@3
cnpm <span class="token function">install</span> --save-dev  webpack webpack-cli babel-loader
</code></pre></div><h6 id="_6-2-4-1-2-usebuiltins-false"><a href="#_6-2-4-1-2-usebuiltins-false" class="header-anchor">#</a> 6.2.4.1.2 useBuiltIns:false</h6> <ul><li>&quot;useBuiltIns&quot;: false 此时不对 polyfill 做操作。如果引入 @babel/polyfill，则<strong>无视配置的浏览器兼容，引入所有的 polyfill</strong></li></ul> <p>src\index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;@babel/polyfill&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.js?$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">{</span>
          loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span> <span class="token punctuation">{</span>
            presets<span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">[</span>
                <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                  useBuiltIns<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>package.json</p> <div class="language-json extra-class"><pre class="language-json"><code>  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;babel src --out-dir dist --watch&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;pack&quot;</span><span class="token operator">:</span><span class="token string">&quot;webpack --mode=development&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h6 id="_6-2-4-1-3-usebuiltins-entry"><a href="#_6-2-4-1-3-usebuiltins-entry" class="header-anchor">#</a> 6.2.4.1.3 useBuiltIns:entry</h6> <ul><li><code>&quot;useBuiltIns&quot;: &quot;entry&quot;</code> 根据配置的浏览器兼容，引入浏览器不兼容的 polyfill。需要在入口文件手动添加 <code>import '@babel/polyfill'</code>，会自动根据 <code>browserslist</code> 替换成浏览器不兼容的所有 polyfill</li> <li>这里需要指定 core-js 的版本, 如果 &quot;corejs&quot;: 3, 则 <code>import '@babel/polyfill'</code> 需要改成 <code>import 'core-js/stable';import 'regenerator-runtime/runtime'</code></li> <li><code>core-js@2</code> 分支中已经不会再添加新特性，新特性都会添加到 <code>core-js@3</code>,比如<code>Array.prototype.flat()</code></li></ul> <p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code>  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.js?$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">{</span>
          loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span> <span class="token punctuation">{</span>
            presets<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
<span class="token operator">+</span>                  useBuiltIns<span class="token operator">:</span><span class="token string">'entry'</span><span class="token punctuation">,</span>
<span class="token operator">+</span>                  corejs<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
                  targets<span class="token operator">:</span> <span class="token string">&quot;&gt; 0.25%, not dead&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">]</span>
           <span class="token punctuation">]</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>src/index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;@babel/polyfill&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>webpack.config.js</p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged">  module: {
    rules: [
      {
        test: /\.js?$/,
        use: {
          loader: 'babel-loader',
          options: {
            presets: [
                [&quot;@babel/preset-env&quot;,
                {
                  useBuiltIns:'entry',
</span><span class="token inserted-sign inserted">+                  corejs:3,
</span><span class="token unchanged">                  targets: &quot;&gt; 0.25%, not dead&quot;,
                }]
           ]
          },
        },
      },
    ]
  },
</span></code></pre></div><p>src/index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'core-js/stable'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'regenerator-runtime/runtime'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token operator">=&gt;</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h6 id="_6-2-4-1-4-usebuiltins-usage"><a href="#_6-2-4-1-4-usebuiltins-usage" class="header-anchor">#</a> 6.2.4.1.4 useBuiltIns:usage</h6> <ul><li><code>&quot;useBuiltIns&quot;: &quot;usage&quot;</code> usage 会<strong>根据配置的浏览器兼容，以及你代码中用到的 API 来进行 polyfill，实现了按需添加</strong></li></ul> <p>src\index.js</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>webpack.config.js</p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged">  module: {
    rules: [
      {
        test: /\.js?$/,
        use: {
          loader: 'babel-loader',
          options: {
            presets: [
                [&quot;@babel/preset-env&quot;,
                {
</span><span class="token inserted-sign inserted">+                  useBuiltIns:'usage',
+                  corejs:3,
</span><span class="token unchanged">                  targets: &quot;&gt; 0.25%, not dead&quot;,
                }]
           ]
          },
        },
      },
    ]
  },
</span></code></pre></div><p>dist\index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;core-js/stable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;regenerator-runtime/runtime&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">d</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="_6-2-5-babel-runtime"><a href="#_6-2-5-babel-runtime" class="header-anchor">#</a> 6.2.5 babel-runtime</h4> <ul><li>Babel 为了解决全局空间污染的问题，提供了单独的包<a href="https://babeljs.io/docs/en/babel-runtime" target="_blank" rel="noopener noreferrer">babel-runtime<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>用以<strong>提供编译模块的工具函数</strong></li> <li>简单说 <code>babel-runtime</code> 更像是一种按需加载的实现，比如你哪里需要使用 Promise，只要在这个文件头部<code>require Promise from 'babel-runtime/core-js/promise'</code>就行了</li></ul> <h5 id="_6-2-5-1-安装"><a href="#_6-2-5-1-安装" class="header-anchor">#</a> 6.2.5.1 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>cnpm i babel<span class="token operator">-</span>runtime <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h5 id="_6-2-5-2-src-index-js"><a href="#_6-2-5-2-src-index-js" class="header-anchor">#</a> 6.2.5.2 src/index.js</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Promise <span class="token keyword">from</span> <span class="token string">&quot;babel-runtime/core-js/promise&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_6-2-5-3-dist-index-js"><a href="#_6-2-5-3-dist-index-js" class="header-anchor">#</a> 6.2.5.3 dist/index.js</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> _promise <span class="token operator">=</span> <span class="token function">_interopRequireDefault</span><span class="token punctuation">(</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;babel-runtime/core-js/promise&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">_interopRequireDefault</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> obj <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">.</span>__esModule <span class="token operator">?</span> obj <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> obj <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">_promise<span class="token punctuation">.</span>default</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_6-2-6-babel-plugin-transform-runtime"><a href="#_6-2-6-babel-plugin-transform-runtime" class="header-anchor">#</a> 6.2.6 babel-plugin-transform-runtime</h4> <ul><li><p>启用插件<code>babel-plugin-transform-runtime</code>后，Babel 就会使用<code>babel-runtime</code>下的工具函数。</p></li> <li><p><code>babel-plugin-transform-runtime</code>插件能够将这些工具函数的代码转换成<code>require</code>语句，指向为对<code>babel-runtime</code>的引用</p></li> <li><div class="language-bash extra-class"><pre class="language-bash"><code>babel-plugin-transform-runtime
</code></pre></div><p>就是可以在我们使用新 API 时自动</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">import</span> babel-runtime
</code></pre></div><p>里面的</p> <div class="language-bash extra-class"><pre class="language-bash"><code>polyfill
</code></pre></div><ul><li>当我们使用 <code>async/await</code> 时，自动引入 <code>babel-runtime/regenerator</code></li> <li>当我们使用 ES6 的静态事件或内置对象时，自动引入 <code>babel-runtime/core-js</code></li> <li>移除内联<code>babel helpers</code>并替换使用<code>babel-runtime/helpers</code> 来替换</li></ul></li> <li><p><code>babel-plugin-transform-runtime</code> 自带的是 core-js@3,如果配置 corejs 配置为 2 需要单独安装<code>@babel/runtime-corejs2</code></p></li> <li><p>@babel/polyfill 自带的 core-js@2,如果配置 corejs 配置为 3 需要单独安装<code>core-js@3</code></p></li> <li><p><code>@babel/plugin-transform-runtime</code>可以减少编译后代码的体积外，我们使用它还有一个好处，它可以为代码创建一个<strong>沙盒环境</strong>，如果使用 <code>@babel/polyfill</code>及其提供的内置程序（例如 Promise ，Set 和 Map ），则它们将污染全局范围。虽然这对于应用程序或命令行工具可能是可以的，但是如果你的代码是要发布供他人使用的库，或者无法完全控制代码运行的环境，则将成为一个问题</p></li></ul> <h5 id="_6-2-6-1-安装"><a href="#_6-2-6-1-安装" class="header-anchor">#</a> 6.2.6.1 安装</h5> <div class="language-bash extra-class"><pre class="language-bash"><code>cnpm i @babel/plugin-transform-runtime @babel/runtime-corejs2 -D
</code></pre></div><h5 id="_6-2-6-2-webpack-config-js"><a href="#_6-2-6-2-webpack-config-js" class="header-anchor">#</a> 6.2.6.2 webpack.config.js</h5> <div class="language-js extra-class"><pre class="language-js"><code>      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.jsx?$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">{</span>
          loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span> <span class="token punctuation">{</span>
            presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
              targets<span class="token operator">:</span> <span class="token string">&quot;&gt; 0.25%, not dead&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'@babel/preset-react'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">[</span>
                <span class="token string">&quot;@babel/plugin-transform-runtime&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                  corejs<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token comment">//当我们使用 ES6 的静态事件或内置对象时自动引入 babel-runtime/core-js</span>
                  helpers<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//移除内联babel helpers并替换使用babel-runtime/helpers 来替换</span>
                  regenerator<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//是否开启generator函数转换成使用regenerator runtime来避免污染全局域</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">[</span><span class="token string">'@babel/plugin-proposal-decorators'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> legacy<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">[</span><span class="token string">'@babel/plugin-proposal-class-properties'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> loose<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h5 id="_6-2-6-3-src-index-js"><a href="#_6-2-6-3-src-index-js" class="header-anchor">#</a> 6.2.6.3 src/index.js</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//corejs</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//helpers</span>
<span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token keyword">extends</span> <span class="token class-name">A</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//regenerator</span>
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_6-2-7-执行顺序"><a href="#_6-2-7-执行顺序" class="header-anchor">#</a> 6.2.7 执行顺序</h4> <ul><li>插件在 Presets 前运行</li> <li><strong>插件顺序从前往后排列</strong></li> <li><strong>presets 顺序从后往前</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> preset1 <span class="token operator">=</span> <span class="token punctuation">{</span> plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;plugin5&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;plugin6&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token keyword">let</span> preset2 <span class="token operator">=</span> <span class="token punctuation">{</span> plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;plugin3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;plugin4&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;preset1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;preset&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;plugins&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'plugin1'</span><span class="token punctuation">,</span><span class="token string">'plugin2'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
plugin1 plugin2 plugin3 plugin4 plugin5 plugin6
</code></pre></div><h3 id="_6-3-sourcemap"><a href="#_6-3-sourcemap" class="header-anchor">#</a> 6.3 sourcemap</h3> <ul><li><a href="https://webpack.js.org/configuration/devtool/#root" target="_blank" rel="noopener noreferrer">sourcemap<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是为了解决开发代码与实际运行代码不一致时帮助我们<code>debug</code>到原始开发代码的技术</li> <li><code>webpack</code>通过配置可以自动给我们<code>source maps</code>文件，<code>map</code>文件是一种<strong>对应编译文件和源文件</strong>的方法</li> <li><a href="https://github.com/webpack/docs/wiki/build-performance#sourcemaps" target="_blank" rel="noopener noreferrer">whyeval<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可以单独缓存 map，重建性能更高</li> <li><a href="https://github.com/mozilla/source-map" target="_blank" rel="noopener noreferrer">source-map<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h4 id="_6-3-1-配置项"><a href="#_6-3-1-配置项" class="header-anchor">#</a> 6.3.1 配置项</h4> <table><thead><tr><th style="text-align:left;">类型</th> <th style="text-align:left;">含义</th></tr></thead> <tbody><tr><td style="text-align:left;">source-map</td> <td style="text-align:left;">原始代码 最好的 sourcemap 质量有完整的结果，但是会很慢</td></tr> <tr><td style="text-align:left;">eval-source-map</td> <td style="text-align:left;">原始代码 同样道理，但是最高的质量和最低的性能</td></tr> <tr><td style="text-align:left;">cheap-module-eval-source-map</td> <td style="text-align:left;">原始代码（只有行内） 同样道理，但是更高的质量和更低的性能</td></tr> <tr><td style="text-align:left;">cheap-eval-source-map</td> <td style="text-align:left;">转换代码（行内） 每个模块被 eval 执行，并且 sourcemap 作为 eval 的一个 dataurl</td></tr> <tr><td style="text-align:left;">eval</td> <td style="text-align:left;">生成代码 每个模块都被 eval 执行，并且存在@sourceURL,带 eval 的构建模式能 cache SourceMap</td></tr> <tr><td style="text-align:left;">cheap-source-map</td> <td style="text-align:left;">转换代码（行内） 生成的 sourcemap 没有列映射，从 loaders 生成的 sourcemap 没有被使用</td></tr> <tr><td style="text-align:left;">cheap-module-source-map</td> <td style="text-align:left;">原始代码（只有行内） 与上面一样除了每行特点的从 loader 中进行映射</td></tr></tbody></table> <h4 id="_6-3-2-关键字"><a href="#_6-3-2-关键字" class="header-anchor">#</a> 6.3.2 关键字</h4> <ul><li>看似配置项很多， 其实只是五个关键字 eval、source-map、cheap、module 和 inline 的任意组合</li> <li>关键字可以任意组合，但是有顺序要求</li></ul> <table><thead><tr><th style="text-align:left;">关键字</th> <th style="text-align:left;">含义</th></tr></thead> <tbody><tr><td style="text-align:left;">eval</td> <td style="text-align:left;">使用 eval 包裹模块代码</td></tr> <tr><td style="text-align:left;">source-map</td> <td style="text-align:left;">产生.map 文件</td></tr> <tr><td style="text-align:left;">cheap</td> <td style="text-align:left;">不包含列信息（关于列信息的解释下面会有详细介绍)也不包含 loader 的 sourcemap</td></tr> <tr><td style="text-align:left;">module</td> <td style="text-align:left;">包含 loader 的 sourcemap（比如 jsx to js ，babel 的 sourcemap）,否则无法定义源文件</td></tr> <tr><td style="text-align:left;">inline</td> <td style="text-align:left;">将.map 作为 DataURI 嵌入，不单独生成.map 文件</td></tr></tbody></table> <h4 id="_6-3-3-webpack-config-js"><a href="#_6-3-3-webpack-config-js" class="header-anchor">#</a> 6.3.3 webpack.config.js</h4> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  devtool<span class="token operator">:</span> <span class="token string">&quot;source-map&quot;</span><span class="token punctuation">,</span>
  devtool<span class="token operator">:</span> <span class="token string">&quot;eval-source-map&quot;</span><span class="token punctuation">,</span>
  devtool<span class="token operator">:</span> <span class="token string">&quot;cheap-module-eval-source-map&quot;</span><span class="token punctuation">,</span>
  devtool<span class="token operator">:</span> <span class="token string">&quot;cheap-eval-source-map&quot;</span><span class="token punctuation">,</span>
  devtool<span class="token operator">:</span> <span class="token string">&quot;eval&quot;</span><span class="token punctuation">,</span>
  devtool<span class="token operator">:</span> <span class="token string">&quot;cheap-source-map&quot;</span><span class="token punctuation">,</span>
  devtool<span class="token operator">:</span> <span class="token string">&quot;cheap-module-source-map&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_6-3-4-组合规则"><a href="#_6-3-4-组合规则" class="header-anchor">#</a> 6.3.4 组合规则</h4> <ul><li>[inline-|hidden-|eval-][nosources-][cheap-[module-]]source-map</li> <li>source-map 单独在外部生成完整的 sourcemap 文件，并且在目标文件里建立关联,能提示错误代码的准确原始位置</li> <li>inline-source-map 以 base64 格式内联在打包后的文件中，内联构建速度更快,也能提示错误代码的准确原始位置</li> <li>hidden-source-map 会在外部生成 sourcemap 文件,但是在目标文件里没有建立关联,不能提示错误代码的准确原始位置</li> <li>eval-source-map 会为每一个模块生成一个单独的 sourcemap 文件进行内联，并使用<code>eval</code>执行</li> <li>nosources-source-map 也会在外部生成 sourcemap 文件,能找到源始代码位置，但源代码内容为空</li> <li>cheap-source-map 外部生成 sourcemap 文件,不包含列和 loader 的 map</li> <li>cheap-module-source-map 外部生成 sourcemap 文件,不包含列的信息但包含 loader 的 map</li></ul> <h4 id="_6-3-5-最佳实践"><a href="#_6-3-5-最佳实践" class="header-anchor">#</a> 6.3.5 最佳实践</h4> <h5 id="_6-3-5-1-开发环境"><a href="#_6-3-5-1-开发环境" class="header-anchor">#</a> 6.3.5.1 开发环境</h5> <ul><li>我们在开发环境对 sourceMap 的要求是：速度快，调试更友好</li> <li>要想速度快 推荐 <code>eval-cheap-source-map</code></li> <li>如果想调试更友好 <code>cheap-module-source-map</code></li> <li>折中的选择就是 <code>eval-source-map</code></li></ul> <h5 id="_6-3-5-2-生产环境"><a href="#_6-3-5-2-生产环境" class="header-anchor">#</a> 6.3.5.2 生产环境</h5> <ul><li>首先排除内联，因为一方面我们为了隐藏源代码，另一方面要减少文件体积</li> <li>要想调试友好 <code>sourcemap&gt;cheap-source-map/cheap-module-source-map&gt;hidden-source-map/nosources-sourcemap</code></li> <li>要想速度快 优先选择<code>cheap</code></li> <li>折中的选择就是 <code>hidden-source-map</code></li></ul> <h4 id="_6-3-6-调试代码"><a href="#_6-3-6-调试代码" class="header-anchor">#</a> 6.3.6 调试代码</h4> <h5 id="_6-3-6-1-测试环境调试"><a href="#_6-3-6-1-测试环境调试" class="header-anchor">#</a> 6.3.6.1 测试环境调试</h5> <ul><li><p>source-map-dev-tool-plugin</p> <p>实现了对 source map 生成，进行更细粒度的控制</p> <ul><li>filename (string)：定义生成的 source map 的名称（如果没有值将会变成 inlined）。</li> <li>append (string)：在原始资源后追加给定值。通常是 #sourceMappingURL 注释。[url] 被替换成 source map 文件的 URL</li></ul></li> <li><p>市面上流行两种形式的文件指定，分别是以 <code>@</code> 和 <code>#</code>符号开头的,<code>@</code>开头的已经被废弃</p></li></ul> <p><img src="http://img.zhufengpeixun.cn/enablesourcemap.png" alt="enablesourcemap"></p> <p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> OptimizeCssAssetsWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-css-assets-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> FileManagerPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'filemanager-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
  devtool<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    minimize<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    publicPath<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    contentBase<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    compress<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>
    open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.jsx?$/</span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token string">'eslint-loader'</span><span class="token punctuation">,</span>
        enforce<span class="token operator">:</span> <span class="token string">'pre'</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span> fix<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.jsx?$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">{</span>
          loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span> <span class="token punctuation">{</span>
            presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>
              <span class="token string">'@babel/preset-env'</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span>
                useBuiltIns<span class="token operator">:</span> <span class="token string">'usage'</span><span class="token punctuation">,</span> <span class="token comment">// 按需要加载polyfill</span>
                corejs<span class="token operator">:</span> <span class="token punctuation">{</span>
                  version<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 指定core-js版本</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                targets<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 指定要兼容到哪些版本的浏览器</span>
                  chrome<span class="token operator">:</span> <span class="token string">'60'</span><span class="token punctuation">,</span>
                  firefox<span class="token operator">:</span> <span class="token string">'60'</span><span class="token punctuation">,</span>
                  ie<span class="token operator">:</span> <span class="token string">'9'</span><span class="token punctuation">,</span>
                  safari<span class="token operator">:</span> <span class="token string">'10'</span><span class="token punctuation">,</span>
                  edge<span class="token operator">:</span> <span class="token string">'17'</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'@babel/preset-react'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">[</span><span class="token string">'@babel/plugin-proposal-decorators'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> legacy<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">[</span><span class="token string">'@babel/plugin-proposal-class-properties'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> loose<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.txt$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token string">'raw-loader'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.less$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">,</span> <span class="token string">'less-loader'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.scss$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">,</span> <span class="token string">'sass-loader'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.(jpg|png|bmp|gif|svg)$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
          loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span> <span class="token punctuation">{</span>
            esModule<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span> <span class="token string">'[hash:10].[ext]'</span><span class="token punctuation">,</span>
            limit<span class="token operator">:</span> <span class="token number">8</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>
            outputPath<span class="token operator">:</span> <span class="token string">'images'</span><span class="token punctuation">,</span>
            publicPath<span class="token operator">:</span> <span class="token string">'/images'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.html$/</span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token string">'html-loader'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>
      minify<span class="token operator">:</span> <span class="token punctuation">{</span>
        collapseWhitespace<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        removeComments<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">'css/[name].css'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">OptimizeCssAssetsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token operator">+</span>    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>SourceMapDevToolPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
<span class="token operator">+</span>      append<span class="token operator">:</span> <span class="token string">'\n//# sourceMappingURL=http://127.0.0.1:8081/[url]'</span><span class="token punctuation">,</span>
<span class="token operator">+</span>      filename<span class="token operator">:</span> <span class="token string">'[file].map'</span><span class="token punctuation">,</span>
<span class="token operator">+</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token operator">+</span>    <span class="token keyword">new</span> <span class="token class-name">FileManagerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
<span class="token operator">+</span>      events<span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>        onEnd<span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>          copy<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
<span class="token operator">+</span>            source<span class="token operator">:</span> <span class="token string">'./dist/*.map'</span><span class="token punctuation">,</span>
<span class="token operator">+</span>            destination<span class="token operator">:</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span>
<span class="token operator">+</span>          <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token operator">+</span>          <span class="token keyword">delete</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./dist/*.map'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token operator">+</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token operator">+</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token operator">+</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_6-3-6-2-生产环境调试"><a href="#_6-3-6-2-生产环境调试" class="header-anchor">#</a> 6.3.6.2 生产环境调试</h5> <ul><li>webpack 打包仍然生成 sourceMap，但是将 map 文件挑出放到本地服务器，将不含有 map 文件的部署到服务器</li></ul> <p><img src="https://img.zhufengpeixun.com/addsourcemapfile.png" alt="addsourcemapfile.png"></p> <h3 id="_6-4-hash、chunkhash-和-contenthash"><a href="#_6-4-hash、chunkhash-和-contenthash" class="header-anchor">#</a> 6.4 hash、chunkhash 和 contenthash</h3> <ul><li><code>文件指纹</code>是指<strong>打包后输出的文件名和后缀</strong></li> <li>hash 一般是结合 CDN 缓存来使用，通过 webpack 构建之后，生成对应文件名自动带上对应的 MD5 值。<strong>如果文件内容改变的话，那么对应文件哈希值也会改变，对应的 HTML 引用的 URL 地址也会改变，触发 CDN 服务器从源服务器上拉取对应数据，进而更新本地缓存</strong>。</li></ul> <p>指纹占位符</p> <table><thead><tr><th style="text-align:left;">占位符名称</th> <th style="text-align:left;">含义</th></tr></thead> <tbody><tr><td style="text-align:left;">ext</td> <td style="text-align:left;">资源后缀名</td></tr> <tr><td style="text-align:left;">name</td> <td style="text-align:left;">文件名称</td></tr> <tr><td style="text-align:left;">path</td> <td style="text-align:left;">文件的相对路径</td></tr> <tr><td style="text-align:left;">folder</td> <td style="text-align:left;">文件所在的文件夹</td></tr> <tr><td style="text-align:left;">hash</td> <td style="text-align:left;">每次 webpack 构建时生成一个唯一的 hash 值</td></tr> <tr><td style="text-align:left;">chunkhash</td> <td style="text-align:left;">根据 chunk 生成 hash 值，来源于同一个 chunk，则 hash 值就一样</td></tr> <tr><td style="text-align:left;">contenthash</td> <td style="text-align:left;">根据内容生成 hash 值，文件内容相同 hash 值就相同</td></tr></tbody></table> <h4 id="_6-4-1-hash-计算"><a href="#_6-4-1-hash-计算" class="header-anchor">#</a> 6.4.1 hash 计算</h4> <p><img src="https://img.zhufengpeixun.com/variableHashs.jpg" alt="variableHashs.jpg"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;crypto&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createHash</span><span class="token punctuation">(</span><span class="token string">&quot;md5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> entry <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry1<span class="token operator">:</span> <span class="token string">&quot;entry1&quot;</span><span class="token punctuation">,</span>
  entry2<span class="token operator">:</span> <span class="token string">&quot;entry2&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> entry1 <span class="token operator">=</span> <span class="token string">&quot;require depModule1&quot;</span><span class="token punctuation">;</span> <span class="token comment">//模块entry1</span>
<span class="token keyword">let</span> entry2 <span class="token operator">=</span> <span class="token string">&quot;require depModule2&quot;</span><span class="token punctuation">;</span> <span class="token comment">//模块entry2</span>

<span class="token keyword">let</span> depModule1 <span class="token operator">=</span> <span class="token string">&quot;depModule1&quot;</span><span class="token punctuation">;</span> <span class="token comment">//模块depModule1</span>
<span class="token keyword">let</span> depModule2 <span class="token operator">=</span> <span class="token string">&quot;depModule2&quot;</span><span class="token punctuation">;</span> <span class="token comment">//模块depModule2</span>
<span class="token comment">//如果都使用hash的话，因为这是工程级别的，即每次修改任何一个文件，所有文件名的hash至都将改变。所以一旦修改了任何一个文件，整个项目的文件缓存都将失效</span>
<span class="token keyword">let</span> hash <span class="token operator">=</span> <span class="token function">createHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>entry1<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>entry2<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>depModule1<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>depModule2<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">&quot;hex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//chunkhash根据不同的入口文件(Entry)进行依赖文件解析、构建对应的chunk，生成对应的哈希值。</span>
<span class="token comment">//在生产环境里把一些公共库和程序入口文件区分开，单独打包构建，接着我们采用chunkhash的方式生成哈希值，那么只要我们不改动公共库的代码，就可以保证其哈希值不会受影响</span>
<span class="token keyword">let</span> entry1ChunkHash <span class="token operator">=</span> <span class="token function">createHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>entry1<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>depModule1<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">&quot;hex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;entry1ChunkHash&quot;</span><span class="token punctuation">,</span> entry1ChunkHash<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> entry2ChunkHash <span class="token operator">=</span> <span class="token function">createHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>entry2<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>depModule2<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">&quot;hex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;entry2ChunkHash&quot;</span><span class="token punctuation">,</span> entry2ChunkHash<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> entry1File <span class="token operator">=</span> entry1 <span class="token operator">+</span> depModule1<span class="token punctuation">;</span>
<span class="token keyword">let</span> entry1ContentHash <span class="token operator">=</span> <span class="token function">createHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>entry1File<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">&quot;hex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;entry1ContentHash&quot;</span><span class="token punctuation">,</span> entry1ContentHash<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> entry2File <span class="token operator">=</span> entry2 <span class="token operator">+</span> depModule2<span class="token punctuation">;</span>
<span class="token keyword">let</span> entry2ContentHash <span class="token operator">=</span> <span class="token function">createHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>entry2File<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">&quot;hex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;entry2ContentHash&quot;</span><span class="token punctuation">,</span> entry2ContentHash<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_6-4-2-hash"><a href="#_6-4-2-hash" class="header-anchor">#</a> 6.4.2 hash</h4> <ul><li>Hash 是整个项目的 hash 值，其根据每次编译内容计算得到，<strong>每次编译之后都会生成新的 hash,即修改任何文件都会导致所有文件的 hash 发生改变</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    main<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    vender<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'lodash'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span><span class="token punctuation">{</span>
     path<span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span><span class="token string">'[name].[hash].js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">&quot;css/[name].[hash].css&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_6-4-2-chunkhash"><a href="#_6-4-2-chunkhash" class="header-anchor">#</a> 6.4.2 chunkhash</h4> <ul><li>chunkhash, <strong>采用 hash 计算的话，每一次构建后生成的哈希值都不一样，即使文件内容压根没有改变。这样子是没办法实现缓存效果</strong>，我们需要换另一种哈希值计算方式，即 chunkhash</li> <li>chunkhash 和 hash 不一样，它根据<strong>不同的入口文件(Entry)进行依赖文件解析、构建对应的 chunk，生成对应的哈希值</strong>。我们在生产环境里把一些公共库和程序入口文件区分开，单独打包构建，接着我们采用 chunkhash 的方式生成哈希值，那么只要我们不改动公共库的代码，就可以保证其哈希值不会受影响</li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code>module.exports = {
<span class="token unchanged">  entry: {
    main: './src/index.js',
    vender:['lodash']
  },
  output:{
    path:path.resolve(__dirname,'dist'),
    filename:'[name].[chunkhash].js'
  },
  plugins: [
    new MiniCssExtractPlugin({
      filename: &quot;css/[name].[chunkhash].css&quot;
    })
  ]
</span>};
</code></pre></div><h4 id="_6-4-3-contenthash"><a href="#_6-4-3-contenthash" class="header-anchor">#</a> 6.4.3 contenthash</h4> <ul><li>使用 chunkhash 存在一个问题，就是当在一个 JS 文件中引入 CSS 文件，编译后它们的 hash 是相同的，而且只要 js 文件发生改变 ，关联的 css 文件 hash 也会改变,这个时候可以使用<code>mini-css-extract-plugin</code>里的<code>contenthash</code>值，<strong>保证即使 css 文件所处的模块里就算其他文件内容改变，只要 css 文件内容不变，那么不会重复构建</strong></li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code>module.exports = {
<span class="token unchanged">  plugins: [
    new MiniCssExtractPlugin({
</span><span class="token inserted-sign inserted">+      filename: &quot;css/[name].[contenthash].css&quot;
</span><span class="token unchanged">    })
  ],
</span>};
</code></pre></div><h2 id="最后"><a href="#最后" class="header-anchor">#</a> 最后</h2> <p>文中若有不准确或错误的地方，欢迎指出，有兴趣可以的关注下<a href="https://github.com/GolderBrother" target="_blank" rel="noopener noreferrer">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>~</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2020/12/5 下午5:50:45</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/views/webpack/webpack1.html" class="prev">一大波 Webpack 面试题来啦~</a></span> <span class="next"><a href="/blog/views/cors/corssOrigin-pro.html">10 种跨域解决方案（附终极方案）</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.74817549.js" defer></script><script src="/blog/assets/js/2.f761193d.js" defer></script><script src="/blog/assets/js/181.326c1f42.js" defer></script>
  </body>
</html>
