<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <!-- 为了可以访问第三方图床的图片，才添加了这句代码，如果你的图片是存在本地的，去掉这句代码即可 -->
    <meta id="referrer" name="referrer" content="never" />
    <!-- <meta id="referrer" name="referrer" content="always" /> -->
    <title>Nginx 从入门到实践，万字详解！ | 全栈修炼</title>
    <meta name="description" content="GolderBrother的博客" />
    <link rel="icon" href="/blog/assets/favicon.ico">  <link rel="preload" href="/blog/assets/css/0.styles.2dde6c16.css" as="style"><link rel="preload" href="/blog/assets/js/app.74817549.js" as="script"><link rel="preload" href="/blog/assets/js/2.f761193d.js" as="script"><link rel="preload" href="/blog/assets/js/5.cc289552.js" as="script"><link rel="preload" href="/blog/assets/js/23.dbb39e0a.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.ea66aff3.js"><link rel="prefetch" href="/blog/assets/js/100.1650309e.js"><link rel="prefetch" href="/blog/assets/js/101.dd5cdc51.js"><link rel="prefetch" href="/blog/assets/js/102.81a755d8.js"><link rel="prefetch" href="/blog/assets/js/103.84d1e041.js"><link rel="prefetch" href="/blog/assets/js/104.6bb79eda.js"><link rel="prefetch" href="/blog/assets/js/105.ac0fa491.js"><link rel="prefetch" href="/blog/assets/js/106.e7f21162.js"><link rel="prefetch" href="/blog/assets/js/107.a932b9dd.js"><link rel="prefetch" href="/blog/assets/js/108.08337848.js"><link rel="prefetch" href="/blog/assets/js/109.0a8ac1ac.js"><link rel="prefetch" href="/blog/assets/js/11.2b17f742.js"><link rel="prefetch" href="/blog/assets/js/110.63f713ce.js"><link rel="prefetch" href="/blog/assets/js/111.3ded28af.js"><link rel="prefetch" href="/blog/assets/js/112.feb77183.js"><link rel="prefetch" href="/blog/assets/js/113.ca7a3dfe.js"><link rel="prefetch" href="/blog/assets/js/114.278aaabb.js"><link rel="prefetch" href="/blog/assets/js/115.3f930fa5.js"><link rel="prefetch" href="/blog/assets/js/116.0686a02f.js"><link rel="prefetch" href="/blog/assets/js/117.22090497.js"><link rel="prefetch" href="/blog/assets/js/118.d7f089fa.js"><link rel="prefetch" href="/blog/assets/js/119.3c8db627.js"><link rel="prefetch" href="/blog/assets/js/12.d4feb8d0.js"><link rel="prefetch" href="/blog/assets/js/120.e516c49a.js"><link rel="prefetch" href="/blog/assets/js/121.d702cc4d.js"><link rel="prefetch" href="/blog/assets/js/122.13d4f773.js"><link rel="prefetch" href="/blog/assets/js/123.6905c46b.js"><link rel="prefetch" href="/blog/assets/js/124.ccac9465.js"><link rel="prefetch" href="/blog/assets/js/125.3fad187d.js"><link rel="prefetch" href="/blog/assets/js/126.065c2aad.js"><link rel="prefetch" href="/blog/assets/js/127.d4aef2ae.js"><link rel="prefetch" href="/blog/assets/js/128.00766f11.js"><link rel="prefetch" href="/blog/assets/js/129.51d245ca.js"><link rel="prefetch" href="/blog/assets/js/13.21c8139a.js"><link rel="prefetch" href="/blog/assets/js/130.82b8009d.js"><link rel="prefetch" href="/blog/assets/js/131.fb8da159.js"><link rel="prefetch" href="/blog/assets/js/132.2484fde1.js"><link rel="prefetch" href="/blog/assets/js/133.177fe1b1.js"><link rel="prefetch" href="/blog/assets/js/134.5611fa2b.js"><link rel="prefetch" href="/blog/assets/js/135.4d1053c3.js"><link rel="prefetch" href="/blog/assets/js/136.2973975f.js"><link rel="prefetch" href="/blog/assets/js/137.7c44ba09.js"><link rel="prefetch" href="/blog/assets/js/138.16973a68.js"><link rel="prefetch" href="/blog/assets/js/139.2f797054.js"><link rel="prefetch" href="/blog/assets/js/14.8cf70ab3.js"><link rel="prefetch" href="/blog/assets/js/140.f94ba770.js"><link rel="prefetch" href="/blog/assets/js/141.69f9800f.js"><link rel="prefetch" href="/blog/assets/js/142.b567c447.js"><link rel="prefetch" href="/blog/assets/js/143.f1ee0ada.js"><link rel="prefetch" href="/blog/assets/js/144.138163b4.js"><link rel="prefetch" href="/blog/assets/js/145.e3bee357.js"><link rel="prefetch" href="/blog/assets/js/146.3a9fd8c7.js"><link rel="prefetch" href="/blog/assets/js/147.0b8e88a6.js"><link rel="prefetch" href="/blog/assets/js/148.81da2cf3.js"><link rel="prefetch" href="/blog/assets/js/149.d44d0121.js"><link rel="prefetch" href="/blog/assets/js/15.ea38d450.js"><link rel="prefetch" href="/blog/assets/js/150.7665d423.js"><link rel="prefetch" href="/blog/assets/js/151.1ab5f781.js"><link rel="prefetch" href="/blog/assets/js/152.620db4ac.js"><link rel="prefetch" href="/blog/assets/js/153.695d756f.js"><link rel="prefetch" href="/blog/assets/js/154.ee82e0a2.js"><link rel="prefetch" href="/blog/assets/js/155.d7bc8987.js"><link rel="prefetch" href="/blog/assets/js/156.95cf0d01.js"><link rel="prefetch" href="/blog/assets/js/157.76159f7e.js"><link rel="prefetch" href="/blog/assets/js/158.e27d7f12.js"><link rel="prefetch" href="/blog/assets/js/159.84d58dcb.js"><link rel="prefetch" href="/blog/assets/js/16.7794197c.js"><link rel="prefetch" href="/blog/assets/js/160.44f17ac0.js"><link rel="prefetch" href="/blog/assets/js/161.a9fc1420.js"><link rel="prefetch" href="/blog/assets/js/162.953ffb8f.js"><link rel="prefetch" href="/blog/assets/js/163.d4b64d04.js"><link rel="prefetch" href="/blog/assets/js/164.d718bdc2.js"><link rel="prefetch" href="/blog/assets/js/165.464562ce.js"><link rel="prefetch" href="/blog/assets/js/166.3486924a.js"><link rel="prefetch" href="/blog/assets/js/167.044ce06a.js"><link rel="prefetch" href="/blog/assets/js/168.81e22c48.js"><link rel="prefetch" href="/blog/assets/js/169.4c4a576c.js"><link rel="prefetch" href="/blog/assets/js/17.7083b50c.js"><link rel="prefetch" href="/blog/assets/js/170.4b71dfab.js"><link rel="prefetch" href="/blog/assets/js/171.d2051e87.js"><link rel="prefetch" href="/blog/assets/js/172.eeb81923.js"><link rel="prefetch" href="/blog/assets/js/173.aafb24fa.js"><link rel="prefetch" href="/blog/assets/js/174.2e261a79.js"><link rel="prefetch" href="/blog/assets/js/175.aafd75a2.js"><link rel="prefetch" href="/blog/assets/js/176.b7681070.js"><link rel="prefetch" href="/blog/assets/js/177.e9bdb5f5.js"><link rel="prefetch" href="/blog/assets/js/178.4a3ca305.js"><link rel="prefetch" href="/blog/assets/js/179.40201a86.js"><link rel="prefetch" href="/blog/assets/js/18.3dbb7741.js"><link rel="prefetch" href="/blog/assets/js/180.68c6346e.js"><link rel="prefetch" href="/blog/assets/js/181.326c1f42.js"><link rel="prefetch" href="/blog/assets/js/182.92780c32.js"><link rel="prefetch" href="/blog/assets/js/183.65f40b5a.js"><link rel="prefetch" href="/blog/assets/js/19.78fd69da.js"><link rel="prefetch" href="/blog/assets/js/20.be39648e.js"><link rel="prefetch" href="/blog/assets/js/21.80a318b4.js"><link rel="prefetch" href="/blog/assets/js/22.4040efb3.js"><link rel="prefetch" href="/blog/assets/js/24.f27f8467.js"><link rel="prefetch" href="/blog/assets/js/25.448302be.js"><link rel="prefetch" href="/blog/assets/js/26.78106ffa.js"><link rel="prefetch" href="/blog/assets/js/27.2a65554d.js"><link rel="prefetch" href="/blog/assets/js/28.55501022.js"><link rel="prefetch" href="/blog/assets/js/29.af733838.js"><link rel="prefetch" href="/blog/assets/js/3.df759ff3.js"><link rel="prefetch" href="/blog/assets/js/30.8ce1d72b.js"><link rel="prefetch" href="/blog/assets/js/31.7925ec43.js"><link rel="prefetch" href="/blog/assets/js/32.f9892d98.js"><link rel="prefetch" href="/blog/assets/js/33.afd7fd02.js"><link rel="prefetch" href="/blog/assets/js/34.ee49fe13.js"><link rel="prefetch" href="/blog/assets/js/35.0e4f5335.js"><link rel="prefetch" href="/blog/assets/js/36.96311e99.js"><link rel="prefetch" href="/blog/assets/js/37.fb3163b1.js"><link rel="prefetch" href="/blog/assets/js/38.778ed95b.js"><link rel="prefetch" href="/blog/assets/js/39.0531a2e1.js"><link rel="prefetch" href="/blog/assets/js/4.bb581d32.js"><link rel="prefetch" href="/blog/assets/js/40.ec9153c6.js"><link rel="prefetch" href="/blog/assets/js/41.2e9e71db.js"><link rel="prefetch" href="/blog/assets/js/42.af718b8a.js"><link rel="prefetch" href="/blog/assets/js/43.7a4efaa6.js"><link rel="prefetch" href="/blog/assets/js/44.21916db9.js"><link rel="prefetch" href="/blog/assets/js/45.c02e6427.js"><link rel="prefetch" href="/blog/assets/js/46.c95ab531.js"><link rel="prefetch" href="/blog/assets/js/47.d505fc9f.js"><link rel="prefetch" href="/blog/assets/js/48.9291572a.js"><link rel="prefetch" href="/blog/assets/js/49.79fd5fda.js"><link rel="prefetch" href="/blog/assets/js/50.40ff6888.js"><link rel="prefetch" href="/blog/assets/js/51.d16aa2b4.js"><link rel="prefetch" href="/blog/assets/js/52.4528f49d.js"><link rel="prefetch" href="/blog/assets/js/53.b16b42d4.js"><link rel="prefetch" href="/blog/assets/js/54.4fff7e01.js"><link rel="prefetch" href="/blog/assets/js/55.6832b1c5.js"><link rel="prefetch" href="/blog/assets/js/56.d16f1707.js"><link rel="prefetch" href="/blog/assets/js/57.de08e9ba.js"><link rel="prefetch" href="/blog/assets/js/58.6ca6f21b.js"><link rel="prefetch" href="/blog/assets/js/59.e518317a.js"><link rel="prefetch" href="/blog/assets/js/6.4efa9fa4.js"><link rel="prefetch" href="/blog/assets/js/60.935521f1.js"><link rel="prefetch" href="/blog/assets/js/61.ce9eda13.js"><link rel="prefetch" href="/blog/assets/js/62.e6c745bf.js"><link rel="prefetch" href="/blog/assets/js/63.647fd8d7.js"><link rel="prefetch" href="/blog/assets/js/64.4c9b4781.js"><link rel="prefetch" href="/blog/assets/js/65.80857907.js"><link rel="prefetch" href="/blog/assets/js/66.b89b796a.js"><link rel="prefetch" href="/blog/assets/js/67.b9798c32.js"><link rel="prefetch" href="/blog/assets/js/68.49b67f24.js"><link rel="prefetch" href="/blog/assets/js/69.665837ff.js"><link rel="prefetch" href="/blog/assets/js/7.b94332e9.js"><link rel="prefetch" href="/blog/assets/js/70.ce57ed8e.js"><link rel="prefetch" href="/blog/assets/js/71.71ae5067.js"><link rel="prefetch" href="/blog/assets/js/72.69c7c32d.js"><link rel="prefetch" href="/blog/assets/js/73.6b47b8f7.js"><link rel="prefetch" href="/blog/assets/js/74.bd6cd299.js"><link rel="prefetch" href="/blog/assets/js/75.297a83bc.js"><link rel="prefetch" href="/blog/assets/js/76.e49268ee.js"><link rel="prefetch" href="/blog/assets/js/77.6efa828f.js"><link rel="prefetch" href="/blog/assets/js/78.c38cb032.js"><link rel="prefetch" href="/blog/assets/js/79.478e1642.js"><link rel="prefetch" href="/blog/assets/js/8.80c6038b.js"><link rel="prefetch" href="/blog/assets/js/80.ff9e57e9.js"><link rel="prefetch" href="/blog/assets/js/81.e3dbf4d0.js"><link rel="prefetch" href="/blog/assets/js/82.270df640.js"><link rel="prefetch" href="/blog/assets/js/83.3bc7036f.js"><link rel="prefetch" href="/blog/assets/js/84.a3ccc99e.js"><link rel="prefetch" href="/blog/assets/js/85.7cdab723.js"><link rel="prefetch" href="/blog/assets/js/86.9f0c2ccd.js"><link rel="prefetch" href="/blog/assets/js/87.b7e93260.js"><link rel="prefetch" href="/blog/assets/js/88.557a99bb.js"><link rel="prefetch" href="/blog/assets/js/89.16a0d8d1.js"><link rel="prefetch" href="/blog/assets/js/9.4fbaf7a8.js"><link rel="prefetch" href="/blog/assets/js/90.52190781.js"><link rel="prefetch" href="/blog/assets/js/91.b9507740.js"><link rel="prefetch" href="/blog/assets/js/92.c0eb92c0.js"><link rel="prefetch" href="/blog/assets/js/93.ca3ba1d1.js"><link rel="prefetch" href="/blog/assets/js/94.a8ffcee7.js"><link rel="prefetch" href="/blog/assets/js/95.23fe688e.js"><link rel="prefetch" href="/blog/assets/js/96.b5d64bc6.js"><link rel="prefetch" href="/blog/assets/js/97.c41d4d64.js"><link rel="prefetch" href="/blog/assets/js/98.c415501d.js"><link rel="prefetch" href="/blog/assets/js/99.ab069b22.js"> <link rel="stylesheet" href="/blog/assets/css/0.styles.2dde6c16.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/assets/logo.jpg" alt="全栈修炼" class="logo"> <span class="site-name can-hide">全栈修炼</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/guide/" class="nav-link">主页</a></div><div class="nav-item"><a href="/blog/views/" class="nav-link router-link-active">大前端</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/views/nginx/nginx-details.html" class="nav-link router-link-exact-active router-link-active">zh-CN</a></li><li class="dropdown-item"><!----> <a href="/blog/en/" class="nav-link">en-US</a></li></ul></div></div> <a href="https://github.com/GolderBrother/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/guide/" class="nav-link">主页</a></div><div class="nav-item"><a href="/blog/views/" class="nav-link router-link-active">大前端</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/views/nginx/nginx-details.html" class="nav-link router-link-exact-active router-link-active">zh-CN</a></li><li class="dropdown-item"><!----> <a href="/blog/en/" class="nav-link">en-US</a></li></ul></div></div> <a href="https://github.com/GolderBrother/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/blog/views/" class="sidebar-link">大前端知识大集合</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>GitHub 软技能</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/github/follow.html" class="sidebar-link">GitHub 挖宝技巧</a></li><li><a href="/blog/views/github/star.html" class="sidebar-link">GitHub 吸星大法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>浏览器工作原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/browser/input-url-course.html" class="sidebar-link">导航流程：从输入 URL 到页面展示，这中间发生了什么</a></li><li><a href="/blog/views/browser/dom-bind-event.html" class="sidebar-link">一个DOM元素绑定多个事件时，先执行冒泡还是捕获</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>css</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/css/css-skills1.html" class="sidebar-link">10 个让你受益匪浅的 css 使用技巧</a></li><li><a href="/blog/views/css/css-knowledge.html" class="sidebar-link">你未必知道的 49 个 CSS 知识点</a></li><li><a href="/blog/views/css/css-knowledge2.html" class="sidebar-link">你未必知道的 49 个 CSS 知识点二~</a></li><li><a href="/blog/views/css/css-center.html" class="sidebar-link">一起搞懂 CSS 水平居中与垂直居中的 16 个方法</a></li><li><a href="/blog/views/css/css-flex.html" class="sidebar-link">弹性盒子中 flex: 0 1 auto 表示什么意思</a></li><li><a href="/blog/views/css/css-BFC.html" class="sidebar-link">CSS 中的 BFC 详解</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>移动端h5</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/h5/h5-demo1.html" class="sidebar-link">移动端 H5 和 Hybrid 相关基础技术概览</a></li><li><a href="/blog/views/mobile/mobile-skill.html" class="sidebar-link">总结移动端 H5 开发常用技巧</a></li><li><a href="/blog/views/mobile/mobile-optmization.html" class="sidebar-link">关于移动端体验优化经验总结</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Javascript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/javascript/js-skills.html" class="sidebar-link">你可能不知道的 JS 开发技巧</a></li><li><a href="/blog/views/javascript/js-skills2.html" class="sidebar-link">一个合格的中级前端er需要掌握的 28 个 JavaScript 技巧</a></li><li><a href="/blog/views/javascript/js-utils.html" class="sidebar-link">书到用时方恨少，一大波 JS 开发工具函数来了</a></li><li><a href="/blog/views/javascript/js-utils2.html" class="sidebar-link">前端常用的 60 余种工具方法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Typescript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/typescript/ts-demo.html" class="sidebar-link">TypeScript 高级用法详解</a></li><li><a href="/blog/views/typescript/ts-difficult.html" class="sidebar-link">TypeScript 重难点梳理</a></li><li><a href="/blog/views/typescript/ts-problem.html" class="sidebar-link">TS 常见问题整理（60 多个）</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue.js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/vue/vue-ts.html" class="sidebar-link">Vue + TS + El 搭建博客及踩坑记</a></li><li><a href="/blog/views/vue/vue-lazyload.html" class="sidebar-link">vue 路由懒加载及组件懒加载</a></li><li><a href="/blog/views/vue/vue-skills-36.html" class="sidebar-link">Vue 开发必须知道的 36 个技巧</a></li><li><a href="/blog/views/vue/vue-interview.html" class="sidebar-link">30 道 Vue 面试题，内含详细讲解（涵盖入门到精通，自测 Vue 掌握程度）</a></li><li><a href="/blog/views/vue/vue-interview/part-one/note.html" class="sidebar-link">Vue 面试题汇总</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React.js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/react/react-hooks.html" class="sidebar-link">React Hooks 相关 API 总结</a></li><li><a href="/blog/views/react/react-lifecycle.html" class="sidebar-link">React v16.0 前的生命周期</a></li><li><a href="/blog/views/react/react-skill.html" class="sidebar-link">5 个技巧助你编写更好的 React 代码</a></li><li><a href="/blog/views/react/react-nice-library.html" class="sidebar-link">5 个很棒的 React.js 库，值得你亲手试试！</a></li><li><a href="/blog/views/react/react-interview.html" class="sidebar-link">35 道咱们必须要清楚的 React 面试题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React-Native</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/react-native/RN&amp;Native-message.html" class="sidebar-link">React Native 跟原生之间的通信</a></li><li><a href="/blog/views/react-native/ReactNative&amp;Flutter&amp;uni-app.html" class="sidebar-link">一、技术学习成本和难度</a></li><li><a href="/blog/views/react-native/ReactNative&amp;Flutter&amp;uni-app.html" class="sidebar-link">一、技术学习成本和难度</a></li><li><a href="/blog/views/react-native/codepush-config.html" class="sidebar-link">RN 配置热更新+使用文档</a></li><li><a href="/blog/views/react-native/codepush-deploy.html" class="sidebar-link">React Native + 热更新(Code Push) 部署文档</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/webpack/webpack1.html" class="sidebar-link">一大波 Webpack 面试题来啦~</a></li><li><a href="/blog/views/webpack/webpack-optimize.html" class="sidebar-link">webpack 优化篇</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端跨域相关</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/cors/corssOrigin-pro.html" class="sidebar-link">10 种跨域解决方案（附终极方案）</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>vite</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/vite/vite-study.html" class="sidebar-link">vite原理剖析</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>cli</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/cli/james-cli.html" class="sidebar-link">手撸一个自己的前端脚手架</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Node.js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/node/node1.html" class="sidebar-link">/views/node/node1.html</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端设计模式之美</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/fe-design/fe-design-9.html" class="sidebar-link">前端应知应会的 9 种设计模式(详细篇)</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端数据结构之美</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/data-structure/data-structure.html" class="sidebar-link">前端数据结构之美</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端算法学习指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/algorithms/sort.html" class="sidebar-link">十大经典算法</a></li><li><a href="/blog/views/algorithms/interview.html" class="sidebar-link">面试必刷-《剑指 offer》刷题小结</a></li><li><a href="/blog/views/algorithms/string.html" class="sidebar-link">字符串相关算法</a></li><li><a href="/blog/views/algorithms/array.html" class="sidebar-link">数组串相关算法</a></li><li><a href="/blog/views/algorithms/linklist.html" class="sidebar-link">链表相关算法题</a></li><li><a href="/blog/views/algorithms/tree.html" class="sidebar-link">二叉树相关算法</a></li><li><a href="/blog/views/algorithms/tencent/array&amp;string.html" class="sidebar-link">腾讯算法题-数组与字符串</a></li><li><a href="/blog/views/algorithms/tencent/number.html" class="sidebar-link">腾讯算法题-数学与数字</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端面试集锦</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/fe-interview/alibaba.html" class="sidebar-link">阿里面试题</a></li><li><a href="/blog/views/fe-interview/bytedance.html" class="sidebar-link">字节跳动面试题</a></li><li><a href="/blog/views/fe-interview/bytedance-algorithms.html" class="sidebar-link">字节跳动算法题</a></li><li><a href="/blog/views/fe-interview/tencent.html" class="sidebar-link">微信面试题</a></li><li><a href="/blog/views/fe-interview/classic-layout.html" class="sidebar-link">掌握两大经典布局方案</a></li><li><a href="/blog/views/fe-interview/web-safe.html" class="sidebar-link">谈谈 web 安全问题及解决方案</a></li><li><a href="/blog/views/fe-interview/http&amp;https.html" class="sidebar-link">http2/http3 协议有什么优劣</a></li><li><a href="/blog/views/fe-interview/webpack-performance-optimization.html" class="sidebar-link">Webpack 性能优化你知道哪些</a></li><li><a href="/blog/views/fe-interview/webpack-principle.html" class="sidebar-link">说说 webpack 打包的原理</a></li><li><a href="/blog/views/fe-interview/webpack-HMR.html" class="sidebar-link">HMR 的原理是什么</a></li><li><a href="/blog/views/fe-interview/chrome-start-process.html" class="sidebar-link">Chrome 打开一个页面需要启动多少进程？分别有哪些进程</a></li><li><a href="/blog/views/fe-interview/dns-prefetch.html" class="sidebar-link">谈谈你对 dns-prefetch 的理解</a></li><li><a href="/blog/views/fe-interview/browser-cache.html" class="sidebar-link">浏览器缓存一探究竟~</a></li><li><a href="/blog/views/fe-interview/send-content-to-browser.html" class="sidebar-link">如何保证页面文件能被完整送达浏览器</a></li><li><a href="/blog/views/fe-interview/browser-render.html" class="sidebar-link">浏览器渲染过程是怎样的</a></li><li><a href="/blog/views/fe-interview/browser-reflow&amp;repain.html" class="sidebar-link">如何理解回流和重绘</a></li><li><a href="/blog/views/fe-interview/renderEngine-createNewLayer.html" class="sidebar-link">渲染引擎什么情况下才会为特定的节点创建新的图层</a></li><li><a href="/blog/views/fe-interview/UDP&amp;TCP-different.html" class="sidebar-link">UDP 和 TCP 有什么区别</a></li><li><a href="/blog/views/fe-interview/js-modules.html" class="sidebar-link">说说 js 的模块化</a></li><li><a href="/blog/views/fe-interview/lazyMan.html" class="sidebar-link">实现一个 LazyMan，可以按照以下方式调用</a></li><li><a href="/blog/views/fe-interview/handwriting-promise.html" class="sidebar-link">少年，来，手写一个 Promise 吧</a></li><li><a href="/blog/views/fe-interview/fetch&amp;ajax-diference.html" class="sidebar-link">请说下 fetch 和 ajax 的区别吧</a></li><li><a href="/blog/views/fe-interview/browser-input-url.html" class="sidebar-link">细说浏览器输入 URL 后发生了什么</a></li><li><a href="/blog/views/fe-interview/picture-optimization.html" class="sidebar-link">前端的图片优化方案你知道多少</a></li><li><a href="/blog/views/fe-interview/node-eventLoop.html" class="sidebar-link">来，说说 node 的事件循环机制吧</a></li><li><a href="/blog/views/fe-interview/browser-eventLoop.html" class="sidebar-link">小伙子，谈谈浏览器端的事件循环吧</a></li><li><a href="/blog/views/fe-interview/setTimeout&amp;setImmediate.html" class="sidebar-link">node中的setTimeout 和 setImmediate有什么区别</a></li><li><a href="/blog/views/fe-interview/js-interview.html" class="sidebar-link">收集一些 javascript 相关的面试题</a></li><li><a href="/blog/views/fe-interview/fuck-interview.html" class="sidebar-link">那些恶心的面试题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端必知必会的网络基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/network/http-interview.html" class="sidebar-link">HTTP 灵魂之问，巩固你的 HTTP 知识体系</a></li><li><a href="/blog/views/network/tcp-interview.html" class="sidebar-link">TCP 协议灵魂之问，巩固你的网络底层基础</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端应知应会的Nginx知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/nginx/nginx-details.html" class="active sidebar-link">Nginx 从入门到实践，万字详解！</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/views/nginx/nginx-details.html#_1-nginx-介绍" class="sidebar-link">1. Nginx 介绍</a></li><li class="sidebar-sub-header"><a href="/blog/views/nginx/nginx-details.html#_2-相关概念" class="sidebar-link">2. 相关概念</a></li><li class="sidebar-sub-header"><a href="/blog/views/nginx/nginx-details.html#_3-nginx-快速安装" class="sidebar-link">3. Nginx 快速安装</a></li><li class="sidebar-sub-header"><a href="/blog/views/nginx/nginx-details.html#_4-nginx-操作常用命令" class="sidebar-link">4. Nginx 操作常用命令</a></li><li class="sidebar-sub-header"><a href="/blog/views/nginx/nginx-details.html#_5-nginx-配置语法" class="sidebar-link">5. Nginx 配置语法</a></li><li class="sidebar-sub-header"><a href="/blog/views/nginx/nginx-details.html#_6-设置二级域名虚拟主机" class="sidebar-link">6. 设置二级域名虚拟主机</a></li><li class="sidebar-sub-header"><a href="/blog/views/nginx/nginx-details.html#_7-配置反向代理" class="sidebar-link">7. 配置反向代理</a></li><li class="sidebar-sub-header"><a href="/blog/views/nginx/nginx-details.html#_8-跨域-cors-配置" class="sidebar-link">8. 跨域 CORS 配置</a></li><li class="sidebar-sub-header"><a href="/blog/views/nginx/nginx-details.html#_9-开启-gzip-压缩" class="sidebar-link">9. 开启 gzip 压缩</a></li><li class="sidebar-sub-header"><a href="/blog/views/nginx/nginx-details.html#_10-配置负载均衡" class="sidebar-link">10. 配置负载均衡</a></li><li class="sidebar-sub-header"><a href="/blog/views/nginx/nginx-details.html#_11-配置动静分离" class="sidebar-link">11. 配置动静分离</a></li><li class="sidebar-sub-header"><a href="/blog/views/nginx/nginx-details.html#_12-配置高可用集群（双机热备）" class="sidebar-link">12. 配置高可用集群（双机热备）</a></li><li class="sidebar-sub-header"><a href="/blog/views/nginx/nginx-details.html#_13-适配-pc-或移动设备" class="sidebar-link">13. 适配 PC 或移动设备</a></li><li class="sidebar-sub-header"><a href="/blog/views/nginx/nginx-details.html#_14-配置-https" class="sidebar-link">14. 配置 HTTPS</a></li><li class="sidebar-sub-header"><a href="/blog/views/nginx/nginx-details.html#_15-一些常用技巧" class="sidebar-link">15. 一些常用技巧</a></li><li class="sidebar-sub-header"><a href="/blog/views/nginx/nginx-details.html#_16-最佳实践" class="sidebar-link">16. 最佳实践</a></li><li class="sidebar-sub-header"><a href="/blog/views/nginx/nginx-details.html#参考文档" class="sidebar-link">参考文档</a></li><li class="sidebar-sub-header"><a href="/blog/views/nginx/nginx-details.html#最后" class="sidebar-link">最后</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端必不可少的git知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/git/git-command-animation.html" class="sidebar-link">相见恨晚的 Git 命令动画演示，一看就懂！</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端性能优化专题，让你的网站飞起来吧</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/performance/code-split.html" class="sidebar-link">项目不知道如何做性能优化？不妨试试代码分割吧</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端高手进阶专题，告别小菜鸟</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/fe-advanced/ad1.html" class="sidebar-link">你真的熟悉 HTML 标签吗？</a></li><li><a href="/blog/views/fe-advanced/ad2.html" class="sidebar-link">如何高效操作 DOM 元素？</a></li><li><a href="/blog/views/fe-advanced/ad3.html" class="sidebar-link">3 个使用场景助你用好 DOM 事件</a></li><li><a href="/blog/views/fe-advanced/ad6.html" class="sidebar-link">浏览器如何渲染页面？</a></li><li><a href="/blog/views/fe-advanced/ad7.html" class="sidebar-link">关于 JavaScript 的数据类型，你知多少</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nginx-从入门到实践，万字详解！"><a href="#nginx-从入门到实践，万字详解！" class="header-anchor">#</a> Nginx 从入门到实践，万字详解！</h1> <p>最近越来越频繁地遇到需要配置<strong>反向代理</strong>的场景，在自己搭建博客的时候，也不可避免要用到 Nginx，所以这段时间集中学习了一下 Nginx，同时做了一些笔记，希望也可以帮助到大家～ 😜</p> <p>这篇文章会在 CentOS 环境下安装和使用 Nginx</p> <p>CentOS 版本： <code>7.6</code></p> <p>Nginx 版本： <code>1.16.1</code></p> <p><img src="/blog/assets/img/17110141b0a9e71f.eb5614eb.png" alt="nginx"></p> <h2 id="_1-nginx-介绍"><a href="#_1-nginx-介绍" class="header-anchor">#</a> 1. Nginx 介绍</h2> <p>传统的 Web 服务器，每个客户端连接作为一个单独的进程或线程处理，需在切换任务时将 CPU 切换到新的任务并创建一个新的运行时上下文，消耗额外的内存和 CPU 时间，当并发请求增加时，服务器响应变慢，从而对性能产生负面影响。</p> <p><img src="/blog/assets/img/171c4e967b9714ed.0eed3862.png" alt="nginx"></p> <p><code>Nginx</code> 是<strong>开源、高性能、高可靠</strong>的 <code>Web</code> 和<strong>反向代理</strong>服务器，而且支持热部署，几乎可以做到 <code>7 \ 24</code> 小时不间断运行，即使运行几个月也不需要重新启动，还能在不间断服务的情况下对软件版本进行热更新。<strong>性能</strong>是 Nginx 最重要的考量，其<strong>占用内存少</strong>、<strong>并发能力强</strong>、能支持高达 <code>5w</code> 个并发连接数，最重要的是，Nginx 是免费的并可以商业化，配置使用也比较简单。</p> <p>Nginx 的最重要的几个使用场景：</p> <ol><li>静态资源服务，通过本地文件系统提供服务；</li> <li>反向代理服务，延伸出包括缓存、负载均衡等；</li> <li><code>API</code> 服务，<code>OpenResty</code>；</li></ol> <p>对于前端来说 <code>Node.js</code> 不陌生了，<code>Nginx</code> 和 <code>Node.js</code> 的很多理念类似，<code>HTTP</code> 服务器、<strong>事件驱动</strong>、<strong>异步非阻塞</strong>等，且 Nginx 的大部分功能使用 Node.js 也可以实现，但 Nginx 和 Node.js 并不冲突，都有自己擅长的领域。Nginx 擅长于<strong>底层服务器端资源的处理</strong>（<code>静态资源处理转发、反向代理，负载均衡</code>等），<code>Node.js</code> 更擅长<strong>上层具体业务逻辑的处理</strong>，两者可以完美组合，共同助力前端开发。</p> <p>下面我们来着重学习一下 Nginx 的使用。</p> <h2 id="_2-相关概念"><a href="#_2-相关概念" class="header-anchor">#</a> 2. 相关概念</h2> <h3 id="_2-1-简单请求和非简单请求"><a href="#_2-1-简单请求和非简单请求" class="header-anchor">#</a> 2.1 简单请求和非简单请求</h3> <p>首先我们来了解一下简单请求和非简单请求，如果同时满足下面两个条件，就属于简单请求：</p> <ol><li>请求方法是 <code>HEAD、GET、POST</code> 三种之一；</li> <li><code>HTTP</code> 头信息不超过右边这几个字段：<code>Accept、Accept-Language、Content-Language、Last-Event-ID</code> <code>Content-Type</code> 只限于三个值 <code>application/x-www-form-urlencoded、multipart/form-data、text/plain</code>；</li></ol> <p>凡是不同时满足这两个条件的，都属于非简单请求。</p> <p>浏览器处理简单请求和非简单请求的方式不一样：</p> <h4 id="简单请求"><a href="#简单请求" class="header-anchor">#</a> 简单请求</h4> <p>对于简单请求，浏览器会在头信息中增加 <code>Origin</code> 字段后直接发出，<code>Origin</code> 字段用来说明，本次请求来自的哪个源（<code>协议+域名+端口</code>）。
如果服务器发现 <code>Origin</code> 指定的源<code>不在许可范围内</code>，服务器会返回一个正常的 <code>HTTP</code> 回应，浏览器取到回应之后发现回应的头信息中没有包含 <code>Access-Control-Allow-Origin</code> 字段，就抛出一个错误给 <code>XHR</code> 的 <code>error</code> 事件；
如果服务器发现 <code>Origin</code> 指定的域名<code>在许可范围内</code>，服务器返回的响应会多出几个 <code>Access-Control-</code> 开头的头信息字段。</p> <h4 id="非简单请求"><a href="#非简单请求" class="header-anchor">#</a> 非简单请求</h4> <p>非简单请求是那种对服务器有特殊要求的请求，比如请求方法是 <code>PUT</code> 或 <code>DELETE</code>，或 <code>Content-Type</code> 值为 <code>application/json</code>。浏览器会在正式通信之前，发送一次 HTTP <strong>预检 <code>OPTIONS</code> 请求</strong>，先<strong>询问</strong>服务器，当前网页所在的域名是否在<strong>服务器的许可名单</strong>之中，以及可以使用哪些 <strong>HTTP 请求方法</strong>和<strong>头信息字段</strong>。只有得到肯定答复，浏览器才会发出<strong>正式</strong>的 <code>XHR 请求</code>，否则<strong>报错</strong>。</p> <h3 id="_2-2-跨域"><a href="#_2-2-跨域" class="header-anchor">#</a> 2.2 跨域</h3> <p>在浏览器上<strong>当前访问的网站</strong>向<strong>另一个网站</strong>发送请求获取数据的过程就是跨域请求。</p> <p>跨域是<strong>浏览器的同源策略</strong>决定的，是一个重要的浏览器安全策略，用于限制一个 origin 的文档或者它加载的脚本与另一个源的资源进行交互，它能够帮助阻隔恶意文档，减少可能被攻击的媒介，可以使用 CORS 配置解除这个限制。
关于跨域网上已经有很多解释，这里就不啰嗦，也可以直接看 <code>MDN</code> 的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy" target="_blank" rel="noopener noreferrer"><code>&lt;浏览器的同源策略&gt;</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 文档进一步了解，这里就列举几个同源和不同源的例子，相信程序员都能看得懂。</p> <div class="language- extra-class"><pre class="language-text"><code># 同源的例子
http://example.com/app1/index.html  # 只是路径不同
http://example.com/app2/index.html

http://Example.com:80  # 只是大小写差异
http://example.com

# 不同源的例子
http://example.com/app1   # 协议不同
https://example.com/app2

http://example.com        # host 不同
http://www.example.com
http://myapp.example.com

http://example.com        # 端口不同
http://example.com:8080

</code></pre></div><h3 id="_2-3-正向代理和反向代理"><a href="#_2-3-正向代理和反向代理" class="header-anchor">#</a> 2.3 正向代理和反向代理</h3> <p><strong>反向代理</strong>（<code>Reverse Proxy</code>）对应的是<strong>正向代理</strong>（<code>Forward Proxy</code>），他们的区别：</p> <p><strong>正向代理</strong>： 一般的访问流程是客户端直接向<strong>目标服务器</strong>发送请求并获取内容，使用正向代理后，客户端改为向<strong>代理服务器</strong>发送请求，并指定<strong>目标服务器</strong>（<strong>原始服务器</strong>），然后由<strong>代理服务器</strong>和<strong>原始服务器</strong>通信，<strong>转交请求</strong>并获得的内容，再返回给客户端。正向代理<strong>隐藏了真实的客户端</strong>，为客户端收发请求，使<strong>真实客户端对服务器不可见</strong>；</p> <p>举个具体的例子 🌰，你的浏览器无法直接访问谷歌，这时候可以通过一个代理服务器来帮助你访问谷哥，那么这个服务器就叫正向代理。</p> <p><strong>反向代理</strong>： 与一般访问流程相比，使用反向代理后，直接收到请求的服务器是代理服务器，然后将请求转发给<strong>内部网络</strong>上真正进行处理的服务器，得到的结果返回给客户端。反向代理<strong>隐藏</strong>了真实的服务器，为服务器收发请求，使<strong>真实服务器对客户端不可见</strong>。一般在<strong>处理跨域请求</strong>的时候比较常用。现在基本上所有的大型网站都设置了反向代理。</p> <p>举个具体的例子 🌰，去饭店吃饭，可以点川菜、粤菜、江浙菜，饭店也分别有三个菜系的厨师 👨‍🍳，但是你作为顾客不用管哪个厨师给你做的菜，只用点菜即可，小二将你菜单中的菜分配给不同的厨师来具体处理，那么这个小二就是反向代理服务器。</p> <p>都是需要代理服务器来转发客户端请求，那正向代理和反向代理的区别在哪呢？</p> <ol><li>正向代理：客户端知道自己所访问的真实服务器，客户端跟代理服务器是<code>一伙的</code></li> <li>反向代理：客户端不知道自己所访问的真实服务器，代理服务器和真实服务器是<code>一伙的</code></li></ol> <p>简单的说，一般给客户端做代理的都是正向代理，给服务器做代理的就是反向代理。</p> <p>正向代理和反向代理主要的原理区别可以参见下图：</p> <p><img src="/blog/assets/img/171c4e96d99eecdc.1575b2f3.png" alt="nginx"></p> <h3 id="_2-4-负载均衡"><a href="#_2-4-负载均衡" class="header-anchor">#</a> 2.4 负载均衡</h3> <p>一般情况下，客户端发送多个请求到服务器，服务器处理请求，其中一部分可能要操作一些资源比如数据库、静态资源等，服务器处理完毕后，再将结果返回给客户端。</p> <p>这种模式对于早期的系统来说，功能要求不复杂，且并发请求相对较少的情况下还能胜任，成本也低。随着信息数量不断增长，访问量和数据量飞速增长，以及系统业务复杂度持续增加，这种做法已无法满足要求，并发量特别大时，服务器容易崩。</p> <p>很明显这是由于服务器性能的瓶颈造成的问题，除了<strong>堆机器之外</strong>，最重要的做法就是<strong>负载均衡</strong>。</p> <p>请求爆发式增长的情况下，单个机器性能再强劲也无法满足要求了，这个时候集群的概念产生了，单个服务器解决不了的问题，可以使用多个服务器，然后将请求分发到各个服务器上，将负载分发到不同的服务器，这就是<strong>负载均衡</strong>，核心是<code>「分摊压力」</code>。Nginx 实现负载均衡，一般来说指的是<strong>将请求转发给服务器集群</strong>。</p> <p>举个具体的例子 🌰，<strong>晚高峰</strong>乘坐地铁的时候，入站口经常会有地铁工作人员大喇叭“请走 B 口，B 口人少车空....”，这个<code>工作人员</code>的作用就是<strong>负载均衡</strong>。</p> <p><img src="/blog/assets/img/fuzaijunheng.b875ee04.png" alt="nginx"></p> <h3 id="_2-5-动静分离"><a href="#_2-5-动静分离" class="header-anchor">#</a> 2.5 动静分离</h3> <p>为了加快网站的解析速度，可以把动态页面和静态页面由不同的服务器来解析，加快解析速度，降低原来单个服务器的压力。</p> <p><img src="/blog/assets/img/dongjingfenli.eba103ca.png" alt="nginx"></p> <p>一般来说，都需要将动态资源和静态资源分开，由于 <code>Nginx</code> 的<strong>高并发</strong>和<strong>静态资源缓存</strong>等特性，经常将静态资源部署在 Nginx 上。如果请求的是静态资源，直接到静态资源目录获取资源，如果是动态资源的请求，则利用反向代理的原理，把请求转发给对应后台应用去处理，从而实现动静分离。</p> <p>使用前后端分离后，可以很大程度提升<strong>静态资源的访问速度</strong>，即使动态服务不可用，静态资源的访问也不会受到影响。</p> <h2 id="_3-nginx-快速安装"><a href="#_3-nginx-快速安装" class="header-anchor">#</a> 3. Nginx 快速安装</h2> <h3 id="_3-1-安装"><a href="#_3-1-安装" class="header-anchor">#</a> 3.1 安装</h3> <p>我们可以先看看</p> <div class="language-bash extra-class"><pre class="language-bash"><code>yum list <span class="token operator">|</span> <span class="token function">grep</span> nginx
</code></pre></div><p>来看看</p> <p><img src="/blog/assets/img/171c4e967ad35156.e1e17747.png" alt="nginx"></p> <p>然后</p> <div class="language-bash extra-class"><pre class="language-bash"><code>yum <span class="token function">install</span> nginx
</code></pre></div><p>来安装 <code>Nginx</code>，然后我们在命令行中 <code>nginx -v</code> 就可以看到具体的 <code>Nginx</code> 版本信息，也就安装完毕了。</p> <p><img src="data:image/png;base64,UklGRk4WAABXRUJQVlA4WAoAAAAwAAAAeAEAUQAASUNDUNgHAAAAAAfYYXBwbAIgAABtbnRyUkdCIFhZWiAH2QACABkACwAaAAthY3NwQVBQTAAAAABhcHBsAAAAAAAAAAAAAAAAAAAAAAAA9tYAAQAAAADTLWFwcGwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAtkZXNjAAABCAAAAG9kc2NtAAABeAAABZxjcHJ0AAAHFAAAADh3dHB0AAAHTAAAABRyWFlaAAAHYAAAABRnWFlaAAAHdAAAABRiWFlaAAAHiAAAABRyVFJDAAAHnAAAAA5jaGFkAAAHrAAAACxiVFJDAAAHnAAAAA5nVFJDAAAHnAAAAA5kZXNjAAAAAAAAABRHZW5lcmljIFJHQiBQcm9maWxlAAAAAAAAAAAAAAAUR2VuZXJpYyBSR0IgUHJvZmlsZQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbWx1YwAAAAAAAAAfAAAADHNrU0sAAAAoAAABhGRhREsAAAAuAAABrGNhRVMAAAAkAAAB2nZpVk4AAAAkAAAB/nB0QlIAAAAmAAACInVrVUEAAAAqAAACSGZyRlUAAAAoAAACcmh1SFUAAAAoAAACmnpoVFcAAAAWAAACwm5iTk8AAAAmAAAC2GNzQ1oAAAAiAAAC/mhlSUwAAAAeAAADIGl0SVQAAAAoAAADPnJvUk8AAAAkAAADZmRlREUAAAAsAAADimtvS1IAAAAWAAADtnN2U0UAAAAmAAAC2HpoQ04AAAAWAAADzGphSlAAAAAaAAAD4mVsR1IAAAAiAAAD/HB0UE8AAAAmAAAEHm5sTkwAAAAoAAAERGVzRVMAAAAmAAAEHnRoVEgAAAAkAAAEbHRyVFIAAAAiAAAEkGZpRkkAAAAoAAAEsmhySFIAAAAoAAAE2nBsUEwAAAAsAAAFAnJ1UlUAAAAiAAAFLmFyRUcAAAAmAAAFUGVuVVMAAAAmAAAFdgBWAWEAZQBvAGIAZQBjAG4A/QAgAFIARwBCACAAcAByAG8AZgBpAGwARwBlAG4AZQByAGUAbAAgAFIARwBCAC0AYgBlAHMAawByAGkAdgBlAGwAcwBlAFAAZQByAGYAaQBsACAAUgBHAEIAIABnAGUAbgDoAHIAaQBjAEMepQB1ACAAaADsAG4AaAAgAFIARwBCACAAQwBoAHUAbgBnAFAAZQByAGYAaQBsACAAUgBHAEIAIABHAGUAbgDpAHIAaQBjAG8EFwQwBDMEMAQ7BEwEPQQ4BDkAIAQ/BEAEPgREBDAEOQQ7ACAAUgBHAEIAUAByAG8AZgBpAGwAIABnAOkAbgDpAHIAaQBxAHUAZQAgAFIAVgBCAMEAbAB0AGEAbADhAG4AbwBzACAAUgBHAEIAIABwAHIAbwBmAGkAbJAadSgAIABSAEcAQgAggnJfaWPPj/AARwBlAG4AZQByAGkAcwBrACAAUgBHAEIALQBwAHIAbwBmAGkAbABPAGIAZQBjAG4A/QAgAFIARwBCACAAcAByAG8AZgBpAGwF5AXoBdUF5AXZBdwAIABSAEcAQgAgBdsF3AXcBdkAUAByAG8AZgBpAGwAbwAgAFIARwBCACAAZwBlAG4AZQByAGkAYwBvAFAAcgBvAGYAaQBsACAAUgBHAEIAIABnAGUAbgBlAHIAaQBjAEEAbABsAGcAZQBtAGUAaQBuAGUAcwAgAFIARwBCAC0AUAByAG8AZgBpAGzHfLwYACAAUgBHAEIAINUEuFzTDMd8Zm6QGgAgAFIARwBCACBjz4/wZYdO9k4AgiwAIABSAEcAQgAgMNcw7TDVMKEwpDDrA5MDtQO9A7kDugPMACADwAPBA78DxgOvA7sAIABSAEcAQgBQAGUAcgBmAGkAbAAgAFIARwBCACAAZwBlAG4A6QByAGkAYwBvAEEAbABnAGUAbQBlAGUAbgAgAFIARwBCAC0AcAByAG8AZgBpAGUAbA5CDhsOIw5EDh8OJQ5MACAAUgBHAEIAIA4XDjEOSA4nDkQOGwBHAGUAbgBlAGwAIABSAEcAQgAgAFAAcgBvAGYAaQBsAGkAWQBsAGUAaQBuAGUAbgAgAFIARwBCAC0AcAByAG8AZgBpAGkAbABpAEcAZQBuAGUAcgBpAQ0AawBpACAAUgBHAEIAIABwAHIAbwBmAGkAbABVAG4AaQB3AGUAcgBzAGEAbABuAHkAIABwAHIAbwBmAGkAbAAgAFIARwBCBB4EMQRJBDgEOQAgBD8EQAQ+BEQEOAQ7BEwAIABSAEcAQgZFBkQGQQAgBioGOQYxBkoGQQAgAFIARwBC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" alt="nginx"></p> <h3 id="_3-2-相关文件夹"><a href="#_3-2-相关文件夹" class="header-anchor">#</a> 3.2 相关文件夹</h3> <p>然后我们可以使用 <code>rpm -ql nginx</code> 来查看 <code>Nginx</code> 被安装到了什么地方，有哪些相关目录，其中位于 /etc 目录下的主要是配置文件，还有一些文件见下图：</p> <p><img src="/blog/assets/img/171c4e969c75753f.56b94e00.png" alt="nginx"></p> <p>主要关注的文件夹有两个：</p> <ol><li><code>/etc/nginx/conf.d/</code> 文件夹，是我们进行<strong>子配置的配置项存放处</strong>，<code>/etc/nginx/nginx.conf</code> 主配置文件会默认把这个文件夹中所有子配置项都引入；</li> <li><code>/usr/share/nginx/html/</code> 文件夹，通常<strong>静态文件</strong>都放在这个文件夹，也可以根据你自己的习惯放其他地方；</li></ol> <h3 id="_3-3-跑起来看看啦"><a href="#_3-3-跑起来看看啦" class="header-anchor">#</a> 3.3 跑起来看看啦</h3> <p>安装之后开启 <code>Nginx</code>，如果系统开启了<strong>防火墙</strong>，那么需要设置一下在<strong>防火墙</strong>中加入需要开放的端口，下面列举几个常用的<strong>防火墙</strong>操作（没开启的话不用管这个）：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>systemctl start firewalld  <span class="token comment"># 开启防火墙</span>
systemctl stop firewalld   <span class="token comment"># 关闭防火墙</span>
systemctl status firewalld <span class="token comment"># 查看防火墙开启状态，显示running则是正在运行</span>
firewall-cmd --reload      <span class="token comment"># 重启防火墙，永久打开端口需要reload一下</span>

<span class="token comment"># 添加开启端口，--permanent表示永久打开，不加是临时打开重启之后失效</span>
firewall-cmd --permanent --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">8888</span>/tcp

<span class="token comment"># 查看防火墙，添加的端口也可以看到</span>
firewall-cmd --list-all

</code></pre></div><p>然后设置 Nginx 的开机启动：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>systemctl <span class="token builtin class-name">enable</span> nginx

</code></pre></div><p>启动 Nginx （其他命令后面有详细讲解）：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>systemctl start nginx

</code></pre></div><p>然后访问你的 <code>IP</code>，这时候就可以看到 <code>Nginx</code> 的欢迎页面了～ <code>Welcome to nginx！</code> 👏</p> <h3 id="_3-4-安装-nvm-node-git"><a href="#_3-4-安装-nvm-node-git" class="header-anchor">#</a> 3.4 安装 nvm &amp; node &amp; git</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 下载 nvm，或者看官网的步骤 https://github.com/nvm-sh/nvm#install--update-script</span>
<span class="token function">curl</span> -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.3/install.sh <span class="token operator">|</span> <span class="token function">bash</span>

<span class="token builtin class-name">source</span>   ~/.bashrc    <span class="token comment"># 安装完毕后，更新配置文件即可使用 nvm 命令</span>
nvm ls-remote         <span class="token comment"># 查看远程 node 版本</span>
nvm <span class="token function">install</span> v12.16.3  <span class="token comment"># 选一个你要安装的版本安装，我这里选择 12.16.3</span>
nvm list              <span class="token comment"># 安装完毕查看安装的 node 版本</span>
node -v               <span class="token comment"># 查看是否安装好了</span>

yum <span class="token function">install</span> <span class="token function">git</span>   <span class="token comment"># git 安装</span>

</code></pre></div><h2 id="_4-nginx-操作常用命令"><a href="#_4-nginx-操作常用命令" class="header-anchor">#</a> 4. Nginx 操作常用命令</h2> <p><code>Nginx</code> 的命令在控制台中输入 <code>nginx -h</code> 就可以看到完整的命令，这里列举几个常用的命令：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>nginx -s reload  <span class="token comment"># 向主进程发送信号，重新加载配置文件，热重启</span>
nginx -s reopen	 <span class="token comment"># 重启 Nginx</span>
nginx -s stop    <span class="token comment"># 快速关闭</span>
nginx -s quit    <span class="token comment"># 等待工作进程处理完成后关闭</span>
nginx -T         <span class="token comment"># 查看当前 Nginx 最终的配置</span>
nginx -t -c <span class="token operator">&lt;</span>配置路径<span class="token operator">&gt;</span>    <span class="token comment"># 检查配置是否有问题，如果已经在配置目录，则不需要-c</span>

</code></pre></div><p><code>systemctl</code> 是 <code>Linux</code> 系统应用管理工具 <code>systemd</code> 的主命令，用于管理系统，我们也可以用它来对 Nginx 进行管理，相关命令如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>systemctl start nginx    <span class="token comment"># 启动 Nginx</span>
systemctl stop nginx     <span class="token comment"># 停止 Nginx</span>
systemctl restart nginx  <span class="token comment"># 重启 Nginx</span>
systemctl reload nginx   <span class="token comment"># 重新加载 Nginx，用于修改配置后</span>
systemctl <span class="token builtin class-name">enable</span> nginx   <span class="token comment"># 设置开机启动 Nginx</span>
systemctl disable nginx  <span class="token comment"># 关闭开机启动 Nginx</span>
systemctl status nginx   <span class="token comment"># 查看 Nginx 运行状态</span>

</code></pre></div><h2 id="_5-nginx-配置语法"><a href="#_5-nginx-配置语法" class="header-anchor">#</a> 5. Nginx 配置语法</h2> <p>就跟前面文件作用讲解的图所示，<code>Nginx</code> 的主配置文件是 <code>/etc/nginx/nginx.conf</code>，你可以使用 <code>cat -n nginx.conf</code> 来查看配置。</p> <p><code>nginx.conf</code> 结构图可以这样概括：</p> <div class="language- extra-class"><pre class="language-text"><code>main        # 全局配置，对全局生效
├── events  # 配置影响 Nginx 服务器或与用户的网络连接
├── http    # 配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置
│   ├── upstream # 配置后端服务器具体地址，负载均衡配置不可或缺的部分
│   ├── server   # 配置虚拟主机的相关参数，一个 http 块中可以有多个 server 块
│   ├── server
│   │   ├── location  # server 块可以包含多个 location 块，location 指令用于匹配 uri
│   │   ├── location
│   │   └── ...
│   └── ...
└── ...

</code></pre></div><p>一个 <code>Nginx</code> 配置文件的结构就像 <code>nginx.conf</code> 显示的那样，配置文件的语法规则：</p> <ol><li>配置文件由指令与指令块构成；</li> <li>每条指令以 ; 分号结尾，指令与参数间以<strong>空格符号分隔</strong>；</li> <li>指令块以 <code>{}</code> 大括号将<strong>多条指令组织</strong>在一起；</li> <li><code>include</code> 语句允许组合多个配置文件以提升可维护性；</li> <li>使用 <code>#</code> 符号<strong>添加注释</strong>，提高可读性；</li> <li>使用 <code>\$</code> 符号<strong>使用变量</strong>；</li> <li>部分指令的参数支持<strong>正则表达式</strong>；</li></ol> <h3 id="_5-1-典型配置"><a href="#_5-1-典型配置" class="header-anchor">#</a> 5.1 典型配置</h3> <p>来看下 Nginx 的典型配置：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>
user  nginx<span class="token punctuation">;</span>                        <span class="token comment"># 运行用户，默认即是nginx，可以不进行设置</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>                <span class="token comment"># Nginx 进程数，一般设置为和 CPU 核数一样</span>
error_log  /var/log/nginx/error.log warn<span class="token punctuation">;</span>   <span class="token comment"># Nginx 的错误日志存放目录</span>
pid        /var/run/nginx.pid<span class="token punctuation">;</span>      <span class="token comment"># Nginx 服务启动时的 pid 存放位置</span>

events <span class="token punctuation">{</span>
    use epoll<span class="token punctuation">;</span>     <span class="token comment"># 使用epoll的I/O模型(如果你不知道Nginx该使用哪种轮询方法，会自动选择一个最适合你操作系统的)</span>
    worker_connections <span class="token number">1024</span><span class="token punctuation">;</span>   <span class="token comment"># 每个进程允许最大并发数</span>
<span class="token punctuation">}</span>

http <span class="token punctuation">{</span>   <span class="token comment"># 配置使用最频繁的部分，代理、缓存、日志定义等绝大多数功能和第三方模块的配置都在这里设置</span>
    <span class="token comment"># 设置日志模式</span>
    log_format  main  <span class="token string">'<span class="token variable">$remote_addr</span> - <span class="token variable">$remote_user</span> [<span class="token variable">$time_local</span>] &quot;<span class="token variable">$request</span>&quot; '</span>
                      <span class="token string">'<span class="token variable">$status</span> <span class="token variable">$body_bytes_sent</span> &quot;<span class="token variable">$http_referer</span>&quot; '</span>
                      <span class="token string">'&quot;<span class="token variable">$http_user_agent</span>&quot; &quot;<span class="token variable">$http_x_forwarded_for</span>&quot;'</span><span class="token punctuation">;</span>

    access_log  /var/log/nginx/access.log  main<span class="token punctuation">;</span>   <span class="token comment"># Nginx访问日志存放位置</span>

    sendfile            on<span class="token punctuation">;</span>   <span class="token comment"># 开启高效传输模式</span>
    tcp_nopush          on<span class="token punctuation">;</span>   <span class="token comment"># 减少网络报文段的数量</span>
    tcp_nodelay         on<span class="token punctuation">;</span>
    keepalive_timeout   <span class="token number">65</span><span class="token punctuation">;</span>   <span class="token comment"># 保持连接的时间，也叫超时时间，单位秒</span>
    types_hash_max_size <span class="token number">2048</span><span class="token punctuation">;</span>

    include             /etc/nginx/mime.types<span class="token punctuation">;</span>      <span class="token comment"># 文件扩展名与类型映射表</span>
    default_type        application/octet-stream<span class="token punctuation">;</span>   <span class="token comment"># 默认文件类型</span>

    include /etc/nginx/conf.d/*.conf<span class="token punctuation">;</span>   <span class="token comment"># 加载子配置项</span>

    server <span class="token punctuation">{</span>
    	listen       <span class="token number">80</span><span class="token punctuation">;</span>       <span class="token comment"># 配置监听的端口</span>
    	server_name  localhost<span class="token punctuation">;</span>    <span class="token comment"># 配置的域名</span>

      location / <span class="token punctuation">{</span>
        root   /usr/share/nginx/html<span class="token punctuation">;</span>  <span class="token comment"># 网站根目录</span>
        index  index.html index.htm<span class="token punctuation">;</span>   <span class="token comment"># 默认首页文件</span>
        deny <span class="token number">172.168</span>.22.11<span class="token punctuation">;</span>   <span class="token comment"># 禁止访问的ip地址，可以为all</span>
        allow <span class="token number">172.168</span>.33.44； <span class="token comment"># 允许访问的ip地址，可以为all</span>
    	<span class="token punctuation">}</span>

    	error_page <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /50x.html<span class="token punctuation">;</span>  <span class="token comment"># 默认50x对应的访问页面</span>
    	error_page <span class="token number">400</span> <span class="token number">404</span> error.html<span class="token punctuation">;</span>   <span class="token comment"># 同上</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><code>server</code> 块可以包含多个 <code>location</code> 块，<code>location</code> 指令用于匹配 uri，语法：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>location <span class="token punctuation">[</span> <span class="token operator">=</span> <span class="token operator">|</span> ~ <span class="token operator">|</span> ~* <span class="token operator">|</span> ^~<span class="token punctuation">]</span> uri <span class="token punctuation">{</span>
	<span class="token punctuation">..</span>.
<span class="token punctuation">}</span>
</code></pre></div><p>指令后面：</p> <ol><li><code>=</code> 精确匹配路径，用于不含正则表达式的 <code>uri</code> 前，如果匹配成功，不再进行后续的查找；</li> <li><code>^~</code> 用于不含正则表达式的 <code>uri；</code> 前，表示如果该符号后面的字符是最佳匹配，采用该规则，不再进行后续的查找；</li> <li><code>~</code> 表示用该符号后面的正则去匹配路径，区分大小写；</li> <li><code>~\*</code> 表示用该符号后面的正则去匹配路径，不区分大小写。跟 <code>~</code> 优先级都比较低，如有多个 <code>location</code> 的正则能匹配的话，则使用正则表达式最长的那个；</li></ol> <p>如果 <code>uri</code> 包含正则表达式，则必须要有 <code>~</code> 或 <code>~\*</code> 标志。</p> <h3 id="_5-2-全局变量"><a href="#_5-2-全局变量" class="header-anchor">#</a> 5.2 全局变量</h3> <p><code>Nginx</code> 有一些常用的全局变量，你可以在配置的任何位置使用它们，如下表：</p> <table><thead><tr><th>全局变量名</th> <th>功能</th></tr></thead> <tbody><tr><td><code>$host</code></td> <td>请求信息中的 <code>HostHost</code>，如果请求中没有 <code>Host</code> 行，则等于设置的服务器名，不包含端口</td></tr> <tr><td><code>$request_method</code></td> <td>客户端请求类型，如 <code>GET、POST</code></td></tr> <tr><td><code>$remote_addr</code></td> <td>客户端的 <code>IP</code> 地址</td></tr> <tr><td><code>$args</code></td> <td>请求中的参数</td></tr> <tr><td><code>$arg_PARAMETER</code></td> <td><code>GET</code> 请求中变量名 <code>PARAMETER</code> 参数的值，例如：<code>$http_user_agent</code>(<code>Uaer-Agent</code> 值), <code>$http_referer</code>...</td></tr> <tr><td><code>$content_length</code></td> <td>请求头中的 <code>Content-length</code> 字段</td></tr> <tr><td><code>$http_user_agent</code></td> <td>客户端 <code>agent</code> 信息</td></tr> <tr><td><code>$http_cookie</code></td> <td>客户端 <code>cookie</code> 信息</td></tr> <tr><td><code>$remote_addr</code></td> <td>客户端的 <code>IP</code> 地址</td></tr> <tr><td><code>$remote_port</code></td> <td>客户端的端口</td></tr> <tr><td><code>$server_protocol</code></td> <td>请求使用的协议，如 <code>HTTP/1.0</code>、<code>HTTP/1.1</code></td></tr> <tr><td><code>$server_addr</code></td> <td>服务器地址</td></tr> <tr><td><code>$server_name</code></td> <td>服务器名称</td></tr> <tr><td><code>$server_port</code></td> <td>服务器的端口号</td></tr> <tr><td><code>$scheme</code></td> <td><code>HTTP</code> 方法（如 <code>http</code>，<code>https</code>）</td></tr></tbody></table> <p>还有更多的内置预定义变量，可以直接搜索关键字<code>「nginx内置预定义变量」</code>可以看到一堆博客写这个，这些变量都可以在配置文件中直接使用。</p> <h2 id="_6-设置二级域名虚拟主机"><a href="#_6-设置二级域名虚拟主机" class="header-anchor">#</a> 6. 设置二级域名虚拟主机</h2> <p>在某某云 ☁️ 上购买了域名之后，就可以配置虚拟主机了，一般配置的路径在 <code>域名管理 -&gt; 解析 -&gt; 添加记录</code> 中添加<strong>二级域名</strong>，配置后某某云会把<strong>二级域名</strong>也解析到我们配置的服务器 <code>IP</code> 上，然后我们在 <code>Nginx</code> 上配置一下<code>虚拟主机的访问监听</code>，就可以拿到从这个<code>二级域名过来的请求</code>了。</p> <p><img src="/blog/assets/img/171c4e96a168c66a.d2d0e8be.png" alt="171c4e96a168c66a"></p> <p>现在我自己的服务器上配置了一个 <code>fe</code> 的二级域名，也就是说在外网访问 <code>fe.sherlocked93.club</code> 的时候，也可以访问到我们的服务器了。</p> <p>由于默认配置文件 <code>/etc/nginx/nginx.conf</code> 的 <code>http</code> 模块中有一句 <code>include /etc/nginx/conf.d/_.conf</code> 也就是说 <code>conf.</code>d 文件夹下的所有 <code>_.conf</code> 文件都会<strong>作为<code>子配置项</code>被引入配置文件中</strong>。为了维护方便，我在 <code>/etc/nginx/conf.d</code> 文件夹中新建一个 <code>fe.sherlocked93.club.conf</code> ：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># /etc/nginx/conf.d/fe.sherlocked93.club.conf</span>

server <span class="token punctuation">{</span>
  listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name fe.sherlocked93.club<span class="token punctuation">;</span>

    location / <span class="token punctuation">{</span>
        root  /usr/share/nginx/html/fe<span class="token punctuation">;</span>
        index index.html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>然后在 <code>/usr/share/nginx/html</code> 文件夹下新建 <code>fe</code> 文件夹，前面说过，这个是用来存放静态资源的文件夹，新建文件 <code>index.html</code>，内容随便写点，改完 <code>nginx -s reload</code> 重新加载(重启<code>nginx</code>)，浏览器中输入 <code>fe.sherlocked93.club</code>，发现从二级域名就可以访问到我们刚刚新建的 <code>fe</code> 文件夹：</p> <p><img src="/blog/assets/img/171c4e96a60a5e51.2cb691bc.png" alt="171c4e96a60a5e51"></p> <h2 id="_7-配置反向代理"><a href="#_7-配置反向代理" class="header-anchor">#</a> 7. 配置反向代理</h2> <p>反向代理是工作中最常用的服务器功能，经常被用来解决跨域问题，下面简单介绍一下如何实现反向代理。</p> <p>首先进入 Nginx 的主配置文件：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">vim</span> /etc/nginx/nginx.conf

</code></pre></div><p>为了看起来方便，把行号显示出来 <code>:set nu</code> （个人习惯），然后我们去 <code>http</code> 模块的 <code>server</code> 块中的 <code>location /</code>，增加一行将默认网址重定向到最大学习网站 <code>Bilibili</code> 的 <code>proxy_pass</code> 配置 🤓 ：</p> <p><img src="data:image/png;base64,UklGRogjAABXRUJQVlA4WAoAAAAwAAAAVAIA7AAASUNDUNgHAAAAAAfYYXBwbAIgAABtbnRyUkdCIFhZWiAH2QACABkACwAaAAthY3NwQVBQTAAAAABhcHBsAAAAAAAAAAAAAAAAAAAAAAAA9tYAAQAAAADTLWFwcGwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAtkZXNjAAABCAAAAG9kc2NtAAABeAAABZxjcHJ0AAAHFAAAADh3dHB0AAAHTAAAABRyWFlaAAAHYAAAABRnWFlaAAAHdAAAABRiWFlaAAAHiAAAABRyVFJDAAAHnAAAAA5jaGFkAAAHrAAAACxiVFJDAAAHnAAAAA5nVFJDAAAHnAAAAA5kZXNjAAAAAAAAABRHZW5lcmljIFJHQiBQcm9maWxlAAAAAAAAAAAAAAAUR2VuZXJpYyBSR0IgUHJvZmlsZQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbWx1YwAAAAAAAAAfAAAADHNrU0sAAAAoAAABhGRhREsAAAAuAAABrGNhRVMAAAAkAAAB2nZpVk4AAAAkAAAB/nB0QlIAAAAmAAACInVrVUEAAAAqAAACSGZyRlUAAAAoAAACcmh1SFUAAAAoAAACmnpoVFcAAAAWAAACwm5iTk8AAAAmAAAC2GNzQ1oAAAAiAAAC/mhlSUwAAAAeAAADIGl0SVQAAAAoAAADPnJvUk8AAAAkAAADZmRlREUAAAAsAAADimtvS1IAAAAWAAADtnN2U0UAAAAmAAAC2HpoQ04AAAAWAAADzGphSlAAAAAaAAAD4mVsR1IAAAAiAAAD/HB0UE8AAAAmAAAEHm5sTkwAAAAoAAAERGVzRVMAAAAmAAAEHnRoVEgAAAAkAAAEbHRyVFIAAAAiAAAEkGZpRkkAAAAoAAAEsmhySFIAAAAoAAAE2nBsUEwAAAAsAAAFAnJ1UlUAAAAiAAAFLmFyRUcAAAAmAAAFUGVuVVMAAAAmAAAFdgBWAWEAZQBvAGIAZQBjAG4A/QAgAFIARwBCACAAcAByAG8AZgBpAGwARwBlAG4AZQByAGUAbAAgAFIARwBCAC0AYgBlAHMAawByAGkAdgBlAGwAcwBlAFAAZQByAGYAaQBsACAAUgBHAEIAIABnAGUAbgDoAHIAaQBjAEMepQB1ACAAaADsAG4AaAAgAFIARwBCACAAQwBoAHUAbgBnAFAAZQByAGYAaQBsACAAUgBHAEIAIABHAGUAbgDpAHIAaQBjAG8EFwQwBDMEMAQ7BEwEPQQ4BDkAIAQ/BEAEPgREBDAEOQQ7ACAAUgBHAEIAUAByAG8AZgBpAGwAIABnAOkAbgDpAHIAaQBxAHUAZQAgAFIAVgBCAMEAbAB0AGEAbADhAG4AbwBzACAAUgBHAEIAIABwAHIAbwBmAGkAbJAadSgAIABSAEcAQgAggnJfaWPPj/AARwBlAG4AZQByAGkAcwBrACAAUgBHAEIALQBwAHIAbwBmAGkAbABPAGIAZQBjAG4A/QAgAFIARwBCACAAcAByAG8AZgBpAGwF5AXoBdUF5AXZBdwAIABSAEcAQgAgBdsF3AXcBdkAUAByAG8AZgBpAGwAbwAgAFIARwBCACAAZwBlAG4AZQByAGkAYwBvAFAAcgBvAGYAaQBsACAAUgBHAEIAIABnAGUAbgBlAHIAaQBjAEEAbABsAGcAZQBtAGUAaQBuAGUAcwAgAFIARwBCAC0AUAByAG8AZgBpAGzHfLwYACAAUgBHAEIAINUEuFzTDMd8Zm6QGgAgAFIARwBCACBjz4/wZYdO9k4AgiwAIABSAEcAQgAgMNcw7TDVMKEwpDDrA5MDtQO9A7kDugPMACADwAPBA78DxgOvA7sAIABSAEcAQgBQAGUAcgBmAGkAbAAgAFIARwBCACAAZwBlAG4A6QByAGkAYwBvAEEAbABnAGUAbQBlAGUAbgAgAFIARwBCAC0AcAByAG8AZgBpAGUAbA5CDhsOIw5EDh8OJQ5MACAAUgBHAEIAIA4XDjEOSA4nDkQOGwBHAGUAbgBlAGwAIABSAEcAQgAgAFAAcgBvAGYAaQBsAGkAWQBsAGUAaQBuAGUAbgAgAFIARwBCAC0AcAByAG8AZgBpAGkAbABpAEcAZQBuAGUAcgBpAQ0AawBpACAAUgBHAEIAIABwAHIAbwBmAGkAbABVAG4AaQB3AGUAcgBzAGEAbABuAHkAIABwAHIAbwBmAGkAbAAgAFIARwBCBB4EMQRJBDgEOQAgBD8EQAQ+BEQEOAQ7BEwAIABSAEcAQgZFBkQGQQAgBioGOQYxBkoGQQAgAFIARwBC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" alt="171c4e96a6d7033c"></p> <p>改完保存退出，<code>nginx -s reload</code> <strong>重新加载(重启)</strong>，进入默认网址，那么现在就直接跳转到 <code>B</code> 站了，实现了一个简单的代理。</p> <p>实际使用中，可以将请求转发到本机另一个服务器上，也可以根据访问的路径跳转到不同端口的服务中。</p> <p>比如我们监听 <code>9001</code> 端口，然后把访问不同路径的请求进行反向代理：</p> <p>举个栗子:</p> <ol><li>把访问 <code>http://127.0.0.1:9001/edu</code> 的请求转发到 <code>http://127.0.0.1:8080</code></li> <li>把访问 <code>http://127.0.0.1:9001/vod</code> 的请求转发到 <code>http://127.0.0.1:8081</code></li></ol> <p>这种要怎么配置呢，首先同样打开主配置文件，然后在 <code>http</code> 模块下增加一个 <code>server</code> 块：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>server <span class="token punctuation">{</span>
  listen <span class="token number">9001</span><span class="token punctuation">;</span>
  server_name *.sherlocked93.club<span class="token punctuation">;</span>

  location ~ /edu/ <span class="token punctuation">{</span>
    proxy_pass http://127.0.0.1:8080<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  location ~ /vod/ <span class="token punctuation">{</span>
    proxy_pass http://127.0.0.1:8081<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>反向代理还有一些其他的指令，可以了解一下：</p> <ol><li><code>proxy_set_header</code>：在将客户端请求发送给后端服务器之前，更改来自客户端的请求头信息。</li> <li><code>proxy_connect_timeout</code>：配置 <code>Nginx</code> 与后端代理服务器尝试建立连接的超时时间。</li> <li><code>proxy_read_timeout</code>：配置 <code>Nginx</code> 向后端服务器组发出 <code>read</code> 请求后，等待相应的超时时间。</li> <li><code>proxy_send_timeout</code>：配置 <code>Nginx</code> 向后端服务器组发出 <code>write</code> 请求后，等待相应的超时时间。</li> <li><code>proxy_redirect</code>：用于修改后端服务器返回的响应头中的 <code>Location</code> 和 <code>Refresh</code></li></ol> <h2 id="_8-跨域-cors-配置"><a href="#_8-跨域-cors-配置" class="header-anchor">#</a> 8. 跨域 CORS 配置</h2> <p>关于<code>简单请求、非简单请求、跨域</code>的概念，前面已经介绍过了，还不了解的可以看看前面的讲解。现在前后端分离的项目一统天下，经常本地起了前端服务，需要访问不同的后端地址，不可避免遇到跨域问题。</p> <p><img src="/blog/assets/img/171c4e96b16214cc.f8ace0b7.png" alt="171c4e96b16214cc"></p> <p>要解决跨域问题，我们来制造一个跨域问题。首先和前面设置二级域名的方式一样，先设置好 <code>fe.sherlocked93.club</code> 和 <code>be.sherlocked93.club</code> 二级域名，都指向本云服务器地址，虽然对应 IP 是一样的，但是在 <code>fe.sherlocked93.club</code> 域名发出的请求访问 <code>be.sherlocked93.club</code> 域名的请求还是跨域了，因为访问的 <code>host</code> 不一致（如果不知道啥原因参见前面跨域的内容）。</p> <h3 id="_8-1-使用反向代理解决跨域"><a href="#_8-1-使用反向代理解决跨域" class="header-anchor">#</a> 8.1 使用反向代理解决跨域</h3> <p>在前端服务地址为 <code>fe.sherlocked93.club</code> 的页面请求 <code>be.sherlocked93.club</code> 的后端服务导致的跨域，可以这样配置：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>server <span class="token punctuation">{</span>
  listen <span class="token number">9001</span><span class="token punctuation">;</span>
  server_name fe.sherlocked93.club<span class="token punctuation">;</span>

  <span class="token comment"># 反向代理地址</span>
  location / <span class="token punctuation">{</span>
    proxy_pass be.sherlocked93.club<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样就将对前一个域名 <code>fe.sherlocked93.club</code> 的请求全都代理到了 <code>be.sherlocked93.club</code>，前端的请求都被我们用服务器代理到了后端地址(<code>be.sherlocked93.club</code>)下，<strong>绕过了跨域</strong>。</p> <p>这里对静态文件的请求和后端服务的请求都以 <code>fe.sherlocked93.club</code> 开始，不易区分，所以为了实现对后端服务请求的统一转发，通常我们会约定对后端服务的请求加上 <code>/apis/</code> 前缀或者其他的 <code>path</code> 来和对静态资源的请求加以区分，此时我们可以这样配置：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 请求跨域，约定代理后端服务请求path以/apis/开头</span>
location ^~/apis/ <span class="token punctuation">{</span>
    <span class="token comment"># 这里重写了请求，将正则匹配中的第一个分组的path拼接到真正的请求后面，并用break停止后续匹配</span>
    rewrite ^/apis/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>$ /<span class="token variable">$1</span> <span class="token builtin class-name">break</span><span class="token punctuation">;</span>
    proxy_pass be.sherlocked93.club<span class="token punctuation">;</span>

    <span class="token comment"># 两个域名之间cookie的传递与回写</span>
    proxy_cookie_domain be.sherlocked93.club fe.sherlocked93.club<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>这样，静态资源我们使用 <code>fe.sherlocked93.club/xx.html</code>，动态资源我们使用 <code>fe.sherlocked93.club/apis/getAwo</code>，浏览器页面看起来仍然访问的前端服务器，绕过了浏览器的同源策略，毕竟我们看起来并没有跨域。</p> <p>也可以统一一点，直接把静态资源和后端服务器地址直接都转发到另一个 <code>server.sherlocked93.club</code>，只通过在后面添加的 <code>path</code> 来<strong>区分</strong>请求的是<strong>静态资源</strong>还是<strong>后端服务</strong>，这个就看需求了。</p> <h3 id="_8-2-配置-header-解决跨域"><a href="#_8-2-配置-header-解决跨域" class="header-anchor">#</a> 8.2 配置 header 解决跨域</h3> <p>当浏览器在访问跨源的服务器时，也可以在跨域的服务器上直接通过 Nginx 设置<strong>允许跨域</strong>，从而前端就可以无感地开发，不用把实际上访问后端的地址改成前端服务的地址，这样可适性更高。</p> <p>比如前端站点是 <code>fe.sherlocked93.club</code>，这个地址下的前端页面请求 <code>be.sherlocked93.club</code> 下的资源，比如前者的 <code>fe.sherlocked93.club/index.html</code> 内容是这样的：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>welcome fe.sherlocked93.club!!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>text/javascript<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">var</span> xmlhttp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 请求了另外一台服务器的静态资源，毫无疑问，浏览器会报跨域</span>
    xmlhttp<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://be.sherlocked93.club/index.html&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xmlhttp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><p>打开浏览器访问 <code>fe.sherlocked93.club/index.html</code> 的结果如下：</p> <p><img src="/blog/assets/img/171c4e96b99b44b7.d27f370d.png" alt="171c4e96b99b44b7"></p> <p>这样就解决了跨域问题，其实这种方式的类似后端的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS" target="_blank" rel="noopener noreferrer"><code>CORS</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>(跨域资源共享) 方案。</p> <h2 id="_9-开启-gzip-压缩"><a href="#_9-开启-gzip-压缩" class="header-anchor">#</a> 9. 开启 gzip 压缩</h2> <p><code>gzip</code> 是一种常用的网页压缩技术，传输的网页经过 <code>gzip</code> 压缩之后大小通常可以变为原来的<strong>一半</strong>甚至更小（官网原话），更小的网页体积也就意味着<strong>带宽的节约</strong>和<strong>传输速度的提升</strong>，特别是对于访问量巨大的大型网站来说，每一个静态资源体积的减小，都会带来可观的<strong>流量与带宽的节省</strong>。</p> <p>百度可以找到很多检测站点来查看目标网页有没有开启 <code>gzip</code> 压缩，在下随便找了一个 <a href="http://tool.chinaz.com/Gzips/Default.aspx?q=juejin.im" target="_blank" rel="noopener noreferrer">&lt;网页 <code>GZIP</code> 压缩检测&gt;<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 输入掘金 <code>juejin.im</code> 来偷窥下掘金有没有开启 <code>gzip</code>。</p> <p><img src="/blog/assets/img/171c4e96dc471f0b.c97c2df6.png" alt="171c4e96dc471f0b"></p> <p>这里可以看到掘金是开启了 <code>gzip</code> 的，压缩效果还挺不错，达到了 <code>52%</code> 之多，本来 <code>34kb</code> 的网页体积，压缩完只需要 <code>16kb</code>，可以想象网页传输速度提升了不少。</p> <h3 id="_9-1-nginx-配置-gzip"><a href="#_9-1-nginx-配置-gzip" class="header-anchor">#</a> 9.1 Nginx 配置 gzip</h3> <p>使用 <code>gzip</code> 不仅需要 <code>Nginx</code> 配置，浏览器端也需要配合，需要在<code>请求消息头</code>中包含 <code>Accept-Encoding: gzip</code>（IE5 之后所有的浏览器都支持了，是现代浏览器的默认设置）。一般在请求 <code>html</code> 和 <code>css</code> 等<strong>静态资源</strong>的时候，支持的浏览器在 <code>request</code> 请求静态资源的时候，会加上 <code>Accept-Encoding: gzip</code> 这个 <code>header</code>，表示自己支持 <code>gzip</code> 的压缩方式，<code>Nginx</code> 在拿到这个请求的时候，如果有相应配置，就会返回经过 <code>gzip</code> 压缩过的文件给浏览器，并在 <code>response</code> 相应的时候加上 <code>content-encoding: gzip</code> 来告诉浏览器自己采用的<strong>压缩方式</strong>（因为浏览器在传给服务器的时候一般还告诉服务器自己支持好几种<strong>压缩方式</strong>），浏览器拿到压缩的文件后，根据自己的<strong>解压方式</strong>进行解析。</p> <p>先来看看 <code>Nginx</code> 怎么进行 <code>gzip</code> 配置，和之前的配置一样，为了方便管理，还是在 <code>/etc/nginx/conf.d/</code> 文件夹中新建配置文件 <code>gzip.conf</code> ：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># /etc/nginx/conf.d/gzip.conf</span>

<span class="token function">gzip</span> on<span class="token punctuation">;</span> <span class="token comment"># 默认off，是否开启gzip</span>
gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript<span class="token punctuation">;</span>

<span class="token comment"># 上面两个开启基本就能跑起了，下面的愿意折腾就了解一下</span>
gzip_static on<span class="token punctuation">;</span>
gzip_proxied any<span class="token punctuation">;</span>
gzip_vary on<span class="token punctuation">;</span>
gzip_comp_level <span class="token number">6</span><span class="token punctuation">;</span>
gzip_buffers <span class="token number">16</span> 8k<span class="token punctuation">;</span>
<span class="token comment"># gzip_min_length 1k;</span>
gzip_http_version <span class="token number">1.1</span><span class="token punctuation">;</span>

</code></pre></div><p>这里稍微解释一下：</p> <ol><li><code>gzip_types</code>：要采用 <code>gzip</code> 压缩的 <code>MIME</code> 文件类型，其中 <code>text/html</code> 被系统强制启用；</li> <li><code>gzip_static</code>：默认 <code>off</code>，该模块启用后，<code>Nginx</code> 首先检查是否存在请求静态文件的 <code>gz</code> 结尾的文件，如果有则直接返回该 <code>.gz</code> 文件内容；</li> <li><code>gzip_proxied</code>：默认 <code>off</code>，<code>nginx</code> 做为反向代理时启用，用于设置启用或禁用从代理服务器上收到相应内容 <code>gzip</code> 压缩；</li> <li><code>gzip_vary</code>：用于在响应消息头中添加 <code>Vary：Accept-Encoding</code>，使代理服务器根据请求头中的 <code>Accept-Encoding</code> 识别是否启用 <code>gzip</code> 压缩；</li> <li><code>gzip_comp_level</code>：<code>gzip</code> 压缩比，压缩级别是 <code>1-9</code>，<strong>1 压缩级别最低，9 最高</strong>，<strong>级别越高压缩率越大</strong>，压缩时间越长，建议 <code>4-6</code>；</li> <li><code>gzip_buffers</code>：获取多少内存用于缓存压缩结果，<code>16 8k</code> 表示以 <code>8k\*16</code> 为单位获得；</li> <li><code>gzip_min_length</code>：允许压缩的页面最小字节数，页面字节数从 <code>header</code> 头中的 <code>Content-Length</code> 中进行获取。默认值是 <code>0</code>，不管页面多大都压缩。建议设置成大于 <code>1k</code> 的字节数，小于 <code>1k</code> 可能会越压越大；</li> <li><code>gzip_http_version</code>：默认 <code>1.1</code>，启用 <code>gzip</code> 所需的 <strong>HTTP 最低版本</strong>；</li></ol> <p>这个配置可以插入到 <code>http</code> 模块整个服务器的配置里，也可以插入到需要使用的虚拟主机的 <code>server</code> 或者下面的 <code>location</code> 模块中，当然像上面我们这样写的话就是被 <code>include</code> 到 <code>http</code> 模块中了。</p> <p>其他更全的配置信息可以查看 <a href="http://nginx.org/en/docs/http/ngx_http_gzip_module.html" target="_blank" rel="noopener noreferrer">&lt;官网文档 ngx_http_gzip_module&gt;<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，配置前是这样的：</p> <p><img src="/blog/assets/img/171c4e96dd2b5019.3cd6ff66.png" alt="171c4e96dd2b5019"></p> <p>配置之后 <code>response</code> 的 <code>header</code> 里面多了一个 <code>Content-Encoding: gzip</code>，说明返回信息被<strong>压缩</strong>了</p> <p><img src="/blog/assets/img/171c4e96def4db0f.9d5dd342.png" alt="171c4e96def4db0f"></p> <p>注意了，一般 <code>gzip</code> 的配置建议加上 <code>gzip_min_length 1k</code>，不加的话：</p> <p><img src="/blog/assets/img/171c4e96ee3279e8.4c67689b.png" alt="171c4e96ee3279e8"></p> <p>由于文件太小，<code>gzip</code> 压缩之后得到了 <code>-48%</code> 的体积优化，压缩之后体积还比压缩之前体积大了，emmmmm~~ 所以最好设置低于 <code>1kb</code> 的文件就不要 <code>gzip</code> 压缩了 🤪</p> <h3 id="_9-2-webpack-的-gzip-配置"><a href="#_9-2-webpack-的-gzip-配置" class="header-anchor">#</a> 9.2 Webpack 的 gzip 配置</h3> <p>如果当前端项目使用 <code>Webpack</code> 进行打包的时候，也可以开启 <code>gzip</code> 压缩：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue-cli3 的 vue.config.js 文件</span>
<span class="token keyword">const</span> CompressionWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'compression-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// gzip 配置</span>
  <span class="token function-variable function">configureWebpack</span><span class="token operator">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 生产环境</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">CompressionWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex">/\.js$|\.html$|\.css/</span><span class="token punctuation">,</span>    <span class="token comment">// 匹配文件名</span>
          threshold<span class="token operator">:</span> <span class="token number">10240</span><span class="token punctuation">,</span>               <span class="token comment">// 文件压缩阈值，对超过10k的进行压缩</span>
          deleteOriginalAssets<span class="token operator">:</span> <span class="token boolean">false</span>     <span class="token comment">// 是否删除源文件</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>

</code></pre></div><p>由此打包出来的文件如下图：</p> <p><img src="/blog/assets/img/171c4e96f98708c7.19460bce.png" alt="171c4e96f98708c7"></p> <p>这里可以看到某些打包之后的文件下面有一个对应的带<code>.gz</code> 后缀的文件, 这就是经过 <code>gzip</code> 压缩之后的文件，这是因为这个文件超过了 <code>10kb</code>，有的文件没有超过 <code>10kb</code> 就没有进行 <code>gzip</code> 打包，如果你期望压缩文件的体积阈值小一点，可以在 <code>compression-webpack-plugin</code> 这个插件的配置里进行对应配置。</p> <p>那么为啥这里 <code>Nginx</code> 已经有了 <code>gzip</code> 压缩，<code>Webpack</code> 这里又整了个 <code>gzip</code> 呢，因为如果全都是使用 <code>Nginx</code> 来压缩文件，会耗费服务器的计算资源，如果服务器的 <code>gzip_comp_level</code> 配置的比较高，就更增加服务器的开销，相应增加客户端的请求时间，得不偿失。</p> <p>如果压缩的动作在前端打包的时候就做了，把<strong>打包之后的高压缩等级文件</strong>作为静态资源放在服务器上，<code>Nginx</code> 会<strong>优先查找</strong>这些压缩之后的文件返回给客户端，相当于把压缩文件的动作从 <code>Nginx</code> 提前给 <code>Webpack</code> 打包的时候完成，<strong>节约了服务器资源</strong>，所以一般推荐在生产环境应用 <code>Webpack</code> 配置 <code>gzip</code> 压缩。</p> <h2 id="_10-配置负载均衡"><a href="#_10-配置负载均衡" class="header-anchor">#</a> 10. 配置负载均衡</h2> <p>负载均衡在之前已经介绍了相关概念了，主要思想就是把<strong>负载均匀合理地分发到多个服务器上</strong>，实现<strong>压力分流</strong>的目的。</p> <p>主要配置如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>http <span class="token punctuation">{</span>
  upstream myserver <span class="token punctuation">{</span>
  	<span class="token comment"># ip_hash;  # ip_hash 方式</span>
    <span class="token comment"># fair;   # fair 方式</span>
    server <span class="token number">127.0</span>.0.1:8081<span class="token punctuation">;</span>  <span class="token comment"># 负载均衡目的服务地址</span>
    server <span class="token number">127.0</span>.0.1:8080<span class="token punctuation">;</span>
    server <span class="token number">127.0</span>.0.1:8082 <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>  <span class="token comment"># weight 方式，不写默认为 1</span>
  <span class="token punctuation">}</span>

  server <span class="token punctuation">{</span>
    location / <span class="token punctuation">{</span>
    	proxy_pass http://myserver<span class="token punctuation">;</span>
      proxy_connect_timeout <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><code>Nginx</code> 提供了好几种分配方式，默认为<strong>轮询</strong>，就是轮流来。有以下几种分配方式：</p> <ol><li><strong>轮询</strong>，默认方式，每个请求<strong>按时间顺序</strong>逐一分配到不同的后端服务器，如果后端服务挂了，能自动剔除；</li> <li><strong>weight</strong>，<strong>权重分配</strong>，指定轮询几率，<strong>权重越高，在被访问的概率越大</strong>，用于后端服务器性能不均的情况；</li> <li><strong>ip_hash</strong>，每个请求按访问 <code>IP</code> 的 <code>hash</code> 结果分配，这样每个访客固定访问一个后端服务器，可以解决动态网页 <code>session</code> 共享问题。负载均衡每次请求都会<strong>重新定位</strong>到服务器集群中的某一个，那么已经登录某一个服务器的用户再重新定位到另一个服务器，其登录信息将会丢失，这样显然是不妥的；</li> <li><code>fair</code>（第三方），按后端服务器的<strong>响应时间</strong>分配，<strong>响应时间</strong>短的优先分配，依赖第三方插件 <code>nginx-upstream-fair</code>，需要先安装；</li></ol> <h2 id="_11-配置动静分离"><a href="#_11-配置动静分离" class="header-anchor">#</a> 11. 配置动静分离</h2> <p>动静分离在之前也介绍过了，就是把动态和静态的<strong>请求分开</strong>。方式主要有两种，一种 是纯粹把静态文件<strong>独立成单独的域名</strong>，放在<strong>独立的服务器</strong>上，也是目前<strong>主流推崇</strong>的方案。另外一种方法就是动态跟静态文件<strong>混合</strong>在一起发布， 通过 <strong>Nginx 配置</strong>来分开。</p> <p>通过 <code>location</code> 指定<strong>不同的后缀名</strong>实现<strong>不同的请求转发</strong>。通过 <code>expires</code> 参数设置，可以使浏览器缓存过期时间，减少与服务器之前的请求和流量。具体 <code>expires</code> 定义：是给一个资源设定一个<strong>过期时间</strong>，也就是说无需去服务端验证，直接通过<strong>浏览器自身确认是否过期</strong>即可，所以不会产生额外的流量。此种方法非常适合<strong>不经常变动</strong>的资源。（如果<strong>经常更新的文件</strong>，不建议使用 <code>expires</code> 来缓存），我这里设置 <code>3d</code>，表示在这 <code>3 天之内</code>访问这个 <code>URL</code>，发送一个请求，比对服务器该文件<strong>最后更新时间</strong>没有变化。则不会从服务器抓取，返回状态码 <code>304</code>，如果有修改，则直接从服务器重新下载，返回状态码 <code>200</code>。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">location</span> <span class="token operator">/</span>www<span class="token operator">/</span> <span class="token punctuation">{</span>
  	<span class="token keyword">root</span> <span class="token operator">/</span>data<span class="token operator">/</span><span class="token punctuation">;</span>
    <span class="token keyword">index</span> <span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token keyword">index</span><span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">location</span> <span class="token operator">/</span>image<span class="token operator">/</span> <span class="token punctuation">{</span>
  	<span class="token keyword">root</span> <span class="token operator">/</span>data<span class="token operator">/</span><span class="token punctuation">;</span>
    <span class="token keyword">autoindex</span> on<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="_12-配置高可用集群（双机热备）"><a href="#_12-配置高可用集群（双机热备）" class="header-anchor">#</a> 12. 配置高可用集群（双机热备）</h2> <p>当主 Nginx 服务器宕机之后，可以切换到<code>备份 Nginx 服务器</code>。</p> <p><img src="/blog/assets/img/2020-03-13-shuangjirebei(1).923eb529.png" alt="img"></p> <p>首先安装 <code>keepalived</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code>yum <span class="token function">install</span> keepalived -y

</code></pre></div><p>然后编辑 <code>/etc/keepalived/keepalived.conf</code> 配置文件，并在配置文件中增加 <code>vrrp_script</code> 定义一个外围检测机制，并在 <code>vrrp_instance</code> 中通过定义 <code>track_script</code> 来<strong>追踪脚本执行</strong>过程，实现<strong>节点转移</strong>：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code>global_defs<span class="token punctuation">{</span>
   notification_email <span class="token punctuation">{</span>
        acassen@firewall<span class="token punctuation">.</span>loc
   <span class="token punctuation">}</span>
   notification_email_from Alexandre@firewall<span class="token punctuation">.</span>loc
   smtp_server <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
   smtp_connect_timeout <span class="token number">30</span> <span class="token operator">/</span><span class="token operator">/</span> 上面都是邮件配置，没卵用
   router_id LVS_DEVEL     <span class="token operator">/</span><span class="token operator">/</span> 当前服务器名字，用hostname命令来查看
<span class="token punctuation">}</span>
vrrp_script chk_maintainace <span class="token punctuation">{</span> <span class="token operator">/</span><span class="token operator">/</span> 检测机制的脚本名称为chk_maintainace
    script <span class="token string">&quot;[[ -e/etc/keepalived/down ]] &amp;&amp; exit 1 || exit 0&quot;</span> <span class="token operator">/</span><span class="token operator">/</span> 可以是脚本路径或脚本命令
    <span class="token operator">/</span><span class="token operator">/</span> script <span class="token string">&quot;/etc/keepalived/nginx_check.sh&quot;</span>    <span class="token operator">/</span><span class="token operator">/</span> 比如这样的脚本路径
    interval <span class="token number">2</span>  <span class="token operator">/</span><span class="token operator">/</span> 每隔<span class="token number">2</span>秒检测一次
    weight <span class="token operator">-</span><span class="token number">20</span>  <span class="token operator">/</span><span class="token operator">/</span> 当脚本执行成立，那么把当前服务器优先级改为<span class="token operator">-</span><span class="token number">20</span>
<span class="token punctuation">}</span>
vrrp_instanceVI_1 <span class="token punctuation">{</span>   <span class="token operator">/</span><span class="token operator">/</span> 每一个vrrp_instance就是定义一个虚拟路由器
    state MASTER      <span class="token operator">/</span><span class="token operator">/</span> 主机为MASTER，备用机为BACKUP
    interface <span class="token class-name">eth0</span>    <span class="token operator">/</span><span class="token operator">/</span> 网卡名字，可以从ifconfig中查找
    virtual_router_id <span class="token number">51</span> <span class="token operator">/</span><span class="token operator">/</span> 虚拟路由的id号，一般小于<span class="token number">255</span>，主备机id需要一样
    priority <span class="token number">100</span>      <span class="token operator">/</span><span class="token operator">/</span> 优先级，master的优先级比backup的大
    advert_int <span class="token number">1</span>      <span class="token operator">/</span><span class="token operator">/</span> 默认心跳间隔
    authentication <span class="token punctuation">{</span>  <span class="token operator">/</span><span class="token operator">/</span> 认证机制
        auth_type PASS
        auth_pass <span class="token number">1111</span>   <span class="token operator">/</span><span class="token operator">/</span> 密码
    <span class="token punctuation">}</span>
    virtual_ipaddress <span class="token punctuation">{</span>  <span class="token operator">/</span><span class="token operator">/</span> 虚拟地址vip
       <span class="token number">172.16</span><span class="token number">.2</span><span class="token number">.8</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>其中检测脚本 <code>nginx_check.sh</code>，这里提供一个：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token assign-left variable">A</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">ps</span> -C nginx --no-header <span class="token operator">|</span> <span class="token function">wc</span> -l<span class="token variable">`</span></span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$A</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
    /usr/sbin/nginx <span class="token comment"># 尝试重新启动nginx</span>
    <span class="token function">sleep</span> <span class="token number">2</span>         <span class="token comment"># 睡眠2秒</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable"><span class="token variable">`</span><span class="token function">ps</span> -C nginx --no-header <span class="token operator">|</span> <span class="token function">wc</span> -l<span class="token variable">`</span></span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
        <span class="token function">killall</span> keepalived <span class="token comment"># 启动失败，将keepalived服务杀死。将vip漂移到其它备份节点</span>
    <span class="token keyword">fi</span>
<span class="token keyword">fi</span>

</code></pre></div><p>复制一份到备份服务器，备份 <code>Nginx</code> 的配置要将 <code>state</code> 后改为 <code>BACKUP，priority</code> 改为比主机小。</p> <p>设置完毕后各自 <code>service keepalived start</code> 启动，经过访问成功之后，可以把 <code>Master</code> 机的 <code>keepalived</code> 停掉，此时 <code>Master</code> 机就不再是主机了 <code>service keepalived stop</code>，看访问虚拟 <code>IP</code> 时是否能够自动切换到备机 <code>ip addr</code>。</p> <p>再次启动 <code>Master</code> 的 <code>keepalived</code>，此时 <code>vip</code> 又变到了主机上。</p> <h2 id="_13-适配-pc-或移动设备"><a href="#_13-适配-pc-或移动设备" class="header-anchor">#</a> 13. 适配 PC 或移动设备</h2> <p>根据<strong>用户设备</strong>不同<strong>返回不同样式的站点</strong>，以前经常使用的是纯前端的自适应布局，但无论是复杂性和易用性上面还是不如分开编写的好，比如我们常见的淘宝、京东......这些大型网站就都没有采用自适应，而是用<strong>分开制作</strong>的方式，根据用户请求的 <code>user-agent</code>(用户设备信息) 来判断是返回 <code>PC</code> 还是 <code>H5</code> 站点。</p> <p>首先在 <code>/usr/share/nginx/html</code> 文件夹下 <code>mkdir</code> 分别新建两个文件夹 <code>PC</code> 和 <code>mobile</code>，<code>vim</code> 编辑两个 <code>index.html</code> 随便写点内容。</p> <p>然后和设置二级域名虚拟主机时候一样，去 <code>/etc/nginx/conf.d</code> 文件夹下新建一个配置文件 <code>fe.sherlocked93.club.conf</code> ：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment"># /etc/nginx/conf.d/fe.sherlocked93.club.conf</span>

<span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
	<span class="token keyword">server_name</span> fe<span class="token punctuation">.</span>sherlocked93<span class="token punctuation">.</span>club<span class="token punctuation">;</span>

	<span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
		<span class="token keyword">root</span>  <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token operator">/</span>pc<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$http_user_agent</span> <span class="token operator">~</span><span class="token operator">*</span> <span class="token string">'(Android|webOS|iPhone|iPod|BlackBerry)'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">root</span> <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token operator">/</span>mobile<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
		<span class="token keyword">index</span> <span class="token keyword">index</span><span class="token punctuation">.</span>html<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>配置基本没什么不一样的，主要多了一个 <code>if</code> 语句，然后使用 <code>$http_user_agent</code> 全局变量来判断<strong>用户请求</strong>的 <code>user-agent</code>，指向不同的 静态资源 <code>root</code> 路径，返回对应站点。</p> <p>在浏览器访问这个站点，然后 <code>F12</code> 中模拟使用手机访问：</p> <p><img src="/blog/assets/img/171c4e97062c5124.855f540e.png" alt="171c4e97062c5124"></p> <p>可以看到在模拟使用移动端访问的时候，Nginx 返回的站点变成了移动端对应的 html 了。</p> <h2 id="_14-配置-https"><a href="#_14-配置-https" class="header-anchor">#</a> 14. 配置 HTTPS</h2> <p>具体配置过程网上挺多的了，也可以使用你购买的某某云，一般都会有<a href="https://cloud.tencent.com/document/product/400/6814" target="_blank" rel="noopener noreferrer">免费申请<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的服务器证书，安装直接看所在云的操作指南即可。</p> <p>我购买的腾讯云提供的亚洲诚信机构颁发的免费证书只能一个域名使用，二级域名什么的需要另外申请，但是申请审批比较快，一般几分钟就能成功，然后下载证书的压缩文件，里面有个 <code>nginx</code> 文件夹，把 <code>xxx.crt</code>(证书文件) 和 <code>xxx.key</code>(私钥文件) 文件拷贝到服务器目录</p> <p>再这样配置：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">listen</span> <span class="token number">443</span> <span class="token keyword">ssl</span> http2 default_server<span class="token punctuation">;</span>   <span class="token comment"># SSL 访问端口号为 443</span>
  <span class="token keyword">server_name</span> sherlocked93<span class="token punctuation">.</span>club<span class="token punctuation">;</span>         <span class="token comment"># 填写绑定证书的域名</span>

  <span class="token keyword">ssl_certificate</span> <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span><span class="token keyword">https</span><span class="token operator">/</span><span class="token number">1</span>_sherlocked93<span class="token punctuation">.</span>club_bundle<span class="token punctuation">.</span>crt<span class="token punctuation">;</span>   <span class="token comment"># 证书文件地址</span>
  <span class="token keyword">ssl_certificate_key</span> <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span><span class="token keyword">https</span><span class="token operator">/</span><span class="token number">2</span>_sherlocked93<span class="token punctuation">.</span>club<span class="token punctuation">.</span>key<span class="token punctuation">;</span>      <span class="token comment"># 私钥文件地址</span>
  <span class="token keyword">ssl_session_timeout</span> <span class="token number">10</span>m<span class="token punctuation">;</span>

  <span class="token keyword">ssl_protocols</span> TLSv1 TLSv1<span class="token punctuation">.</span><span class="token number">1</span> TLSv1<span class="token punctuation">.</span><span class="token number">2</span><span class="token punctuation">;</span>      <span class="token comment">#请按照以下协议配置</span>
  <span class="token keyword">ssl_ciphers</span> ECDHE<span class="token operator">-</span>RSA<span class="token operator">-</span>AES128<span class="token operator">-</span>GCM<span class="token operator">-</span>SHA256<span class="token punctuation">:</span>HIGH<span class="token punctuation">:</span><span class="token operator">!</span>aNULL<span class="token punctuation">:</span><span class="token operator">!</span>MD5<span class="token punctuation">:</span><span class="token operator">!</span>RC4<span class="token punctuation">:</span><span class="token operator">!</span>DHE<span class="token punctuation">;</span>
  <span class="token keyword">ssl_prefer_server_ciphers</span> on<span class="token punctuation">;</span>

  <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
    <span class="token keyword">root</span>         <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token punctuation">;</span>
    <span class="token keyword">index</span>        <span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token keyword">index</span><span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>写完 <code>nginx -t -q</code> 校验一下配置文件是否正确，没问题就 <code>nginx -s reload</code> 重启 <code>nginx</code>，现在去访问 <code>https://sherlocked93.club/</code> 就能访问 <code>HTTPS</code> 版的网站了。</p> <p>一般还可以加上几个增强安全性的命令：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">add_header</span> X<span class="token operator">-</span>Frame<span class="token operator">-</span>Options <span class="token keyword">DENY</span><span class="token punctuation">;</span>           <span class="token comment"># 减少点击劫持</span>
<span class="token keyword">add_header</span> X<span class="token operator">-</span>Content<span class="token operator">-</span>Type<span class="token operator">-</span>Options nosniff<span class="token punctuation">;</span> <span class="token comment"># 禁止服务器自动解析资源类型</span>
<span class="token keyword">add_header</span> X<span class="token operator">-</span>Xss<span class="token operator">-</span>Protection <span class="token number">1</span><span class="token punctuation">;</span>             <span class="token comment"># 防XSS攻击</span>

</code></pre></div><h2 id="_15-一些常用技巧"><a href="#_15-一些常用技巧" class="header-anchor">#</a> 15. 一些常用技巧</h2> <h3 id="_15-1-静态服务"><a href="#_15-1-静态服务" class="header-anchor">#</a> 15.1 静态服务</h3> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">listen</span>       <span class="token number">80</span><span class="token punctuation">;</span>
  <span class="token keyword">server_name</span>  static<span class="token punctuation">.</span>sherlocked93<span class="token punctuation">.</span>club<span class="token punctuation">;</span>
  <span class="token keyword">charset</span> utf<span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">;</span>    <span class="token comment"># 防止中文文件名乱码</span>

  <span class="token keyword">location</span> <span class="token operator">/</span>download <span class="token punctuation">{</span>
    <span class="token keyword">alias</span>	          <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token operator">/</span>static<span class="token punctuation">;</span>  <span class="token comment"># 静态资源目录</span>

    <span class="token keyword">autoindex</span>               on<span class="token punctuation">;</span>    <span class="token comment"># 开启静态资源列目录</span>
    <span class="token keyword">autoindex_exact_size</span>    off<span class="token punctuation">;</span>   <span class="token comment"># on(默认)显示文件的确切大小，单位是byte；off显示文件大概大小，单位KB、MB、GB</span>
    <span class="token keyword">autoindex_localtime</span>     off<span class="token punctuation">;</span>   <span class="token comment"># off(默认)时显示的文件时间为GMT时间；on显示的文件时间为服务器时间</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_15-2-图片防盗链"><a href="#_15-2-图片防盗链" class="header-anchor">#</a> 15.2 图片防盗链</h3> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">listen</span>       <span class="token number">80</span><span class="token punctuation">;</span>
  <span class="token keyword">server_name</span>  <span class="token operator">*</span><span class="token punctuation">.</span>sherlocked93<span class="token punctuation">.</span>club<span class="token punctuation">;</span>

  <span class="token comment"># 图片防盗链</span>
  <span class="token keyword">location</span> <span class="token operator">~</span><span class="token operator">*</span> \<span class="token punctuation">.</span><span class="token punctuation">(</span>gif<span class="token operator">|</span>jpg<span class="token operator">|</span>jpeg<span class="token operator">|</span>png<span class="token operator">|</span>bmp<span class="token operator">|</span>swf<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
    <span class="token keyword">valid_referers</span> none blocked <span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.2</span><span class="token punctuation">;</span>  <span class="token comment"># 只允许本机 IP 外链引用</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$invalid_referer</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token number">403</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_15-3-请求过滤"><a href="#_15-3-请求过滤" class="header-anchor">#</a> 15.3 请求过滤</h3> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment"># 非指定请求全返回 403</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$request_method</span> <span class="token operator">!</span><span class="token operator">~</span> <span class="token operator">^</span><span class="token punctuation">(</span>GET<span class="token operator">|</span>POST<span class="token operator">|</span>HEAD<span class="token punctuation">)</span>$ <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">403</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
  <span class="token comment"># IP访问限制（只允许IP是 192.168.0.2 机器访问）</span>
  <span class="token keyword">allow</span> <span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.2</span><span class="token punctuation">;</span>
  <span class="token keyword">deny</span> all<span class="token punctuation">;</span>

  <span class="token keyword">root</span>   html<span class="token punctuation">;</span>
  <span class="token keyword">index</span>  <span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token keyword">index</span><span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_15-4-配置图片、字体等静态文件缓存"><a href="#_15-4-配置图片、字体等静态文件缓存" class="header-anchor">#</a> 15.4 配置图片、字体等静态文件缓存</h3> <p>由于图片、字体、音频、视频等<strong>静态文件</strong>在打包的时候通常会增加了 <code>hash</code>，所以缓存可以设置的长一点，先设置<code>强制缓存</code>，再设置<code>协商缓存</code>；如果存在没有 hash 值的静态文件，建议不设置强制缓存，仅通过<code>协商缓存</code>判断是否需要使用缓存。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 图片缓存时间设置</span>
location ~ .*<span class="token punctuation">\</span>.<span class="token punctuation">(</span>css<span class="token operator">|</span>js<span class="token operator">|</span>jpg<span class="token operator">|</span>png<span class="token operator">|</span>gif<span class="token operator">|</span>swf<span class="token operator">|</span>woff<span class="token operator">|</span>woff2<span class="token operator">|</span>eot<span class="token operator">|</span>svg<span class="token operator">|</span>ttf<span class="token operator">|</span>otf<span class="token operator">|</span>mp3<span class="token operator">|</span>m4a<span class="token operator">|</span>aac<span class="token operator">|</span>txt<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
	expires 10d<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment"># 如果不希望缓存</span>
expires -1<span class="token punctuation">;</span>

</code></pre></div><h3 id="_15-5-单页面项目-history-路由配置"><a href="#_15-5-单页面项目-history-路由配置" class="header-anchor">#</a> 15.5 单页面项目 history 路由配置</h3> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">listen</span>       <span class="token number">80</span><span class="token punctuation">;</span>
  <span class="token keyword">server_name</span>  fe<span class="token punctuation">.</span>sherlocked93<span class="token punctuation">.</span>club<span class="token punctuation">;</span>

  <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
    <span class="token keyword">root</span>       <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token operator">/</span>dist<span class="token punctuation">;</span>  <span class="token comment"># vue 打包后的文件夹</span>
    <span class="token keyword">index</span>      <span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token keyword">index</span><span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
    <span class="token keyword">try_files</span>  <span class="token variable">$uri</span> <span class="token variable">$uri</span><span class="token operator">/</span> <span class="token operator">/</span><span class="token keyword">index</span><span class="token punctuation">.</span>html @rewrites<span class="token punctuation">;</span>

    <span class="token keyword">expires</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>                          <span class="token comment"># 首页一般没有强制缓存</span>
    <span class="token keyword">add_header</span> Cache<span class="token operator">-</span>Control no<span class="token operator">-</span>cache<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment"># 接口转发，如果需要的话</span>
  <span class="token comment">#location ~ ^/api {</span>
  <span class="token comment">#  proxy_pass http://be.sherlocked93.club;</span>
  <span class="token comment">#}</span>

  <span class="token keyword">location</span> @rewrites <span class="token punctuation">{</span>
    <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">+</span><span class="token punctuation">)</span>$ <span class="token operator">/</span><span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_15-6-http-请求转发到-https"><a href="#_15-6-http-请求转发到-https" class="header-anchor">#</a> 15.6 HTTP 请求转发到 HTTPS</h3> <p>配置完 <code>HTTPS</code> 后，浏览器还是可以访问 <code>HTTP</code> 的地址 <code>http://sherlocked93.club/</code> 的，可以做一个 <code>301</code> 跳转，把对应域名的 <code>HTTP</code> 请求重定向到 <code>HTTPS</code> 上</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">listen</span>      <span class="token number">80</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span> www<span class="token punctuation">.</span>sherlocked93<span class="token punctuation">.</span>club<span class="token punctuation">;</span>

    <span class="token comment"># 单域名重定向</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$host</span> <span class="token operator">=</span> <span class="token string">'www.sherlocked93.club'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">301</span> <span class="token keyword">https</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>sherlocked93<span class="token punctuation">.</span>club<span class="token variable">$request_uri</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment"># 全局非 https 协议时就重定向</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$scheme</span> <span class="token operator">!=</span> <span class="token string">'https'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">301</span> <span class="token keyword">https</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token variable">$server_name</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># 或者全部重定向</span>
    <span class="token keyword">return</span> <span class="token number">301</span> <span class="token keyword">https</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token variable">$server_name</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>

    <span class="token comment"># 以上配置选择自己需要的即可，不用全部加</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_15-7-泛域名路径分离"><a href="#_15-7-泛域名路径分离" class="header-anchor">#</a> 15.7 泛域名路径分离</h3> <p>这是一个非常实用的技能，经常有时候我们可能需要配置一些二级或者三级域名，希望通过 <code>Nginx</code> 自动指向对应目录，比如：</p> <ol><li><code>test1.doc.sherlocked93.club</code> 自动指向 <code>/usr/share/nginx/html/doc/test1</code> 服务器地址；</li> <li><code>test2.doc.sherlocked93.club</code> 自动指向 <code>/usr/share/nginx/html/doc/test2</code> 服务器地址；</li></ol> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">listen</span>       <span class="token number">80</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span>  <span class="token operator">~</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\w<span class="token operator">-</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">)</span>\<span class="token punctuation">.</span>doc\<span class="token punctuation">.</span>sherlocked93\<span class="token punctuation">.</span>club$<span class="token punctuation">;</span>

    <span class="token comment"># $1指的是 .doc 前面的分组</span>
    <span class="token keyword">root</span> <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token operator">/</span>doc<span class="token operator">/</span>$<span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_15-8-泛域名转发"><a href="#_15-8-泛域名转发" class="header-anchor">#</a> 15.8 泛域名转发</h3> <p>和之前的功能类似，有时候我们希望把二级或者三级域名链接重写到我们希望的路径，让后端就可以根据路由解析不同的规则：</p> <ol><li>test1.serv.sherlocked93.club/api?name=a 自动转发到 127.0.0.1:8080/test1/api?name=a；</li> <li>test2.serv.sherlocked93.club/api?name=a 自动转发到 127.0.0.1:8080/test2/api?name=a ；</li></ol> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">listen</span>       <span class="token number">80</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span> <span class="token operator">~</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\w<span class="token operator">-</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">)</span>\<span class="token punctuation">.</span>serv\<span class="token punctuation">.</span>sherlocked93\<span class="token punctuation">.</span>club$<span class="token punctuation">;</span>

    <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
        <span class="token keyword">proxy_set_header</span>        X<span class="token operator">-</span>Real<span class="token operator">-</span>IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_set_header</span>        X<span class="token operator">-</span>Forwarded<span class="token operator">-</span>For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_set_header</span>        Host <span class="token variable">$http_host</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_set_header</span>        X<span class="token operator">-</span>NginX<span class="token operator">-</span><span class="token keyword">Proxy</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token comment"># $1 为 .serv 前面匹配到的分组</span>
        <span class="token keyword">proxy_pass</span>              <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">8080</span><span class="token operator">/</span>$<span class="token number">1</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="_16-最佳实践"><a href="#_16-最佳实践" class="header-anchor">#</a> 16. 最佳实践</h2> <ol><li>为了使 <code>Nginx</code> 配置更易于维护，建议为<strong>每个服务创建一个单独的配置文件</strong>，存储在 <code>/etc/nginx/conf.d</code> 目录，根据需求可以创建<strong>任意多个独立的配置文件</strong>。</li> <li><strong>独立的配置文件</strong>，建议遵循以下命名约定 <code>&lt;服务&gt;.conf</code>，比如域名是 <code>sherlocked93.club</code>，那么你的配置文件的应该是这样的 <code>/etc/nginx/conf.d/sherlocked93.club.conf</code>，如果部署<strong>多个服务</strong>，也可以在文件名中加上 <code>Nginx</code> 转发的<strong>端口号</strong>，比如 <code>sherlocked93.club.8080.conf</code>，如果是二级域名，建议也都加上 <code>fe.sherlocked93.club.conf</code>。</li> <li><strong>常用的、复用频率比较高</strong>的配置可以放到 <code>/etc/nginx/snippets</code> 文件夹，在 <code>Nginx</code> 的配置文件中需要用到的位置 <code>include</code> 进去，以<strong>功能</strong>来命名，并在每个 <code>snippet</code> 配置文件的<strong>开头注释标明主要功能和引入位置</strong>，方便管理。比如之前的 <code>gzip</code>、<code>cors</code> 等常用配置，我都设置了 <code>snippet</code>。</li> <li><code>Nginx</code> 日志相关目录，内以 <code>域名.type.log</code> 命名（比如 <code>be.sherlocked93.club.access.log</code> 和 <code>be.sherlocked93.club.error.log</code> ）位于 <code>/var/log/nginx/</code> 目录中，为每个<strong>独立的服务</strong>配置<strong>不同的访问权限</strong>和<strong>错误日志</strong>文件，这样查找错误时，会更加方便快捷。</li></ol> <h2 id="参考文档"><a href="#参考文档" class="header-anchor">#</a> 参考文档</h2> <ol><li><a href="https://www.nginx.cn/doc/" target="_blank" rel="noopener noreferrer">Nginx 中文文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.cnblogs.com/liang-io/p/9340335.html" target="_blank" rel="noopener noreferrer">Nginx 安装，目录结构与配置文件详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://blog.csdn.net/xyang81/article/details/52554398" target="_blank" rel="noopener noreferrer">Keepalived 安装与配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/5bacbd395188255c8d0fd4b2#comment" target="_blank" rel="noopener noreferrer">Nginx 与前端开发<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="noopener noreferrer">跨域资源共享 CORS 详解 - 阮一峰的网络日志<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.conardli.top/blog/article/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E8%80%85%E5%BF%85%E5%A4%87%E7%9A%84nginx%E7%9F%A5%E8%AF%86.html#nginx%E5%9C%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8" target="_blank" rel="noopener noreferrer">前端开发者必备的 nginx 知识<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://blog.xinac.cn/archives/nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E5%8F%82%E8%80%83%E5%A4%A7%E5%85%A8" target="_blank" rel="noopener noreferrer">nginx 重定向，全局 https，SSL 配置，反代配置参考<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://xuexb.github.io/learn-nginx/" target="_blank" rel="noopener noreferrer">Nginx 入门教程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol> <h2 id="最后"><a href="#最后" class="header-anchor">#</a> 最后</h2> <p>文中若有不准确或错误的地方，欢迎指出，有兴趣可以的关注下<a href="https://github.com/GolderBrother" target="_blank" rel="noopener noreferrer">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>~</p> <div class="gitalk-container"><div id="gitalk-container"></div></div> <div class="gitalk-container"><div id="gitalk-container"></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2020/9/7 下午8:45:37</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/views/network/tcp-interview.html" class="prev">TCP 协议灵魂之问，巩固你的网络底层基础</a></span> <span class="next"><a href="/blog/views/git/git-command-animation.html">相见恨晚的 Git 命令动画演示，一看就懂！</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.74817549.js" defer></script><script src="/blog/assets/js/2.f761193d.js" defer></script><script src="/blog/assets/js/5.cc289552.js" defer></script><script src="/blog/assets/js/23.dbb39e0a.js" defer></script>
  </body>
</html>
