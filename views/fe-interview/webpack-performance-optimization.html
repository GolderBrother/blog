<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <!-- 为了可以访问第三方图床的图片，才添加了这句代码，如果你的图片是存在本地的，去掉这句代码即可 -->
    <meta id="referrer" name="referrer" content="never" />
    <!-- <meta id="referrer" name="referrer" content="always" /> -->
    <title>Webpack 性能优化你知道哪些 | 全栈修炼</title>
    <meta name="description" content="GolderBrother的博客" />
    <link rel="icon" href="/blog/assets/favicon.ico">  <link rel="preload" href="/blog/assets/css/0.styles.2dde6c16.css" as="style"><link rel="preload" href="/blog/assets/js/app.74817549.js" as="script"><link rel="preload" href="/blog/assets/js/2.f761193d.js" as="script"><link rel="preload" href="/blog/assets/js/155.d7bc8987.js" as="script"><link rel="preload" href="/blog/assets/js/23.dbb39e0a.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.ea66aff3.js"><link rel="prefetch" href="/blog/assets/js/100.1650309e.js"><link rel="prefetch" href="/blog/assets/js/101.dd5cdc51.js"><link rel="prefetch" href="/blog/assets/js/102.81a755d8.js"><link rel="prefetch" href="/blog/assets/js/103.84d1e041.js"><link rel="prefetch" href="/blog/assets/js/104.6bb79eda.js"><link rel="prefetch" href="/blog/assets/js/105.ac0fa491.js"><link rel="prefetch" href="/blog/assets/js/106.e7f21162.js"><link rel="prefetch" href="/blog/assets/js/107.a932b9dd.js"><link rel="prefetch" href="/blog/assets/js/108.08337848.js"><link rel="prefetch" href="/blog/assets/js/109.0a8ac1ac.js"><link rel="prefetch" href="/blog/assets/js/11.2b17f742.js"><link rel="prefetch" href="/blog/assets/js/110.63f713ce.js"><link rel="prefetch" href="/blog/assets/js/111.3ded28af.js"><link rel="prefetch" href="/blog/assets/js/112.feb77183.js"><link rel="prefetch" href="/blog/assets/js/113.ca7a3dfe.js"><link rel="prefetch" href="/blog/assets/js/114.278aaabb.js"><link rel="prefetch" href="/blog/assets/js/115.3f930fa5.js"><link rel="prefetch" href="/blog/assets/js/116.0686a02f.js"><link rel="prefetch" href="/blog/assets/js/117.22090497.js"><link rel="prefetch" href="/blog/assets/js/118.d7f089fa.js"><link rel="prefetch" href="/blog/assets/js/119.3c8db627.js"><link rel="prefetch" href="/blog/assets/js/12.d4feb8d0.js"><link rel="prefetch" href="/blog/assets/js/120.e516c49a.js"><link rel="prefetch" href="/blog/assets/js/121.d702cc4d.js"><link rel="prefetch" href="/blog/assets/js/122.13d4f773.js"><link rel="prefetch" href="/blog/assets/js/123.6905c46b.js"><link rel="prefetch" href="/blog/assets/js/124.ccac9465.js"><link rel="prefetch" href="/blog/assets/js/125.3fad187d.js"><link rel="prefetch" href="/blog/assets/js/126.065c2aad.js"><link rel="prefetch" href="/blog/assets/js/127.d4aef2ae.js"><link rel="prefetch" href="/blog/assets/js/128.00766f11.js"><link rel="prefetch" href="/blog/assets/js/129.51d245ca.js"><link rel="prefetch" href="/blog/assets/js/13.21c8139a.js"><link rel="prefetch" href="/blog/assets/js/130.82b8009d.js"><link rel="prefetch" href="/blog/assets/js/131.fb8da159.js"><link rel="prefetch" href="/blog/assets/js/132.2484fde1.js"><link rel="prefetch" href="/blog/assets/js/133.177fe1b1.js"><link rel="prefetch" href="/blog/assets/js/134.5611fa2b.js"><link rel="prefetch" href="/blog/assets/js/135.4d1053c3.js"><link rel="prefetch" href="/blog/assets/js/136.2973975f.js"><link rel="prefetch" href="/blog/assets/js/137.7c44ba09.js"><link rel="prefetch" href="/blog/assets/js/138.16973a68.js"><link rel="prefetch" href="/blog/assets/js/139.2f797054.js"><link rel="prefetch" href="/blog/assets/js/14.8cf70ab3.js"><link rel="prefetch" href="/blog/assets/js/140.f94ba770.js"><link rel="prefetch" href="/blog/assets/js/141.69f9800f.js"><link rel="prefetch" href="/blog/assets/js/142.b567c447.js"><link rel="prefetch" href="/blog/assets/js/143.f1ee0ada.js"><link rel="prefetch" href="/blog/assets/js/144.138163b4.js"><link rel="prefetch" href="/blog/assets/js/145.e3bee357.js"><link rel="prefetch" href="/blog/assets/js/146.3a9fd8c7.js"><link rel="prefetch" href="/blog/assets/js/147.0b8e88a6.js"><link rel="prefetch" href="/blog/assets/js/148.81da2cf3.js"><link rel="prefetch" href="/blog/assets/js/149.d44d0121.js"><link rel="prefetch" href="/blog/assets/js/15.ea38d450.js"><link rel="prefetch" href="/blog/assets/js/150.7665d423.js"><link rel="prefetch" href="/blog/assets/js/151.1ab5f781.js"><link rel="prefetch" href="/blog/assets/js/152.620db4ac.js"><link rel="prefetch" href="/blog/assets/js/153.695d756f.js"><link rel="prefetch" href="/blog/assets/js/154.ee82e0a2.js"><link rel="prefetch" href="/blog/assets/js/156.95cf0d01.js"><link rel="prefetch" href="/blog/assets/js/157.76159f7e.js"><link rel="prefetch" href="/blog/assets/js/158.e27d7f12.js"><link rel="prefetch" href="/blog/assets/js/159.84d58dcb.js"><link rel="prefetch" href="/blog/assets/js/16.7794197c.js"><link rel="prefetch" href="/blog/assets/js/160.44f17ac0.js"><link rel="prefetch" href="/blog/assets/js/161.a9fc1420.js"><link rel="prefetch" href="/blog/assets/js/162.953ffb8f.js"><link rel="prefetch" href="/blog/assets/js/163.d4b64d04.js"><link rel="prefetch" href="/blog/assets/js/164.d718bdc2.js"><link rel="prefetch" href="/blog/assets/js/165.464562ce.js"><link rel="prefetch" href="/blog/assets/js/166.3486924a.js"><link rel="prefetch" href="/blog/assets/js/167.044ce06a.js"><link rel="prefetch" href="/blog/assets/js/168.81e22c48.js"><link rel="prefetch" href="/blog/assets/js/169.4c4a576c.js"><link rel="prefetch" href="/blog/assets/js/17.7083b50c.js"><link rel="prefetch" href="/blog/assets/js/170.4b71dfab.js"><link rel="prefetch" href="/blog/assets/js/171.d2051e87.js"><link rel="prefetch" href="/blog/assets/js/172.eeb81923.js"><link rel="prefetch" href="/blog/assets/js/173.aafb24fa.js"><link rel="prefetch" href="/blog/assets/js/174.2e261a79.js"><link rel="prefetch" href="/blog/assets/js/175.aafd75a2.js"><link rel="prefetch" href="/blog/assets/js/176.b7681070.js"><link rel="prefetch" href="/blog/assets/js/177.e9bdb5f5.js"><link rel="prefetch" href="/blog/assets/js/178.4a3ca305.js"><link rel="prefetch" href="/blog/assets/js/179.40201a86.js"><link rel="prefetch" href="/blog/assets/js/18.3dbb7741.js"><link rel="prefetch" href="/blog/assets/js/180.68c6346e.js"><link rel="prefetch" href="/blog/assets/js/181.326c1f42.js"><link rel="prefetch" href="/blog/assets/js/182.92780c32.js"><link rel="prefetch" href="/blog/assets/js/183.65f40b5a.js"><link rel="prefetch" href="/blog/assets/js/19.78fd69da.js"><link rel="prefetch" href="/blog/assets/js/20.be39648e.js"><link rel="prefetch" href="/blog/assets/js/21.80a318b4.js"><link rel="prefetch" href="/blog/assets/js/22.4040efb3.js"><link rel="prefetch" href="/blog/assets/js/24.f27f8467.js"><link rel="prefetch" href="/blog/assets/js/25.448302be.js"><link rel="prefetch" href="/blog/assets/js/26.78106ffa.js"><link rel="prefetch" href="/blog/assets/js/27.2a65554d.js"><link rel="prefetch" href="/blog/assets/js/28.55501022.js"><link rel="prefetch" href="/blog/assets/js/29.af733838.js"><link rel="prefetch" href="/blog/assets/js/3.df759ff3.js"><link rel="prefetch" href="/blog/assets/js/30.8ce1d72b.js"><link rel="prefetch" href="/blog/assets/js/31.7925ec43.js"><link rel="prefetch" href="/blog/assets/js/32.f9892d98.js"><link rel="prefetch" href="/blog/assets/js/33.afd7fd02.js"><link rel="prefetch" href="/blog/assets/js/34.ee49fe13.js"><link rel="prefetch" href="/blog/assets/js/35.0e4f5335.js"><link rel="prefetch" href="/blog/assets/js/36.96311e99.js"><link rel="prefetch" href="/blog/assets/js/37.fb3163b1.js"><link rel="prefetch" href="/blog/assets/js/38.778ed95b.js"><link rel="prefetch" href="/blog/assets/js/39.0531a2e1.js"><link rel="prefetch" href="/blog/assets/js/4.bb581d32.js"><link rel="prefetch" href="/blog/assets/js/40.ec9153c6.js"><link rel="prefetch" href="/blog/assets/js/41.2e9e71db.js"><link rel="prefetch" href="/blog/assets/js/42.af718b8a.js"><link rel="prefetch" href="/blog/assets/js/43.7a4efaa6.js"><link rel="prefetch" href="/blog/assets/js/44.21916db9.js"><link rel="prefetch" href="/blog/assets/js/45.c02e6427.js"><link rel="prefetch" href="/blog/assets/js/46.c95ab531.js"><link rel="prefetch" href="/blog/assets/js/47.d505fc9f.js"><link rel="prefetch" href="/blog/assets/js/48.9291572a.js"><link rel="prefetch" href="/blog/assets/js/49.79fd5fda.js"><link rel="prefetch" href="/blog/assets/js/5.cc289552.js"><link rel="prefetch" href="/blog/assets/js/50.40ff6888.js"><link rel="prefetch" href="/blog/assets/js/51.d16aa2b4.js"><link rel="prefetch" href="/blog/assets/js/52.4528f49d.js"><link rel="prefetch" href="/blog/assets/js/53.b16b42d4.js"><link rel="prefetch" href="/blog/assets/js/54.4fff7e01.js"><link rel="prefetch" href="/blog/assets/js/55.6832b1c5.js"><link rel="prefetch" href="/blog/assets/js/56.d16f1707.js"><link rel="prefetch" href="/blog/assets/js/57.de08e9ba.js"><link rel="prefetch" href="/blog/assets/js/58.6ca6f21b.js"><link rel="prefetch" href="/blog/assets/js/59.e518317a.js"><link rel="prefetch" href="/blog/assets/js/6.4efa9fa4.js"><link rel="prefetch" href="/blog/assets/js/60.935521f1.js"><link rel="prefetch" href="/blog/assets/js/61.ce9eda13.js"><link rel="prefetch" href="/blog/assets/js/62.e6c745bf.js"><link rel="prefetch" href="/blog/assets/js/63.647fd8d7.js"><link rel="prefetch" href="/blog/assets/js/64.4c9b4781.js"><link rel="prefetch" href="/blog/assets/js/65.80857907.js"><link rel="prefetch" href="/blog/assets/js/66.b89b796a.js"><link rel="prefetch" href="/blog/assets/js/67.b9798c32.js"><link rel="prefetch" href="/blog/assets/js/68.49b67f24.js"><link rel="prefetch" href="/blog/assets/js/69.665837ff.js"><link rel="prefetch" href="/blog/assets/js/7.b94332e9.js"><link rel="prefetch" href="/blog/assets/js/70.ce57ed8e.js"><link rel="prefetch" href="/blog/assets/js/71.71ae5067.js"><link rel="prefetch" href="/blog/assets/js/72.69c7c32d.js"><link rel="prefetch" href="/blog/assets/js/73.6b47b8f7.js"><link rel="prefetch" href="/blog/assets/js/74.bd6cd299.js"><link rel="prefetch" href="/blog/assets/js/75.297a83bc.js"><link rel="prefetch" href="/blog/assets/js/76.e49268ee.js"><link rel="prefetch" href="/blog/assets/js/77.6efa828f.js"><link rel="prefetch" href="/blog/assets/js/78.c38cb032.js"><link rel="prefetch" href="/blog/assets/js/79.478e1642.js"><link rel="prefetch" href="/blog/assets/js/8.80c6038b.js"><link rel="prefetch" href="/blog/assets/js/80.ff9e57e9.js"><link rel="prefetch" href="/blog/assets/js/81.e3dbf4d0.js"><link rel="prefetch" href="/blog/assets/js/82.270df640.js"><link rel="prefetch" href="/blog/assets/js/83.3bc7036f.js"><link rel="prefetch" href="/blog/assets/js/84.a3ccc99e.js"><link rel="prefetch" href="/blog/assets/js/85.7cdab723.js"><link rel="prefetch" href="/blog/assets/js/86.9f0c2ccd.js"><link rel="prefetch" href="/blog/assets/js/87.b7e93260.js"><link rel="prefetch" href="/blog/assets/js/88.557a99bb.js"><link rel="prefetch" href="/blog/assets/js/89.16a0d8d1.js"><link rel="prefetch" href="/blog/assets/js/9.4fbaf7a8.js"><link rel="prefetch" href="/blog/assets/js/90.52190781.js"><link rel="prefetch" href="/blog/assets/js/91.b9507740.js"><link rel="prefetch" href="/blog/assets/js/92.c0eb92c0.js"><link rel="prefetch" href="/blog/assets/js/93.ca3ba1d1.js"><link rel="prefetch" href="/blog/assets/js/94.a8ffcee7.js"><link rel="prefetch" href="/blog/assets/js/95.23fe688e.js"><link rel="prefetch" href="/blog/assets/js/96.b5d64bc6.js"><link rel="prefetch" href="/blog/assets/js/97.c41d4d64.js"><link rel="prefetch" href="/blog/assets/js/98.c415501d.js"><link rel="prefetch" href="/blog/assets/js/99.ab069b22.js"> <link rel="stylesheet" href="/blog/assets/css/0.styles.2dde6c16.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/assets/logo.jpg" alt="全栈修炼" class="logo"> <span class="site-name can-hide">全栈修炼</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/guide/" class="nav-link">主页</a></div><div class="nav-item"><a href="/blog/views/" class="nav-link router-link-active">大前端</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/views/fe-interview/webpack-performance-optimization.html" class="nav-link router-link-exact-active router-link-active">zh-CN</a></li><li class="dropdown-item"><!----> <a href="/blog/en/" class="nav-link">en-US</a></li></ul></div></div> <a href="https://github.com/GolderBrother/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/guide/" class="nav-link">主页</a></div><div class="nav-item"><a href="/blog/views/" class="nav-link router-link-active">大前端</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/views/fe-interview/webpack-performance-optimization.html" class="nav-link router-link-exact-active router-link-active">zh-CN</a></li><li class="dropdown-item"><!----> <a href="/blog/en/" class="nav-link">en-US</a></li></ul></div></div> <a href="https://github.com/GolderBrother/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/blog/views/" class="sidebar-link">大前端知识大集合</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>GitHub 软技能</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/github/follow.html" class="sidebar-link">GitHub 挖宝技巧</a></li><li><a href="/blog/views/github/star.html" class="sidebar-link">GitHub 吸星大法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>浏览器工作原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/browser/input-url-course.html" class="sidebar-link">导航流程：从输入 URL 到页面展示，这中间发生了什么</a></li><li><a href="/blog/views/browser/dom-bind-event.html" class="sidebar-link">一个DOM元素绑定多个事件时，先执行冒泡还是捕获</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>css</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/css/css-skills1.html" class="sidebar-link">10 个让你受益匪浅的 css 使用技巧</a></li><li><a href="/blog/views/css/css-knowledge.html" class="sidebar-link">你未必知道的 49 个 CSS 知识点</a></li><li><a href="/blog/views/css/css-knowledge2.html" class="sidebar-link">你未必知道的 49 个 CSS 知识点二~</a></li><li><a href="/blog/views/css/css-center.html" class="sidebar-link">一起搞懂 CSS 水平居中与垂直居中的 16 个方法</a></li><li><a href="/blog/views/css/css-flex.html" class="sidebar-link">弹性盒子中 flex: 0 1 auto 表示什么意思</a></li><li><a href="/blog/views/css/css-BFC.html" class="sidebar-link">CSS 中的 BFC 详解</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>移动端h5</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/h5/h5-demo1.html" class="sidebar-link">移动端 H5 和 Hybrid 相关基础技术概览</a></li><li><a href="/blog/views/mobile/mobile-skill.html" class="sidebar-link">总结移动端 H5 开发常用技巧</a></li><li><a href="/blog/views/mobile/mobile-optmization.html" class="sidebar-link">关于移动端体验优化经验总结</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Javascript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/javascript/js-skills.html" class="sidebar-link">你可能不知道的 JS 开发技巧</a></li><li><a href="/blog/views/javascript/js-skills2.html" class="sidebar-link">一个合格的中级前端er需要掌握的 28 个 JavaScript 技巧</a></li><li><a href="/blog/views/javascript/js-utils.html" class="sidebar-link">书到用时方恨少，一大波 JS 开发工具函数来了</a></li><li><a href="/blog/views/javascript/js-utils2.html" class="sidebar-link">前端常用的 60 余种工具方法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Typescript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/typescript/ts-demo.html" class="sidebar-link">TypeScript 高级用法详解</a></li><li><a href="/blog/views/typescript/ts-difficult.html" class="sidebar-link">TypeScript 重难点梳理</a></li><li><a href="/blog/views/typescript/ts-problem.html" class="sidebar-link">TS 常见问题整理（60 多个）</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue.js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/vue/vue-ts.html" class="sidebar-link">Vue + TS + El 搭建博客及踩坑记</a></li><li><a href="/blog/views/vue/vue-lazyload.html" class="sidebar-link">vue 路由懒加载及组件懒加载</a></li><li><a href="/blog/views/vue/vue-skills-36.html" class="sidebar-link">Vue 开发必须知道的 36 个技巧</a></li><li><a href="/blog/views/vue/vue-interview.html" class="sidebar-link">30 道 Vue 面试题，内含详细讲解（涵盖入门到精通，自测 Vue 掌握程度）</a></li><li><a href="/blog/views/vue/vue-interview/part-one/note.html" class="sidebar-link">Vue 面试题汇总</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React.js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/react/react-hooks.html" class="sidebar-link">React Hooks 相关 API 总结</a></li><li><a href="/blog/views/react/react-lifecycle.html" class="sidebar-link">React v16.0 前的生命周期</a></li><li><a href="/blog/views/react/react-skill.html" class="sidebar-link">5 个技巧助你编写更好的 React 代码</a></li><li><a href="/blog/views/react/react-nice-library.html" class="sidebar-link">5 个很棒的 React.js 库，值得你亲手试试！</a></li><li><a href="/blog/views/react/react-interview.html" class="sidebar-link">35 道咱们必须要清楚的 React 面试题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React-Native</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/react-native/RN&amp;Native-message.html" class="sidebar-link">React Native 跟原生之间的通信</a></li><li><a href="/blog/views/react-native/ReactNative&amp;Flutter&amp;uni-app.html" class="sidebar-link">一、技术学习成本和难度</a></li><li><a href="/blog/views/react-native/ReactNative&amp;Flutter&amp;uni-app.html" class="sidebar-link">一、技术学习成本和难度</a></li><li><a href="/blog/views/react-native/codepush-config.html" class="sidebar-link">RN 配置热更新+使用文档</a></li><li><a href="/blog/views/react-native/codepush-deploy.html" class="sidebar-link">React Native + 热更新(Code Push) 部署文档</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/webpack/webpack1.html" class="sidebar-link">一大波 Webpack 面试题来啦~</a></li><li><a href="/blog/views/webpack/webpack-optimize.html" class="sidebar-link">webpack 优化篇</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端跨域相关</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/cors/corssOrigin-pro.html" class="sidebar-link">10 种跨域解决方案（附终极方案）</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>vite</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/vite/vite-study.html" class="sidebar-link">vite原理剖析</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>cli</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/cli/james-cli.html" class="sidebar-link">手撸一个自己的前端脚手架</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Node.js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/node/node1.html" class="sidebar-link">/views/node/node1.html</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端设计模式之美</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/fe-design/fe-design-9.html" class="sidebar-link">前端应知应会的 9 种设计模式(详细篇)</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端数据结构之美</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/data-structure/data-structure.html" class="sidebar-link">前端数据结构之美</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端算法学习指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/algorithms/sort.html" class="sidebar-link">十大经典算法</a></li><li><a href="/blog/views/algorithms/interview.html" class="sidebar-link">面试必刷-《剑指 offer》刷题小结</a></li><li><a href="/blog/views/algorithms/string.html" class="sidebar-link">字符串相关算法</a></li><li><a href="/blog/views/algorithms/array.html" class="sidebar-link">数组串相关算法</a></li><li><a href="/blog/views/algorithms/linklist.html" class="sidebar-link">链表相关算法题</a></li><li><a href="/blog/views/algorithms/tree.html" class="sidebar-link">二叉树相关算法</a></li><li><a href="/blog/views/algorithms/tencent/array&amp;string.html" class="sidebar-link">腾讯算法题-数组与字符串</a></li><li><a href="/blog/views/algorithms/tencent/number.html" class="sidebar-link">腾讯算法题-数学与数字</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端面试集锦</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/fe-interview/alibaba.html" class="sidebar-link">阿里面试题</a></li><li><a href="/blog/views/fe-interview/bytedance.html" class="sidebar-link">字节跳动面试题</a></li><li><a href="/blog/views/fe-interview/bytedance-algorithms.html" class="sidebar-link">字节跳动算法题</a></li><li><a href="/blog/views/fe-interview/tencent.html" class="sidebar-link">微信面试题</a></li><li><a href="/blog/views/fe-interview/classic-layout.html" class="sidebar-link">掌握两大经典布局方案</a></li><li><a href="/blog/views/fe-interview/web-safe.html" class="sidebar-link">谈谈 web 安全问题及解决方案</a></li><li><a href="/blog/views/fe-interview/http&amp;https.html" class="sidebar-link">http2/http3 协议有什么优劣</a></li><li><a href="/blog/views/fe-interview/webpack-performance-optimization.html" class="active sidebar-link">Webpack 性能优化你知道哪些</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/views/fe-interview/webpack-performance-optimization.html#优化开发体验" class="sidebar-link">优化开发体验</a></li><li class="sidebar-sub-header"><a href="/blog/views/fe-interview/webpack-performance-optimization.html#优化输出质量" class="sidebar-link">优化输出质量</a></li><li class="sidebar-sub-header"><a href="/blog/views/fe-interview/webpack-performance-optimization.html#如何更好地优化打包资源" class="sidebar-link">如何更好地优化打包资源</a></li><li class="sidebar-sub-header"><a href="/blog/views/fe-interview/webpack-performance-optimization.html#使用-thread-loader-加速构建" class="sidebar-link">使用 thread-loader 加速构建</a></li><li class="sidebar-sub-header"><a href="/blog/views/fe-interview/webpack-performance-optimization.html#参考资料" class="sidebar-link">参考资料</a></li><li class="sidebar-sub-header"><a href="/blog/views/fe-interview/webpack-performance-optimization.html#最后" class="sidebar-link">最后</a></li></ul></li><li><a href="/blog/views/fe-interview/webpack-principle.html" class="sidebar-link">说说 webpack 打包的原理</a></li><li><a href="/blog/views/fe-interview/webpack-HMR.html" class="sidebar-link">HMR 的原理是什么</a></li><li><a href="/blog/views/fe-interview/chrome-start-process.html" class="sidebar-link">Chrome 打开一个页面需要启动多少进程？分别有哪些进程</a></li><li><a href="/blog/views/fe-interview/dns-prefetch.html" class="sidebar-link">谈谈你对 dns-prefetch 的理解</a></li><li><a href="/blog/views/fe-interview/browser-cache.html" class="sidebar-link">浏览器缓存一探究竟~</a></li><li><a href="/blog/views/fe-interview/send-content-to-browser.html" class="sidebar-link">如何保证页面文件能被完整送达浏览器</a></li><li><a href="/blog/views/fe-interview/browser-render.html" class="sidebar-link">浏览器渲染过程是怎样的</a></li><li><a href="/blog/views/fe-interview/browser-reflow&amp;repain.html" class="sidebar-link">如何理解回流和重绘</a></li><li><a href="/blog/views/fe-interview/renderEngine-createNewLayer.html" class="sidebar-link">渲染引擎什么情况下才会为特定的节点创建新的图层</a></li><li><a href="/blog/views/fe-interview/UDP&amp;TCP-different.html" class="sidebar-link">UDP 和 TCP 有什么区别</a></li><li><a href="/blog/views/fe-interview/js-modules.html" class="sidebar-link">说说 js 的模块化</a></li><li><a href="/blog/views/fe-interview/lazyMan.html" class="sidebar-link">实现一个 LazyMan，可以按照以下方式调用</a></li><li><a href="/blog/views/fe-interview/handwriting-promise.html" class="sidebar-link">少年，来，手写一个 Promise 吧</a></li><li><a href="/blog/views/fe-interview/fetch&amp;ajax-diference.html" class="sidebar-link">请说下 fetch 和 ajax 的区别吧</a></li><li><a href="/blog/views/fe-interview/browser-input-url.html" class="sidebar-link">细说浏览器输入 URL 后发生了什么</a></li><li><a href="/blog/views/fe-interview/picture-optimization.html" class="sidebar-link">前端的图片优化方案你知道多少</a></li><li><a href="/blog/views/fe-interview/node-eventLoop.html" class="sidebar-link">来，说说 node 的事件循环机制吧</a></li><li><a href="/blog/views/fe-interview/browser-eventLoop.html" class="sidebar-link">小伙子，谈谈浏览器端的事件循环吧</a></li><li><a href="/blog/views/fe-interview/setTimeout&amp;setImmediate.html" class="sidebar-link">node中的setTimeout 和 setImmediate有什么区别</a></li><li><a href="/blog/views/fe-interview/js-interview.html" class="sidebar-link">收集一些 javascript 相关的面试题</a></li><li><a href="/blog/views/fe-interview/fuck-interview.html" class="sidebar-link">那些恶心的面试题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端必知必会的网络基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/network/http-interview.html" class="sidebar-link">HTTP 灵魂之问，巩固你的 HTTP 知识体系</a></li><li><a href="/blog/views/network/tcp-interview.html" class="sidebar-link">TCP 协议灵魂之问，巩固你的网络底层基础</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端应知应会的Nginx知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/nginx/nginx-details.html" class="sidebar-link">Nginx 从入门到实践，万字详解！</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端必不可少的git知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/git/git-command-animation.html" class="sidebar-link">相见恨晚的 Git 命令动画演示，一看就懂！</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端性能优化专题，让你的网站飞起来吧</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/performance/code-split.html" class="sidebar-link">项目不知道如何做性能优化？不妨试试代码分割吧</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端高手进阶专题，告别小菜鸟</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/fe-advanced/ad1.html" class="sidebar-link">你真的熟悉 HTML 标签吗？</a></li><li><a href="/blog/views/fe-advanced/ad2.html" class="sidebar-link">如何高效操作 DOM 元素？</a></li><li><a href="/blog/views/fe-advanced/ad3.html" class="sidebar-link">3 个使用场景助你用好 DOM 事件</a></li><li><a href="/blog/views/fe-advanced/ad6.html" class="sidebar-link">浏览器如何渲染页面？</a></li><li><a href="/blog/views/fe-advanced/ad7.html" class="sidebar-link">关于 JavaScript 的数据类型，你知多少</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack-性能优化你知道哪些"><a href="#webpack-性能优化你知道哪些" class="header-anchor">#</a> Webpack 性能优化你知道哪些</h1> <h2 id="优化开发体验"><a href="#优化开发体验" class="header-anchor">#</a> 优化开发体验</h2> <h3 id="_1-优化-loader-配置"><a href="#_1-优化-loader-配置" class="header-anchor">#</a> 1. 优化 Loader 配置</h3> <p>由于 <code>Loader</code> 对文件的转换操作很耗时，所以需要让尽可能少的文件被 <code>Loader</code> 处理。可以通过 <code>test include exclude</code> 三个配置项来命中 <code>Loader</code> 要应用规则的文件。</p> <p>示例代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token comment">//如果项目源码中只有js文件，就不要写成/\jsx?$/，以提升正则表达式的性能</span>
        test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
        <span class="token comment">//babel-loader 支持缓存转换出的结果，通过 cacheDirectory 选项开启，一次编译到缓存中，后面直接走缓存</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader?cacheDirectory'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">// 指定编译文件目录：只对项目根目录下 src 目录中的文件采用 babel-loader</span>
        include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>webpack 官方文档中有提到，<a href="https://www.webpackjs.com/loaders/babel-loader/#babel-loader-%E5%BE%88%E6%85%A2-" target="_blank" rel="noopener noreferrer">传送门<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="_2-优化-resolve-modules-配置"><a href="#_2-优化-resolve-modules-配置" class="header-anchor">#</a> 2. 优化 resolve.modules 配置</h3> <p><code>resolve.modules</code> 的默认值是 <code>node_modules</code>，含义是先去当前目录的 <code>node_modules</code> 目录下去找我们想找的模块，如果没找到就去<strong>上一级目录</strong> <code>../node_modules</code> 中找，再没有就去 <code>../../node_modules</code> 中找，以此类推。 这和 <code>Node.js</code> 的模块寻找机制很相似。</p> <p>当安装的第三方模块都放在项目根目录的 <code>node_modules</code> 目录下时，就没有必要按照默认的方式去一层层地寻找，可以指明存放第三方模块的绝对路径，以减少寻找.</p> <p>示例代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    modules<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'node_modules'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-优化-resolve-mainfields-配置"><a href="#_3-优化-resolve-mainfields-配置" class="header-anchor">#</a> 3. 优化 <code>resolve.mainFields</code> 配置</h3> <p>在安装的第三方模块中都会有一个 <code>package.json</code> 文件，用于描述这个模块的属性,其中可以存在多个字段描述入口文件，原因是某些模块可以同时用于多个环境中，针对不同的运行环境需要使用不同的代码。</p> <p><code>resolve.mainFields</code> 的默认值和当前的 <code>target</code> 配置有关系，对应的关系如下。</p> <p><code>target</code> 为 <code>web</code> 或者 <code>webworker</code> 时，值是<code>［'browser','module','main']</code>。
<code>target</code> 为其他情况时，值是 <code>['module','main']</code>。
以 <code>target</code> 等于 <code>web</code> 为例， <code>Webpack</code> 会先采用第三方模块中的 <code>browser</code> 字段去寻找模块的<strong>入口文件</strong>，如果不存在，就采用 <code>module</code> 字段，以此类推。</p> <p>为了减少搜索步骤，在明确第三方模块的<strong>入口文件</strong>描述字段时，我们可以将它设置得尽量少。 由于大多数第三方模块都采用 <code>main</code> 宇段去描述入口文件的位置，所以可以这样配置：</p> <h3 id="_4-优化-resolve-alias-配置"><a href="#_4-优化-resolve-alias-配置" class="header-anchor">#</a> 4. 优化 <code>resolve.alias</code> 配置</h3> <p><code>resolve.alias</code> 配置项通过<strong>别名</strong>来将原导入路径<strong>映射</strong>成一个新的导入路径。</p> <p>在实战项目中经常会依赖一些庞大的第三方模块，以 <code>React</code> 库为例，发布出去的 <code>React</code> 库中包含两套代码</p> <p>一套是采用 <code>CommonJS</code> 规范的模块化代码，这些文件都放在 <code>lib</code> 目录下，以 <code>package.json</code> 中指定的入口文件 <code>react.js</code> 为模块的入口
一套是将 <code>React</code> 的所有相关代码打包好的完整代码放到一个单独的文件中， 这些代码没有采用模块化，可以直接执行。其中 <code>dist/react.js</code> 用于开发环境，里面包含检查和警告的代码。 <code>dist/react.min.js</code> 用于线上环境，被最小化了。</p> <p>在默认情况下， Webpack 会从入口文件 <code>./node_modules/react/react.js</code> 开始递归解析和处理依赖的几十个文件，这会是一个很耗时的操作 通过配置 <code>resolve.alias</code>, 可以让 <code>Webpack</code> 在处理 <code>React</code> 库时，直接使用单独、完整的 <code>react.min.js</code> 文件,从而跳过耗时的<strong>递归解析</strong>操作.</p> <p>示例代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//使用 alias 将导入 react 的语句换成直接使用单独、完整的 react.min.js 文件，</span>
    <span class="token comment">//减少耗时的递归解析操作</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span>
      react<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./node_modules/react/dist/react.min.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>但是，对某些库使用本优化方法后，会影响到使用 Tree-Sharking 去除无效代码的优化，因为打包好的完整文件中有部分代码在我们的项目中可能永远用不上。一般对整体性比较强的库采用本方法优化，因为完整文件中的代码是一个整体，每一行都是不可或缺的, 但是对于一些工具类的库，则不建议用此方法。</p> <h3 id="_5-优化-resolve-extensions-配置"><a href="#_5-优化-resolve-extensions-配置" class="header-anchor">#</a> 5. 优化 resolve.extensions 配置</h3> <p>在导入语句没带文件后缀时，<code>Webpack</code> 会自动带上<strong>后缀</strong>去尝试询问文件是否存在。如果这个列表越长，或者正确的<strong>后缀</strong>越往后，就会造成尝试的次数越多，所以 <code>resolve.extensions</code> 的配置也会影响到<strong>构建</strong>的性能, 在配置 <code>resolve.extensions</code> 时需要遵守 以下几点，以做到尽可能地优化构建性能。</p> <ul><li><strong>后缀</strong>尝试列表要尽可能小，不要将项目中不可能存在的情况写到<strong>后缀</strong>尝试列表中。</li> <li>频率出现最高的文件<strong>后缀</strong>要优先放在最前面，以做到<strong>尽快退出</strong>寻找过程。</li> <li>在源码中写导入语句时，要尽可能带上<strong>后缀</strong> 从而可以避免寻找过程。例如在确定的情况下将 <code>require ( './data ')</code> 写成 <code>require （'./data.json')</code></li></ul> <p>示例代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//尽可能减少后缀尝试的可能性</span>
    extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'js'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_6-优化-module-noparse-配置"><a href="#_6-优化-module-noparse-配置" class="header-anchor">#</a> 6. 优化 <code>module.noParse</code> 配置</h3> <p><code>module.noParse</code> 配置项可以让 <code>Webpack</code> <strong>忽略</strong>对部分没采用模块化的文件的<strong>递归解析</strong>处理，这样做的好处是能<strong>提高构建性能</strong>。原因是一些库如 <code>jQuery</code>, 就不用去编译解析了。</p> <p>示例代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    noParse<span class="token operator">:</span> <span class="token regex">/jquery/</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_7-使用-dllplugin"><a href="#_7-使用-dllplugin" class="header-anchor">#</a> 7. 使用 <code>DllPlugin</code></h3> <p><code>DLLPlugin</code> 和 <code>DLLReferencePlugin</code> 用某种方法实现了拆分 <code>bundles</code>，同时还大大<strong>提升了构建的速度</strong>。</p> <p>包含大量复用模块的<code>动态链接库</code><strong>只需被编译一次</strong>，在之后的构建过程中被<code>动态链接库</code>包含的模块将不会重新编译，而是直接使用<code>动态链接库</code>中 的代码, 由于动态链接库中大多数包含的是常用的第三方模块，例如 <code>react、react-dom</code> ，所以只要不升级这些模块的版本，<strong>动态链接库</strong>就不用重新编译, 减少不必要的构建开销，大大提高了<strong>构建性能</strong>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// https://github.com/webpack/webpack/tree/master/examples/dll-user</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// mode: &quot;development || &quot;production&quot;,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      context<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'..'</span><span class="token punctuation">,</span> <span class="token string">'dll'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      manifest<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../dll/dist/alpha-manifest.json'</span><span class="token punctuation">)</span> <span class="token comment">// eslint-disable-line</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      scope<span class="token operator">:</span> <span class="token string">'beta'</span><span class="token punctuation">,</span>
      manifest<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../dll/dist/beta-manifest.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// eslint-disable-line</span>
      extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.jsx'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>这个理解起来不费劲，操作起来很费劲。所幸，在 <code>Webpack5</code> 中已经不用它了，而是用 <code>HardSourceWebpackPlugin</code>，一样的优化效果，但是使用却及其简单</p> <p>示例代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> HardSourceWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'hard-source-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">HardSourceWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>更开心的是，这个插件，<code>webapck4</code> 就可以用啦，赶紧用起来吧～</p> <p><strong>注意：该插件与测量各流程耗时的插件 <code>speed-measure-webpack-plugin</code> 不兼容。</strong></p> <h3 id="_8-使用-happypack"><a href="#_8-使用-happypack" class="header-anchor">#</a> 8. 使用 <code>HappyPack</code></h3> <p><code>Webpack</code> 是单线程模型的，也就是说 <code>Webpack</code> 需要一个一个地处理任务，不能同时处理多个任务。<code>HappyPack</code>将任
务分解给多个<code>子进程</code>去并发执行，<code>子进程</code>处理完后再将结果发送给主进程,从而发挥多核 <code>CPU</code> 电脑的威力。</p> <p>示例代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">const</span> HappyPack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'happypack'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> os <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> happyThreadPool <span class="token operator">=</span> HappyPack<span class="token punctuation">.</span><span class="token function">ThreadPool</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> size<span class="token operator">:</span> os<span class="token punctuation">.</span><span class="token function">cpus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token punctuation">}</span></span><span class="token punctuation">)</span>

    <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
        <span class="token comment">// loader: 'babel-loader',</span>
        loader<span class="token operator">:</span> <span class="token string">'happypack/loader?id=happy-babel-js'</span><span class="token punctuation">,</span> <span class="token comment">// 增加新的HappyPack构建loader</span>
        include<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        id<span class="token operator">:</span> <span class="token string">'happy-babel-js'</span><span class="token punctuation">,</span>
        loaders<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader?cacheDirectory=true'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        threadPool<span class="token operator">:</span> happyThreadPool
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
</code></pre></div><p>在整个 <code>Webpack</code> 构建流程中，最耗时的流程可能就是 <code>Loader</code> 对文件的转换编译操作了，因为要转换的<strong>文件数据量巨大</strong>，而且这些转换操作都只能一个一个地处理, <code>HappyPack</code> 的核心原理就是将这部分任务分解到多个子进程中去<strong>并行处理</strong>，从而减少总的<strong>构建时间</strong>。</p> <h3 id="_9-使用-paralleluglifyplugin"><a href="#_9-使用-paralleluglifyplugin" class="header-anchor">#</a> 9. 使用 <code>ParallelUglifyPlugin</code></h3> <p><code>webpack</code>默认提供了<code>UglifyJS</code>插件来压缩 JS 代码，但是它使用的是<strong>单线程压缩代码</strong>，也就是说多个 js 文件需要被压缩，它需要一个个文件进行压缩。所以说在正式环境打包压缩代码速度非常慢(因为压缩 JS 代码需要先把代码解析成用<code>Object抽象</code>表示的<code>AST语法树</code>，再去应用各种<strong>匹配规则分析</strong>和<strong>处理 AST</strong>，导致这个过程耗时非常大)。</p> <p>当<code>webpack</code>有多个 JS 文件需要输出和压缩时候，原来会使用<code>UglifyJS</code>去一个个压缩并且输出，但是<code>ParallelUglifyPlugin</code>插件则会开启多个<strong>子进程</strong>，把对多个文件压缩的工作分别给多个<strong>子进程</strong>去完成，实际上每个<strong>子进程</strong>还是通过<code>UglifyJS</code>去压缩代码。无非就是变成了<strong>并行处理</strong>该压缩了，<strong>并行处理</strong>多个子任务，效率会更加的提高。</p> <h3 id="_10-优化文件监昕的性能"><a href="#_10-优化文件监昕的性能" class="header-anchor">#</a> 10. 优化文件监昕的性能</h3> <p>在开启监听模式时，默认情况下会监听配置的 <code>Entry</code> 文件和所有 <code>Entry</code> 递归依赖的文件，在这些文件中会有很多存在于 <code>node_modules</code> 下，因为如今的 <code>Web</code> 项目会依赖<strong>大量的第三方模块</strong>， 所以在大多数情况下我们都不可能去编辑 <code>node_modules</code> 下的文件，而是编辑自己建立的<code>源码</code>文件，而一个很大的优化点就是<strong>忽略</strong> <code>node_modules</code> 下的文件，不监听它们。</p> <p>示例代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>export <span class="token operator">=</span> <span class="token punctuation">{</span>
  watchOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//不监听的 node_modules 目录下的文件</span>
    ignored<span class="token operator">:</span> <span class="token regex">/node_modules/</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>采用这种方法优化后， <code>Webpack</code> 消耗的内存和 <code>CPU</code> 将会大大减少。</p> <h3 id="_11-提升体验"><a href="#_11-提升体验" class="header-anchor">#</a> 11. 提升体验</h3> <p>这里主要是介绍几款 webpack 插件来帮助大家提升构建体验，虽然说它们在提升构建效率上对你没有什么太大的帮助，但能让你在等待构建完成的过程中更加舒服。</p> <h4 id="progress-bar-webpack-plugin"><a href="#progress-bar-webpack-plugin" class="header-anchor">#</a> progress-bar-webpack-plugin</h4> <p><a href="https://www.npmjs.com/package/progress-bar-webpack-plugin" target="_blank" rel="noopener noreferrer">传送门<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>这是一款能为你展示构建进度的 <code>Plugin</code>，它的使用方法和普通 <code>Plugin</code> 一样，也不需要传入什么配置。下图就是你加上它之后，在你的终端面板上的效果，在你的终端底部，将会有一个构建的进度条，可以让你清晰的看见构建的执行进度：</p> <p><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/meG6Vo0Mevh6Bs5M42uoQhs6aQ896lqv41n8GFsApwHEmtoTHuzQ9rQ7D87AuibYVKpqSbRcMQDR8xxSmcluKZA/640?wx_fmt=jpeg" alt="img"></p> <h4 id="webpack-build-notifier"><a href="#webpack-build-notifier" class="header-anchor">#</a> webpack-build-notifier</h4> <p><a href="https://www.npmjs.com/package/webpack-build-notifier" target="_blank" rel="noopener noreferrer">传送门<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>这是一款在你构建完成时，能够像<code>微信、Lark</code>这样的 APP 弹出消息的方式，提示你构建已经完成了。也就是说，当你启动构建时，就可以隐藏控制台面板，专心去做其他事情啦，到“点”了自然会来叫你，它的效果就是下面这样，同时还有提示音噢～</p> <p><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/meG6Vo0Mevh6Bs5M42uoQhs6aQ896lqvLm1K6gKOIgfAzbKFqPfUGaTvFmbls8He24pn9oOpfP3ZBzvnEdOsUw/640?wx_fmt=jpeg" alt="img"></p> <h4 id="webpack-dashboard"><a href="#webpack-dashboard" class="header-anchor">#</a> webpack-dashboard</h4> <p><a href="https://www.npmjs.com/package/webpack-dashboard" target="_blank" rel="noopener noreferrer">传送门<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>当然，如果你对 webpack 原始的构建输出不满意的话，也可以使用这样一款 Plugin 来优化你的输出界面，它的效果就是下面这样，这里我就直接上官图啦：</p> <p><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/meG6Vo0Mevh6Bs5M42uoQhs6aQ896lqvWDQewO01X1dssdPcrpbSRhZicmGwCtxsYZ1P9VY76Y9WYGGvp3Xdz5A/640?wx_fmt=jpeg" alt="img"></p> <h2 id="优化输出质量"><a href="#优化输出质量" class="header-anchor">#</a> 优化输出质量</h2> <h3 id="_1-webpack-实现-cdn-的接入"><a href="#_1-webpack-实现-cdn-的接入" class="header-anchor">#</a> 1. Webpack 实现 CDN 的接入</h3> <p>总之，构建需要实现以下几点:</p> <ul><li>静态资源的导入 <code>URL</code> 需要变成指向 <code>DNS</code> 服务的绝对路径的 <code>URL</code>，而不是相对 <code>HTML</code> 文件的</li> <li>静态资源的文件名需要带上由文件内容算出来的 <code>Hash</code> 值，以防止被缓存</li> <li>将不同类型的资源放到不同域名的 <code>DNS</code> 服务上，以防止资源的并行加载被阻塞</li></ul> <p><a href="http://webpack.wuhaolin.cn/4%E4%BC%98%E5%8C%96/4-9CDN%E5%8A%A0%E9%80%9F.html" target="_blank" rel="noopener noreferrer">参考链接<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="_2-使用-tree-shaking"><a href="#_2-使用-tree-shaking" class="header-anchor">#</a> 2. 使用 Tree Shaking</h3> <p><code>Tree Shaking</code> 正常工作的前提是，提交给 <code>Webpack</code> 的 <code>JavaScript</code> 代码必须采用了 <code>ES6</code> 的模块化语法，因为 <code>ES6</code> 模块化语法是静态的，可以进行静态分析。</p> <p>首先，为了将采用 <code>ES6</code> 模块化的代码提交给 <code>Webpack</code> ，需要配置 <code>Babel</code> 以让其保留 <code>ES6</code> 模块化语句。</p> <p>修改 <code>.babelrc</code> 文件如下：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;env&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>第二个要求，需要使用<code>UglifyJsPlugin</code>插件。如果在<code>mode: &quot;production&quot;</code>模式，这个插件已经默认添加了，如果在其它模式下，可以手工添加它。</p> <p>另外要记住的是打开<code>optimization.usedExports</code>。在<code>mode: &quot;production&quot;</code>模式下，它也是默认打开了的。它告诉<code>webpack</code>每个模块明确使用<code>exports</code>。这样之后，<code>webpack</code>会在打包文件中添加诸如<code>/* unused harmony export */</code>这样的注释，其后<code>UglifyJsPlugin</code>插件会对这些注释作出理解。</p> <p>示例代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// npm i -D uglifyjs-webpack-plugin</span>
<span class="token keyword">const</span> UglifyJsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'uglifyjs-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    minimize<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">UglifyJsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    usedExports<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    sideEffects<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-提取公共代码"><a href="#_3-提取公共代码" class="header-anchor">#</a> 3. 提取公共代码</h3> <p>大型网站通常由<strong>多个页面</strong>组成，每个页面都是一个独立的<strong>单页应用</strong>，但由于所有页面都采用同样的技术栈及同一套样式代码，就导致这些页面之间有很多相同的代码。可以使用 <code>splitChunks</code> 进行分包：</p> <p>示例代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
    chunks<span class="token operator">:</span> <span class="token string">&quot;async&quot;</span><span class="token punctuation">,</span>
    minSize<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>
    minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    maxAsyncRequests<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    maxInitialRequests<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    automaticNameDelimiter<span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
        vendors<span class="token operator">:</span> <span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token regex">/[\\/]node_modules[\\/]/</span><span class="token punctuation">,</span>
            priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
            reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-分割代码以按需加载"><a href="#_4-分割代码以按需加载" class="header-anchor">#</a> 4. 分割代码以按需加载</h3> <p><code>Webpack</code> 支持两种动态代码拆分技术：</p> <p>符合 <code>ECMAScript proposal</code> 的 <code>import()</code> 语法，推荐使用
传统的 require.ensure
<code>import()</code> 用于动态加载模块，其引用的模块及子模块会被分割打包成一个独立的 <code>chunk</code>。</p> <p><code>Webpack</code> 还允许以<strong>注释</strong>的方式传参，这种专业名词为 <strong>魔术字符串</strong>，是用来对编译后的代码块文件命名，进而更好的生成 <code>chunk</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// single target</span>
<span class="token keyword">import</span><span class="token punctuation">(</span>
  <span class="token comment">/* webpackChunkName: &quot;my-chunk-name&quot; */</span>
  <span class="token comment">/* webpackMode: &quot;lazy&quot; */</span>
  <span class="token string">'module'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// multiple possible targets</span>
<span class="token keyword">import</span><span class="token punctuation">(</span>
  <span class="token comment">/* webpackInclude: /\.json$/ */</span>
  <span class="token comment">/* webpackExclude: /\.noimport\.json$/ */</span>
  <span class="token comment">/* webpackChunkName: &quot;my-chunk-name&quot; */</span>
  <span class="token comment">/* webpackMode: &quot;lazy&quot; */</span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./locale/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>language<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>回归到实际业务场景，页面基本上都是通过路由的方式呈现，如果按照路由的方式实现<strong>页面级的异步加载</strong>，岂不是方便很多。例如，<code>react</code> 中可使用 <code>loadable</code> :</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Route <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> loadable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-common-lib'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Test <span class="token operator">=</span> <span class="token function">loadable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">loader</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./test'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">AppRouter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">&quot;/test&quot;</span> exact component<span class="token operator">=</span><span class="token punctuation">{</span>Test<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_5-分析工具"><a href="#_5-分析工具" class="header-anchor">#</a> 5. 分析工具</h3> <p><a href="http://webpack.github.io/analyse/" target="_blank" rel="noopener noreferrer">官方可视化工具<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="如何更好地优化打包资源"><a href="#如何更好地优化打包资源" class="header-anchor">#</a> 如何更好地优化打包资源</h2> <p>原则</p> <p>一般谈到打包会有两方面的意思，第一在于提高打包的速度，第二在于对打包后的静态资源的优化。而对于静态资源的优化又不仅仅是打包提及的缩减。</p> <p>对于打包资源优化的总体原则，在于尽可能的减少或者延迟模块的引用。主要遵循以下三点</p> <ul><li>减小打包的整体体积</li> <li><code>Code Splitting</code>: 按需加载，优化页面首次加载体积。如根据路由按需加载，根据是否可见按需加载</li> <li><code>Bundle Splitting</code>：分包，根据模块更改频率分层次打包，充分利用缓存</li></ul> <h3 id="_01-减小打包的整体体积"><a href="#_01-减小打包的整体体积" class="header-anchor">#</a> 01 减小打包的整体体积</h3> <h4 id="代码压缩"><a href="#代码压缩" class="header-anchor">#</a> 代码压缩</h4> <p>代码压缩可以非常可观地减小资源打包体积，但是它的可操作性空间过小。可操作性低的意思是这一项不太容易出现在晋级评审的 PPT 上，如同 <code>CDN</code> 在网站性能优化的重要程度一样，重要但不归你做(或者傻瓜式配置)。</p> <p>它良好的模块化，以致于 <code>webpack</code> 就自作主张在生产环境中默认把这件事给做了。</p> <p>那它是如何压缩代码的？最典型的两种方法就是<strong>空白符替换</strong>以及<strong>缩短变量名</strong>，如代码所示，仅仅通过这两种方式就大大压缩了 <code>javascript</code> 资源：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 压缩前</span>
<span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">first<span class="token punctuation">,</span> second</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> first <span class="token operator">+</span> second<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 压缩后</span>
<span class="token keyword">function</span> <span class="token function">s</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="移除不必要的模块"><a href="#移除不必要的模块" class="header-anchor">#</a> 移除不必要的模块</h4> <p>这句话好像是废话，但它却是真正有用并且极为容易实现的一点。</p> <p>在以下代码中，对 <code>lodash</code> 这个模块进行了引入，但在之后的代码中并无使用 <code>lodash</code>，那在 webpack 中这个模块还会继续打包吗？</p> <p>很遗憾，仍会对它进行打包。但好消息是这一点优化起来相当简单。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 仅仅引入而未在代码中使用，该模块仍然会被打包</span>
<span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span><span class="token punctuation">;</span>
</code></pre></div><p>对于这类问题总应该防患于未然，扼杀于摇篮中。eslint 的用武之地来了，它除了统一团队的代码风格以外，也用来提高团队的代码质量以及性能。</p> <h4 id="选择可替代的体积较小的模块"><a href="#选择可替代的体积较小的模块" class="header-anchor">#</a> 选择可替代的体积较小的模块</h4> <p>针对这一条，有一个典型的例子是以体积过大而臭名昭著的 <code>moment.js</code> 模块，它仅仅用于 <code>DateTime</code> 的格式化及各种计算。但你 <code>import</code> 之后它的体积竟然达到了 <code>200kb+</code>，gzip 后仍然有 <code>69kb</code>。以至于在 <code>github</code> 上有一个仓库专门用来介绍如何优化它</p> <ul><li><a href="https://github.com/jmblog/how-to-optimize-momentjs-with-webpack" target="_blank" rel="noopener noreferrer">How to optimize moment.js with webpack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>此时可以选择一个可替代它功能，但体积更小的模块。与 <code>moment.js API</code> 兼容的 <code>day.js</code>，它 <code>gzip</code> 后体积仅仅只有 <code>2kb</code>。</p> <h4 id="按需引入模块"><a href="#按需引入模块" class="header-anchor">#</a> 按需引入模块</h4> <p>当你面对一个巨无霸的，捆绑式的大型模块时，可能你并不会使用到它的所有的功能，你只需要按照你的需求引入模块就可以了。那经常会有哪些巨无霸模块呢？</p> <p>如 <code>lodash (勉强算)</code>，<code>antd</code>，<code>echarts</code>，我相信这三个模块对于以 React 为主的前端工程师都或多或少使用过。对你所需要使用的模块单独引入：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> DatePicker <span class="token keyword">from</span> <span class="token string">'antd/es/date-picker'</span><span class="token punctuation">;</span> <span class="token comment">// for js</span>
<span class="token keyword">import</span> <span class="token string">'antd/es/date-picker/style/css'</span><span class="token punctuation">;</span> <span class="token comment">// for css</span>

<span class="token keyword">import</span> <span class="token keyword">get</span> <span class="token keyword">from</span> <span class="token string">'lodash.get'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_02-code-splitting-按需加载，优化页面首次加载体积"><a href="#_02-code-splitting-按需加载，优化页面首次加载体积" class="header-anchor">#</a> 02 Code Splitting: 按需加载，优化页面首次加载体积</h3> <p>懒加载，如果面试中提到懒加载的话，大概率面试官此时是想问你关于图片懒加载的问题。</p> <blockquote><p>前端开发中的图片懒加载如何实现</p></blockquote> <p>在屏幕可视区域外，对<code>img</code>标签自定义标签属性<code>data-src</code>来赋予图片的<code>src</code>地址，待滚动到<code>可视区域内</code>, 在将 <code>data-src</code> 值 替换成 <code>src</code> 值，也就是等到了<strong>需要的时候</strong>才去加载对应的图片，这样就达到 <strong>图片懒加载</strong> 效果</p> <p>通过 <code>Code Splitting</code> 可以只加载当前所需要的核心资源：</p> <ul><li>如果你处在首页，并且首页中有占用资源过重的图表，需要对图表懒加载，否则它会大幅拖垮应用的首次渲染，加大白屏时间</li> <li>如果你处在首页，你无需加载当前不可见屏幕下方的复杂组件</li> <li>如果你处在页面 A，你没有必要加载页面 B 的资源</li></ul> <p>他们实现起来均需要额外编写代码，所以可操作性中等，但是好在它能够带来极大的益处，投资回报率较高，操作起来也极为简单，接下来就属于体力活了：</p> <ul><li>使用 <code>import()</code> 动态加载模块</li> <li>使用 <code>React.lazy()</code> 动态加载组件</li> <li>使用 <code>lodable-component</code> 动态加载路由，组件或者模块</li></ul> <p>大部分情况下，你只要做一个莫得感情的 API 工程师调用以上三个 API 就可以解决问题，大幅度降低页面的首次加载体积。但是在前往高级前端工程师的路上，你有可能需要了解其中的原理，<s>(有可能并不需要，数据比原理重要)</s> 来做更加精细化的控制，比如针对缓存。</p> <h3 id="_03-bundle-splitting"><a href="#_03-bundle-splitting" class="header-anchor">#</a> 03 Bundle Splitting</h3> <p>除了资源体积上的优化，另一个大的优化就是<strong>缓存</strong>。单页应用有一个最好的方面，就是所有资源都是带有<strong>指纹信息</strong>的，这意味着所有的资源都是能够设置<strong>永久缓存</strong>的。</p> <p>但仅仅如此了吗？</p> <p>如果你所有的 js 资源都打包成一个文件，它确实有<strong>永久缓存</strong>的优势。但是当有一行文件进行修改时，这一个大包的<strong>指纹信息</strong>发生改变，<strong>永久缓存</strong>失效。</p> <p>所以我们现在需要做到的是：当修改文件后，造成<strong>最小范围</strong>的缓存失效，这样便能够更充分的利用缓存，减小宽带，减小服务器费用。一个好消息是 <code>webpack</code> 等打包工具虽然在 <code>optimization</code> 上内置了很多性能优化，但它不会帮你做这件事，它并不知道你有哪些模块，以及这些模块的重要紧急程度，你终于可以大展拳脚了。</p> <p>此时我们可以对资源进行分层次缓存的打包方案，这是一个建议方案</p> <ul><li><code>webpack-runtime</code>: 应用中的 <code>webpack</code> 的版本比较稳定，分离出来，保证长久的永久缓存</li> <li><code>react-runtime</code>: <code>react</code> 的版本更新频次也较低</li> <li><code>vundor</code>: 常用的第三方模块打包在一起，如 <code>lodash</code>，<code>classnames</code> 基本上每个页面都会引用到，但是它们的更新频率会更高一些</li></ul> <p>随着 <code>http2</code> 的发展，特别是多路复用，初始页面的静态资源不受资源数量的影响。因此为了更好的<strong>缓存效果</strong>以及<strong>按需加载</strong>，也有很多方案建议把所有的<strong>第三方模块进行单模块打包</strong>。</p> <p>在 <code>webpack</code> 中，使用 <code>splitChunks.cacheGroups</code> 分割代码，配置缓存组如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
    cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
      react<span class="token operator">:</span> <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/[\\/]node_modules[\\/](react|react-dom &quot;\\/</span><span class="token punctuation">]</span>node_modules<span class="token punctuation">[</span>\\<span class="token regex">/&quot;)[\\/]/</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> <span class="token string">'react'</span><span class="token punctuation">,</span>
        chunks<span class="token operator">:</span> <span class="token string">'all'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      vendor<span class="token operator">:</span> <span class="token punctuation">{</span>

      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  runtimeChunk<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">name</span><span class="token operator">:</span> <span class="token parameter">entrypoint</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">runtime-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>entrypoint<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="使用-thread-loader-加速构建"><a href="#使用-thread-loader-加速构建" class="header-anchor">#</a> 使用 thread-loader 加速构建</h2> <p><strong>webpack4 强力推荐</strong></p> <p>webpack4 官方提供了一个 <a href="https://github.com/amireh/happypack#how-it-works" target="_blank" rel="noopener noreferrer">thread loader<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <blockquote><p>这个 loader 不要跟 <code>happypack</code> 混合使用，会出现编译失败的问题，webpack4 官方已经强烈推荐此方法来替代 <code>happypack</code></p></blockquote> <p>把这个 loader 放置在其他 loader 之前， 放置在这个 loader 之后的 loader 就会在一个单独的 worker【worker pool】 池里运行，一个 worker 就是一个 nodeJS 进程【node.js process】，每个单独进程处理时间上限为 <code>600ms</code>，各个进程的数据交换也会限制在这个时间内。</p> <p>它的配置长这样：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
        include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">'thread-loader'</span>
          <span class="token comment">// your expensive loader (e.g babel-loader)</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>下面是带有 option 的配置:</p> <div class="language-js extra-class"><pre class="language-js"><code>use<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    loader<span class="token operator">:</span> <span class="token string">'thread-loader'</span><span class="token punctuation">,</span>
    <span class="token comment">// loaders with equal options will share worker pools</span>
    <span class="token comment">// 设置同样option的loaders会共享</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// worker的数量，默认是cpu核心数</span>
      workers<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>

      <span class="token comment">// 一个worker并行的job数量，默认为20</span>
      workerParallelJobs<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>

      <span class="token comment">// 添加额外的node js 参数</span>
      workerNodeArgs<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'--max-old-space-size=1024'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

      <span class="token comment">// 允许重新生成一个dead work pool</span>
      <span class="token comment">// 这个过程会降低整体编译速度</span>
      <span class="token comment">// 开发环境应该设置为false</span>
      poolRespawn<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

      <span class="token comment">//空闲多少秒后，干掉work 进程</span>
      <span class="token comment">// 默认是500ms</span>
      <span class="token comment">// 当处于监听模式下，可以设置为无限大，让worker一直存在</span>
      poolTimeout<span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>

      <span class="token comment">// pool 分配给workder的job数量</span>
      <span class="token comment">// 默认是200</span>
      <span class="token comment">// 设置的越低效率会更低，但是job分布会更均匀</span>
      poolParallelJobs<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>

      <span class="token comment">// name of the pool</span>
      <span class="token comment">// can be used to create different pools with elsewise identical options</span>
      <span class="token comment">// pool 的名字</span>
      <span class="token comment">//</span>
      name<span class="token operator">:</span> <span class="token string">'my-pool'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// your expensive loader (e.g babel-loader)</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ul><li>书籍：<code>《Webpack 深入浅出》</code></li> <li><a href="https://blog.csdn.net/QQ729533020/article/details/100589186" target="_blank" rel="noopener noreferrer">Webpack 优化——将你的构建效率提速翻倍<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="最后"><a href="#最后" class="header-anchor">#</a> 最后</h2> <p>文中若有不准确或错误的地方，欢迎指出，有兴趣可以的关注下<a href="https://github.com/GolderBrother" target="_blank" rel="noopener noreferrer">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，一起学习呀~~</p> <div class="gitalk-container"><div id="gitalk-container"></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2020/9/7 下午8:45:37</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/views/fe-interview/http&amp;https.html" class="prev">http2/http3 协议有什么优劣</a></span> <span class="next"><a href="/blog/views/fe-interview/webpack-principle.html">说说 webpack 打包的原理</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.74817549.js" defer></script><script src="/blog/assets/js/2.f761193d.js" defer></script><script src="/blog/assets/js/155.d7bc8987.js" defer></script><script src="/blog/assets/js/23.dbb39e0a.js" defer></script>
  </body>
</html>
