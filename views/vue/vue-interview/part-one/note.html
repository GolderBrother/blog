<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <!-- 为了可以访问第三方图床的图片，才添加了这句代码，如果你的图片是存在本地的，去掉这句代码即可 -->
    <meta id="referrer" name="referrer" content="never" />
    <!-- <meta id="referrer" name="referrer" content="always" /> -->
    <title>Vue 面试题汇总 | 全栈修炼</title>
    <meta name="description" content="GolderBrother的博客" />
    <link rel="icon" href="/blog/assets/favicon.ico">  <link rel="preload" href="/blog/assets/css/0.styles.2dde6c16.css" as="style"><link rel="preload" href="/blog/assets/js/app.74817549.js" as="script"><link rel="preload" href="/blog/assets/js/2.f761193d.js" as="script"><link rel="preload" href="/blog/assets/js/9.4fbaf7a8.js" as="script"><link rel="preload" href="/blog/assets/js/23.dbb39e0a.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.ea66aff3.js"><link rel="prefetch" href="/blog/assets/js/100.1650309e.js"><link rel="prefetch" href="/blog/assets/js/101.dd5cdc51.js"><link rel="prefetch" href="/blog/assets/js/102.81a755d8.js"><link rel="prefetch" href="/blog/assets/js/103.84d1e041.js"><link rel="prefetch" href="/blog/assets/js/104.6bb79eda.js"><link rel="prefetch" href="/blog/assets/js/105.ac0fa491.js"><link rel="prefetch" href="/blog/assets/js/106.e7f21162.js"><link rel="prefetch" href="/blog/assets/js/107.a932b9dd.js"><link rel="prefetch" href="/blog/assets/js/108.08337848.js"><link rel="prefetch" href="/blog/assets/js/109.0a8ac1ac.js"><link rel="prefetch" href="/blog/assets/js/11.2b17f742.js"><link rel="prefetch" href="/blog/assets/js/110.63f713ce.js"><link rel="prefetch" href="/blog/assets/js/111.3ded28af.js"><link rel="prefetch" href="/blog/assets/js/112.feb77183.js"><link rel="prefetch" href="/blog/assets/js/113.ca7a3dfe.js"><link rel="prefetch" href="/blog/assets/js/114.278aaabb.js"><link rel="prefetch" href="/blog/assets/js/115.3f930fa5.js"><link rel="prefetch" href="/blog/assets/js/116.0686a02f.js"><link rel="prefetch" href="/blog/assets/js/117.22090497.js"><link rel="prefetch" href="/blog/assets/js/118.d7f089fa.js"><link rel="prefetch" href="/blog/assets/js/119.3c8db627.js"><link rel="prefetch" href="/blog/assets/js/12.d4feb8d0.js"><link rel="prefetch" href="/blog/assets/js/120.e516c49a.js"><link rel="prefetch" href="/blog/assets/js/121.d702cc4d.js"><link rel="prefetch" href="/blog/assets/js/122.13d4f773.js"><link rel="prefetch" href="/blog/assets/js/123.6905c46b.js"><link rel="prefetch" href="/blog/assets/js/124.ccac9465.js"><link rel="prefetch" href="/blog/assets/js/125.3fad187d.js"><link rel="prefetch" href="/blog/assets/js/126.065c2aad.js"><link rel="prefetch" href="/blog/assets/js/127.d4aef2ae.js"><link rel="prefetch" href="/blog/assets/js/128.00766f11.js"><link rel="prefetch" href="/blog/assets/js/129.51d245ca.js"><link rel="prefetch" href="/blog/assets/js/13.21c8139a.js"><link rel="prefetch" href="/blog/assets/js/130.82b8009d.js"><link rel="prefetch" href="/blog/assets/js/131.fb8da159.js"><link rel="prefetch" href="/blog/assets/js/132.2484fde1.js"><link rel="prefetch" href="/blog/assets/js/133.177fe1b1.js"><link rel="prefetch" href="/blog/assets/js/134.5611fa2b.js"><link rel="prefetch" href="/blog/assets/js/135.4d1053c3.js"><link rel="prefetch" href="/blog/assets/js/136.2973975f.js"><link rel="prefetch" href="/blog/assets/js/137.7c44ba09.js"><link rel="prefetch" href="/blog/assets/js/138.16973a68.js"><link rel="prefetch" href="/blog/assets/js/139.2f797054.js"><link rel="prefetch" href="/blog/assets/js/14.8cf70ab3.js"><link rel="prefetch" href="/blog/assets/js/140.f94ba770.js"><link rel="prefetch" href="/blog/assets/js/141.69f9800f.js"><link rel="prefetch" href="/blog/assets/js/142.b567c447.js"><link rel="prefetch" href="/blog/assets/js/143.f1ee0ada.js"><link rel="prefetch" href="/blog/assets/js/144.138163b4.js"><link rel="prefetch" href="/blog/assets/js/145.e3bee357.js"><link rel="prefetch" href="/blog/assets/js/146.3a9fd8c7.js"><link rel="prefetch" href="/blog/assets/js/147.0b8e88a6.js"><link rel="prefetch" href="/blog/assets/js/148.81da2cf3.js"><link rel="prefetch" href="/blog/assets/js/149.d44d0121.js"><link rel="prefetch" href="/blog/assets/js/15.ea38d450.js"><link rel="prefetch" href="/blog/assets/js/150.7665d423.js"><link rel="prefetch" href="/blog/assets/js/151.1ab5f781.js"><link rel="prefetch" href="/blog/assets/js/152.620db4ac.js"><link rel="prefetch" href="/blog/assets/js/153.695d756f.js"><link rel="prefetch" href="/blog/assets/js/154.ee82e0a2.js"><link rel="prefetch" href="/blog/assets/js/155.d7bc8987.js"><link rel="prefetch" href="/blog/assets/js/156.95cf0d01.js"><link rel="prefetch" href="/blog/assets/js/157.76159f7e.js"><link rel="prefetch" href="/blog/assets/js/158.e27d7f12.js"><link rel="prefetch" href="/blog/assets/js/159.84d58dcb.js"><link rel="prefetch" href="/blog/assets/js/16.7794197c.js"><link rel="prefetch" href="/blog/assets/js/160.44f17ac0.js"><link rel="prefetch" href="/blog/assets/js/161.a9fc1420.js"><link rel="prefetch" href="/blog/assets/js/162.953ffb8f.js"><link rel="prefetch" href="/blog/assets/js/163.d4b64d04.js"><link rel="prefetch" href="/blog/assets/js/164.d718bdc2.js"><link rel="prefetch" href="/blog/assets/js/165.464562ce.js"><link rel="prefetch" href="/blog/assets/js/166.3486924a.js"><link rel="prefetch" href="/blog/assets/js/167.044ce06a.js"><link rel="prefetch" href="/blog/assets/js/168.81e22c48.js"><link rel="prefetch" href="/blog/assets/js/169.4c4a576c.js"><link rel="prefetch" href="/blog/assets/js/17.7083b50c.js"><link rel="prefetch" href="/blog/assets/js/170.4b71dfab.js"><link rel="prefetch" href="/blog/assets/js/171.d2051e87.js"><link rel="prefetch" href="/blog/assets/js/172.eeb81923.js"><link rel="prefetch" href="/blog/assets/js/173.aafb24fa.js"><link rel="prefetch" href="/blog/assets/js/174.2e261a79.js"><link rel="prefetch" href="/blog/assets/js/175.aafd75a2.js"><link rel="prefetch" href="/blog/assets/js/176.b7681070.js"><link rel="prefetch" href="/blog/assets/js/177.e9bdb5f5.js"><link rel="prefetch" href="/blog/assets/js/178.4a3ca305.js"><link rel="prefetch" href="/blog/assets/js/179.40201a86.js"><link rel="prefetch" href="/blog/assets/js/18.3dbb7741.js"><link rel="prefetch" href="/blog/assets/js/180.68c6346e.js"><link rel="prefetch" href="/blog/assets/js/181.326c1f42.js"><link rel="prefetch" href="/blog/assets/js/182.92780c32.js"><link rel="prefetch" href="/blog/assets/js/183.65f40b5a.js"><link rel="prefetch" href="/blog/assets/js/19.78fd69da.js"><link rel="prefetch" href="/blog/assets/js/20.be39648e.js"><link rel="prefetch" href="/blog/assets/js/21.80a318b4.js"><link rel="prefetch" href="/blog/assets/js/22.4040efb3.js"><link rel="prefetch" href="/blog/assets/js/24.f27f8467.js"><link rel="prefetch" href="/blog/assets/js/25.448302be.js"><link rel="prefetch" href="/blog/assets/js/26.78106ffa.js"><link rel="prefetch" href="/blog/assets/js/27.2a65554d.js"><link rel="prefetch" href="/blog/assets/js/28.55501022.js"><link rel="prefetch" href="/blog/assets/js/29.af733838.js"><link rel="prefetch" href="/blog/assets/js/3.df759ff3.js"><link rel="prefetch" href="/blog/assets/js/30.8ce1d72b.js"><link rel="prefetch" href="/blog/assets/js/31.7925ec43.js"><link rel="prefetch" href="/blog/assets/js/32.f9892d98.js"><link rel="prefetch" href="/blog/assets/js/33.afd7fd02.js"><link rel="prefetch" href="/blog/assets/js/34.ee49fe13.js"><link rel="prefetch" href="/blog/assets/js/35.0e4f5335.js"><link rel="prefetch" href="/blog/assets/js/36.96311e99.js"><link rel="prefetch" href="/blog/assets/js/37.fb3163b1.js"><link rel="prefetch" href="/blog/assets/js/38.778ed95b.js"><link rel="prefetch" href="/blog/assets/js/39.0531a2e1.js"><link rel="prefetch" href="/blog/assets/js/4.bb581d32.js"><link rel="prefetch" href="/blog/assets/js/40.ec9153c6.js"><link rel="prefetch" href="/blog/assets/js/41.2e9e71db.js"><link rel="prefetch" href="/blog/assets/js/42.af718b8a.js"><link rel="prefetch" href="/blog/assets/js/43.7a4efaa6.js"><link rel="prefetch" href="/blog/assets/js/44.21916db9.js"><link rel="prefetch" href="/blog/assets/js/45.c02e6427.js"><link rel="prefetch" href="/blog/assets/js/46.c95ab531.js"><link rel="prefetch" href="/blog/assets/js/47.d505fc9f.js"><link rel="prefetch" href="/blog/assets/js/48.9291572a.js"><link rel="prefetch" href="/blog/assets/js/49.79fd5fda.js"><link rel="prefetch" href="/blog/assets/js/5.cc289552.js"><link rel="prefetch" href="/blog/assets/js/50.40ff6888.js"><link rel="prefetch" href="/blog/assets/js/51.d16aa2b4.js"><link rel="prefetch" href="/blog/assets/js/52.4528f49d.js"><link rel="prefetch" href="/blog/assets/js/53.b16b42d4.js"><link rel="prefetch" href="/blog/assets/js/54.4fff7e01.js"><link rel="prefetch" href="/blog/assets/js/55.6832b1c5.js"><link rel="prefetch" href="/blog/assets/js/56.d16f1707.js"><link rel="prefetch" href="/blog/assets/js/57.de08e9ba.js"><link rel="prefetch" href="/blog/assets/js/58.6ca6f21b.js"><link rel="prefetch" href="/blog/assets/js/59.e518317a.js"><link rel="prefetch" href="/blog/assets/js/6.4efa9fa4.js"><link rel="prefetch" href="/blog/assets/js/60.935521f1.js"><link rel="prefetch" href="/blog/assets/js/61.ce9eda13.js"><link rel="prefetch" href="/blog/assets/js/62.e6c745bf.js"><link rel="prefetch" href="/blog/assets/js/63.647fd8d7.js"><link rel="prefetch" href="/blog/assets/js/64.4c9b4781.js"><link rel="prefetch" href="/blog/assets/js/65.80857907.js"><link rel="prefetch" href="/blog/assets/js/66.b89b796a.js"><link rel="prefetch" href="/blog/assets/js/67.b9798c32.js"><link rel="prefetch" href="/blog/assets/js/68.49b67f24.js"><link rel="prefetch" href="/blog/assets/js/69.665837ff.js"><link rel="prefetch" href="/blog/assets/js/7.b94332e9.js"><link rel="prefetch" href="/blog/assets/js/70.ce57ed8e.js"><link rel="prefetch" href="/blog/assets/js/71.71ae5067.js"><link rel="prefetch" href="/blog/assets/js/72.69c7c32d.js"><link rel="prefetch" href="/blog/assets/js/73.6b47b8f7.js"><link rel="prefetch" href="/blog/assets/js/74.bd6cd299.js"><link rel="prefetch" href="/blog/assets/js/75.297a83bc.js"><link rel="prefetch" href="/blog/assets/js/76.e49268ee.js"><link rel="prefetch" href="/blog/assets/js/77.6efa828f.js"><link rel="prefetch" href="/blog/assets/js/78.c38cb032.js"><link rel="prefetch" href="/blog/assets/js/79.478e1642.js"><link rel="prefetch" href="/blog/assets/js/8.80c6038b.js"><link rel="prefetch" href="/blog/assets/js/80.ff9e57e9.js"><link rel="prefetch" href="/blog/assets/js/81.e3dbf4d0.js"><link rel="prefetch" href="/blog/assets/js/82.270df640.js"><link rel="prefetch" href="/blog/assets/js/83.3bc7036f.js"><link rel="prefetch" href="/blog/assets/js/84.a3ccc99e.js"><link rel="prefetch" href="/blog/assets/js/85.7cdab723.js"><link rel="prefetch" href="/blog/assets/js/86.9f0c2ccd.js"><link rel="prefetch" href="/blog/assets/js/87.b7e93260.js"><link rel="prefetch" href="/blog/assets/js/88.557a99bb.js"><link rel="prefetch" href="/blog/assets/js/89.16a0d8d1.js"><link rel="prefetch" href="/blog/assets/js/90.52190781.js"><link rel="prefetch" href="/blog/assets/js/91.b9507740.js"><link rel="prefetch" href="/blog/assets/js/92.c0eb92c0.js"><link rel="prefetch" href="/blog/assets/js/93.ca3ba1d1.js"><link rel="prefetch" href="/blog/assets/js/94.a8ffcee7.js"><link rel="prefetch" href="/blog/assets/js/95.23fe688e.js"><link rel="prefetch" href="/blog/assets/js/96.b5d64bc6.js"><link rel="prefetch" href="/blog/assets/js/97.c41d4d64.js"><link rel="prefetch" href="/blog/assets/js/98.c415501d.js"><link rel="prefetch" href="/blog/assets/js/99.ab069b22.js"> <link rel="stylesheet" href="/blog/assets/css/0.styles.2dde6c16.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/assets/logo.jpg" alt="全栈修炼" class="logo"> <span class="site-name can-hide">全栈修炼</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/guide/" class="nav-link">主页</a></div><div class="nav-item"><a href="/blog/views/" class="nav-link router-link-active">大前端</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/views/vue/vue-interview/part-one/note.html" class="nav-link router-link-exact-active router-link-active">zh-CN</a></li><li class="dropdown-item"><!----> <a href="/blog/en/" class="nav-link">en-US</a></li></ul></div></div> <a href="https://github.com/GolderBrother/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/guide/" class="nav-link">主页</a></div><div class="nav-item"><a href="/blog/views/" class="nav-link router-link-active">大前端</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/views/vue/vue-interview/part-one/note.html" class="nav-link router-link-exact-active router-link-active">zh-CN</a></li><li class="dropdown-item"><!----> <a href="/blog/en/" class="nav-link">en-US</a></li></ul></div></div> <a href="https://github.com/GolderBrother/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/blog/views/" class="sidebar-link">大前端知识大集合</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>GitHub 软技能</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/github/follow.html" class="sidebar-link">GitHub 挖宝技巧</a></li><li><a href="/blog/views/github/star.html" class="sidebar-link">GitHub 吸星大法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>浏览器工作原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/browser/input-url-course.html" class="sidebar-link">导航流程：从输入 URL 到页面展示，这中间发生了什么</a></li><li><a href="/blog/views/browser/dom-bind-event.html" class="sidebar-link">一个DOM元素绑定多个事件时，先执行冒泡还是捕获</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>css</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/css/css-skills1.html" class="sidebar-link">10 个让你受益匪浅的 css 使用技巧</a></li><li><a href="/blog/views/css/css-knowledge.html" class="sidebar-link">你未必知道的 49 个 CSS 知识点</a></li><li><a href="/blog/views/css/css-knowledge2.html" class="sidebar-link">你未必知道的 49 个 CSS 知识点二~</a></li><li><a href="/blog/views/css/css-center.html" class="sidebar-link">一起搞懂 CSS 水平居中与垂直居中的 16 个方法</a></li><li><a href="/blog/views/css/css-flex.html" class="sidebar-link">弹性盒子中 flex: 0 1 auto 表示什么意思</a></li><li><a href="/blog/views/css/css-BFC.html" class="sidebar-link">CSS 中的 BFC 详解</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>移动端h5</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/h5/h5-demo1.html" class="sidebar-link">移动端 H5 和 Hybrid 相关基础技术概览</a></li><li><a href="/blog/views/mobile/mobile-skill.html" class="sidebar-link">总结移动端 H5 开发常用技巧</a></li><li><a href="/blog/views/mobile/mobile-optmization.html" class="sidebar-link">关于移动端体验优化经验总结</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Javascript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/javascript/js-skills.html" class="sidebar-link">你可能不知道的 JS 开发技巧</a></li><li><a href="/blog/views/javascript/js-skills2.html" class="sidebar-link">一个合格的中级前端er需要掌握的 28 个 JavaScript 技巧</a></li><li><a href="/blog/views/javascript/js-utils.html" class="sidebar-link">书到用时方恨少，一大波 JS 开发工具函数来了</a></li><li><a href="/blog/views/javascript/js-utils2.html" class="sidebar-link">前端常用的 60 余种工具方法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Typescript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/typescript/ts-demo.html" class="sidebar-link">TypeScript 高级用法详解</a></li><li><a href="/blog/views/typescript/ts-difficult.html" class="sidebar-link">TypeScript 重难点梳理</a></li><li><a href="/blog/views/typescript/ts-problem.html" class="sidebar-link">TS 常见问题整理（60 多个）</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Vue.js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/vue/vue-ts.html" class="sidebar-link">Vue + TS + El 搭建博客及踩坑记</a></li><li><a href="/blog/views/vue/vue-lazyload.html" class="sidebar-link">vue 路由懒加载及组件懒加载</a></li><li><a href="/blog/views/vue/vue-skills-36.html" class="sidebar-link">Vue 开发必须知道的 36 个技巧</a></li><li><a href="/blog/views/vue/vue-interview.html" class="sidebar-link">30 道 Vue 面试题，内含详细讲解（涵盖入门到精通，自测 Vue 掌握程度）</a></li><li><a href="/blog/views/vue/vue-interview/part-one/note.html" class="active sidebar-link">Vue 面试题汇总</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_1-谈一下你对mvvm原理的理解" class="sidebar-link">1.谈一下你对MVVM原理的理解</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_2-请说一下响应式数据的原理" class="sidebar-link">2.请说一下响应式数据的原理</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_3-vue中是如何检测数组变化" class="sidebar-link">3.Vue中是如何检测数组变化</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_4-为何vue采用异步渲染" class="sidebar-link">4.为何Vue采用异步渲染</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_5-nexttick实现原理" class="sidebar-link">5.nextTick实现原理</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_6-vue中computed的特点" class="sidebar-link">6.Vue中Computed的特点</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_7-watch中的deep-true-是如何实现的" class="sidebar-link">7.Watch中的deep:true 是如何实现的</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_8-vue组件的生命周期" class="sidebar-link">8.Vue组件的生命周期</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_9-ajax请求放在哪个生命周期中" class="sidebar-link">9.ajax请求放在哪个生命周期中</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_10-何时需要使用beforedestroy" class="sidebar-link">10.何时需要使用beforeDestroy</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_11-vue中模板编译原理" class="sidebar-link">11.Vue中模板编译原理</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_12-vue中v-if和v-show的区别" class="sidebar-link">12.Vue中v-if和v-show的区别</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_13-为什么v-for和v-if不能连用" class="sidebar-link">13.为什么V-for和v-if不能连用</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_14-用vnode来描述一个dom结构" class="sidebar-link">14.用vnode来描述一个DOM结构</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_15-diff算法的时间复杂度" class="sidebar-link">15.diff算法的时间复杂度</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_16-简述vue中diff算法原理" class="sidebar-link">16.简述Vue中diff算法原理</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_17-v-for中为什么要用key-图解" class="sidebar-link">17.v-for中为什么要用key (图解)</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_18-描述组件渲染和更新过程" class="sidebar-link">18.描述组件渲染和更新过程</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_19-组件中的-data为什么是一个函数" class="sidebar-link">19.组件中的 data为什么是一个函数?</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_20-vue中事件绑定的原理" class="sidebar-link">20.Vue中事件绑定的原理</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_21-v-model中的实现原理及如何自定义v-model" class="sidebar-link">21.v-model中的实现原理及如何自定义v-model</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_22-vue中v-html会导致哪些问题" class="sidebar-link">22.Vue中v-html会导致哪些问题?</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_23-vue-父子组件生命周期调用顺序" class="sidebar-link">23. Vue 父子组件生命周期调用顺序</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_24-vue-组件如何通信" class="sidebar-link">24.Vue 组件如何通信?</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_25-vue-中相同逻辑如何抽离？" class="sidebar-link">25.Vue 中相同逻辑如何抽离？</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_26-为什么要使用异步组件？" class="sidebar-link">26.为什么要使用异步组件？</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_27-什么是作用域插槽" class="sidebar-link">27.什么是作用域插槽?</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_28-谈谈你对-keep-alive-的了解？" class="sidebar-link">28.谈谈你对 keep-alive 的了解？</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_29-vue-中常见性能优化" class="sidebar-link">29.Vue 中常见性能优化</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_30-vue3-0-你知道有哪些改进" class="sidebar-link">30.Vue3.0 你知道有哪些改进?</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_31-实现-hash-路由和-history-路由" class="sidebar-link">31.实现 hash 路由和 history 路由</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_32-vue-router中导航守卫有哪些？" class="sidebar-link">32.Vue-Router中导航守卫有哪些？</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_33-action-和-mutation-区别" class="sidebar-link">33.action 和 mutation 区别</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#_34-简述-vuex-工作原理" class="sidebar-link">34.简述 Vuex 工作原理</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#作业" class="sidebar-link">作业:</a></li><li class="sidebar-sub-header"><a href="/blog/views/vue/vue-interview/part-one/note.html#最后" class="sidebar-link">最后</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React.js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/react/react-hooks.html" class="sidebar-link">React Hooks 相关 API 总结</a></li><li><a href="/blog/views/react/react-lifecycle.html" class="sidebar-link">React v16.0 前的生命周期</a></li><li><a href="/blog/views/react/react-skill.html" class="sidebar-link">5 个技巧助你编写更好的 React 代码</a></li><li><a href="/blog/views/react/react-nice-library.html" class="sidebar-link">5 个很棒的 React.js 库，值得你亲手试试！</a></li><li><a href="/blog/views/react/react-interview.html" class="sidebar-link">35 道咱们必须要清楚的 React 面试题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React-Native</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/react-native/RN&amp;Native-message.html" class="sidebar-link">React Native 跟原生之间的通信</a></li><li><a href="/blog/views/react-native/ReactNative&amp;Flutter&amp;uni-app.html" class="sidebar-link">一、技术学习成本和难度</a></li><li><a href="/blog/views/react-native/ReactNative&amp;Flutter&amp;uni-app.html" class="sidebar-link">一、技术学习成本和难度</a></li><li><a href="/blog/views/react-native/codepush-config.html" class="sidebar-link">RN 配置热更新+使用文档</a></li><li><a href="/blog/views/react-native/codepush-deploy.html" class="sidebar-link">React Native + 热更新(Code Push) 部署文档</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/webpack/webpack1.html" class="sidebar-link">一大波 Webpack 面试题来啦~</a></li><li><a href="/blog/views/webpack/webpack-optimize.html" class="sidebar-link">webpack 优化篇</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端跨域相关</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/cors/corssOrigin-pro.html" class="sidebar-link">10 种跨域解决方案（附终极方案）</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>vite</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/vite/vite-study.html" class="sidebar-link">vite原理剖析</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>cli</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/cli/james-cli.html" class="sidebar-link">手撸一个自己的前端脚手架</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Node.js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/node/node1.html" class="sidebar-link">/views/node/node1.html</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端设计模式之美</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/fe-design/fe-design-9.html" class="sidebar-link">前端应知应会的 9 种设计模式(详细篇)</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端数据结构之美</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/data-structure/data-structure.html" class="sidebar-link">前端数据结构之美</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端算法学习指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/algorithms/sort.html" class="sidebar-link">十大经典算法</a></li><li><a href="/blog/views/algorithms/interview.html" class="sidebar-link">面试必刷-《剑指 offer》刷题小结</a></li><li><a href="/blog/views/algorithms/string.html" class="sidebar-link">字符串相关算法</a></li><li><a href="/blog/views/algorithms/array.html" class="sidebar-link">数组串相关算法</a></li><li><a href="/blog/views/algorithms/linklist.html" class="sidebar-link">链表相关算法题</a></li><li><a href="/blog/views/algorithms/tree.html" class="sidebar-link">二叉树相关算法</a></li><li><a href="/blog/views/algorithms/tencent/array&amp;string.html" class="sidebar-link">腾讯算法题-数组与字符串</a></li><li><a href="/blog/views/algorithms/tencent/number.html" class="sidebar-link">腾讯算法题-数学与数字</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端面试集锦</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/fe-interview/alibaba.html" class="sidebar-link">阿里面试题</a></li><li><a href="/blog/views/fe-interview/bytedance.html" class="sidebar-link">字节跳动面试题</a></li><li><a href="/blog/views/fe-interview/bytedance-algorithms.html" class="sidebar-link">字节跳动算法题</a></li><li><a href="/blog/views/fe-interview/tencent.html" class="sidebar-link">微信面试题</a></li><li><a href="/blog/views/fe-interview/classic-layout.html" class="sidebar-link">掌握两大经典布局方案</a></li><li><a href="/blog/views/fe-interview/web-safe.html" class="sidebar-link">谈谈 web 安全问题及解决方案</a></li><li><a href="/blog/views/fe-interview/http&amp;https.html" class="sidebar-link">http2/http3 协议有什么优劣</a></li><li><a href="/blog/views/fe-interview/webpack-performance-optimization.html" class="sidebar-link">Webpack 性能优化你知道哪些</a></li><li><a href="/blog/views/fe-interview/webpack-principle.html" class="sidebar-link">说说 webpack 打包的原理</a></li><li><a href="/blog/views/fe-interview/webpack-HMR.html" class="sidebar-link">HMR 的原理是什么</a></li><li><a href="/blog/views/fe-interview/chrome-start-process.html" class="sidebar-link">Chrome 打开一个页面需要启动多少进程？分别有哪些进程</a></li><li><a href="/blog/views/fe-interview/dns-prefetch.html" class="sidebar-link">谈谈你对 dns-prefetch 的理解</a></li><li><a href="/blog/views/fe-interview/browser-cache.html" class="sidebar-link">浏览器缓存一探究竟~</a></li><li><a href="/blog/views/fe-interview/send-content-to-browser.html" class="sidebar-link">如何保证页面文件能被完整送达浏览器</a></li><li><a href="/blog/views/fe-interview/browser-render.html" class="sidebar-link">浏览器渲染过程是怎样的</a></li><li><a href="/blog/views/fe-interview/browser-reflow&amp;repain.html" class="sidebar-link">如何理解回流和重绘</a></li><li><a href="/blog/views/fe-interview/renderEngine-createNewLayer.html" class="sidebar-link">渲染引擎什么情况下才会为特定的节点创建新的图层</a></li><li><a href="/blog/views/fe-interview/UDP&amp;TCP-different.html" class="sidebar-link">UDP 和 TCP 有什么区别</a></li><li><a href="/blog/views/fe-interview/js-modules.html" class="sidebar-link">说说 js 的模块化</a></li><li><a href="/blog/views/fe-interview/lazyMan.html" class="sidebar-link">实现一个 LazyMan，可以按照以下方式调用</a></li><li><a href="/blog/views/fe-interview/handwriting-promise.html" class="sidebar-link">少年，来，手写一个 Promise 吧</a></li><li><a href="/blog/views/fe-interview/fetch&amp;ajax-diference.html" class="sidebar-link">请说下 fetch 和 ajax 的区别吧</a></li><li><a href="/blog/views/fe-interview/browser-input-url.html" class="sidebar-link">细说浏览器输入 URL 后发生了什么</a></li><li><a href="/blog/views/fe-interview/picture-optimization.html" class="sidebar-link">前端的图片优化方案你知道多少</a></li><li><a href="/blog/views/fe-interview/node-eventLoop.html" class="sidebar-link">来，说说 node 的事件循环机制吧</a></li><li><a href="/blog/views/fe-interview/browser-eventLoop.html" class="sidebar-link">小伙子，谈谈浏览器端的事件循环吧</a></li><li><a href="/blog/views/fe-interview/setTimeout&amp;setImmediate.html" class="sidebar-link">node中的setTimeout 和 setImmediate有什么区别</a></li><li><a href="/blog/views/fe-interview/js-interview.html" class="sidebar-link">收集一些 javascript 相关的面试题</a></li><li><a href="/blog/views/fe-interview/fuck-interview.html" class="sidebar-link">那些恶心的面试题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端必知必会的网络基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/network/http-interview.html" class="sidebar-link">HTTP 灵魂之问，巩固你的 HTTP 知识体系</a></li><li><a href="/blog/views/network/tcp-interview.html" class="sidebar-link">TCP 协议灵魂之问，巩固你的网络底层基础</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端应知应会的Nginx知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/nginx/nginx-details.html" class="sidebar-link">Nginx 从入门到实践，万字详解！</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端必不可少的git知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/git/git-command-animation.html" class="sidebar-link">相见恨晚的 Git 命令动画演示，一看就懂！</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端性能优化专题，让你的网站飞起来吧</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/performance/code-split.html" class="sidebar-link">项目不知道如何做性能优化？不妨试试代码分割吧</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端高手进阶专题，告别小菜鸟</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/views/fe-advanced/ad1.html" class="sidebar-link">你真的熟悉 HTML 标签吗？</a></li><li><a href="/blog/views/fe-advanced/ad2.html" class="sidebar-link">如何高效操作 DOM 元素？</a></li><li><a href="/blog/views/fe-advanced/ad3.html" class="sidebar-link">3 个使用场景助你用好 DOM 事件</a></li><li><a href="/blog/views/fe-advanced/ad6.html" class="sidebar-link">浏览器如何渲染页面？</a></li><li><a href="/blog/views/fe-advanced/ad7.html" class="sidebar-link">关于 JavaScript 的数据类型，你知多少</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue-面试题汇总"><a href="#vue-面试题汇总" class="header-anchor">#</a> Vue 面试题汇总</h1> <h2 id="_1-谈一下你对mvvm原理的理解"><a href="#_1-谈一下你对mvvm原理的理解" class="header-anchor">#</a> 1.谈一下你对<code>MVVM</code>原理的理解</h2> <p><img src="/blog/assets/img/MVVM.c0247217.jpg" alt="img"></p> <ul><li>传统的<code>MVC</code>指的是,用户操作(<code>View</code>)会请求服务端路由，路由会调用对应的控制器(<code>Controller</code>)来处理,控制器会获取数据(<code>Model</code>)。将结果返回给前端,页面重新渲染</li> <li>MVVM:传统的前端会将数据手动渲染到页面上, 而 <code>MVVM</code> 模式不需要用户操作 <code>dom</code> 元素,只需要将数据绑定到 <code>viewModel</code> 层上，视图层<code>View</code>会自动将数据渲染到页面中，当视图层<code>View</code>变化会通知 <code>ViewModel</code> 层更新数据。<code>ViewModel</code> 就是我们 MVVM 模式中的<strong>桥梁</strong>.</li></ul> <h2 id="_2-请说一下响应式数据的原理"><a href="#_2-请说一下响应式数据的原理" class="header-anchor">#</a> 2.请说一下响应式数据的原理</h2> <h3 id="理解"><a href="#理解" class="header-anchor">#</a> 理解</h3> <ul><li>1.核心点:<code>Object.defineProperty</code></li> <li>2.默认 <code>Vue</code> 在初始化数据时，会给 <code>data</code> 中的<strong>属性</strong>使用 <code>Object.defineProperty</code> 重新定义<strong>所有属性</strong>, 当页面<strong>取</strong>到对应属性时。会进行<strong>依赖收集</strong>（收集当前组件的 <code>watcher</code>） 如果属性发生变化会<strong>通知</strong>(<code>notify</code>)相关<code>依赖</code>进行<strong>更新</strong>操作。</li></ul> <h3 id="原理"><a href="#原理" class="header-anchor">#</a> 原理</h3> <p><img src="/blog/assets/img/xiangyingshi.c555711a.png" alt="响应式数据原理"></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">reactiveGetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> getter <span class="token operator">?</span> <span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">:</span> val<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ** 收集依赖 ** /</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>childOb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        childOb<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">dependArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">reactiveSetter</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> getter <span class="token operator">?</span> <span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">:</span> val<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newVal <span class="token operator">===</span> value <span class="token operator">||</span> <span class="token punctuation">(</span>newVal <span class="token operator">!==</span> newVal <span class="token operator">&amp;&amp;</span> value <span class="token operator">!==</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> customSetter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">customSetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    val <span class="token operator">=</span> newVal<span class="token punctuation">;</span>
    childOb <span class="token operator">=</span> <span class="token operator">!</span>shallow <span class="token operator">&amp;&amp;</span> <span class="token function">observe</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/**通知相关依赖进行更新**/</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_3-vue中是如何检测数组变化"><a href="#_3-vue中是如何检测数组变化" class="header-anchor">#</a> 3.<code>Vue</code>中是如何检测数组变化</h2> <h3 id="理解-2"><a href="#理解-2" class="header-anchor">#</a> 理解</h3> <ul><li>使用函数劫持的方式，重写了数组的方法</li> <li><code>Vue</code>将<code>data</code>中的数组的方法，进行了<strong>重写</strong>。指向了自己定义的数组原型方法，这样当调用数组<code>api</code>时，可以通知依赖更新.如果数组中包含着<strong>引用类型</strong>。会对数组中的<strong>引用类型</strong>再次进行监控。</li></ul> <h3 id="原理-2"><a href="#原理-2" class="header-anchor">#</a> 原理</h3> <p><img src="/blog/assets/img/xiangyingshi2.f211a2f9.png" alt="数组响应式数据原理"></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> arrayProto <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> arrayMethods <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>arrayProto<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> methodsToPatch <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'push'</span><span class="token punctuation">,</span> <span class="token string">'pop'</span><span class="token punctuation">,</span> <span class="token string">'shift'</span><span class="token punctuation">,</span> <span class="token string">'unshift'</span><span class="token punctuation">,</span> <span class="token string">'splice'</span><span class="token punctuation">,</span> <span class="token string">'sort'</span><span class="token punctuation">,</span> <span class="token string">'reverse'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
methodsToPatch<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">method</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 重写原型方法</span>
  <span class="token keyword">const</span> original <span class="token operator">=</span> arrayProto<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 调用原数组的方法</span>
  <span class="token function">def</span><span class="token punctuation">(</span>arrayMethods<span class="token punctuation">,</span> method<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">mutator</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">original</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__ob__<span class="token punctuation">;</span>
    <span class="token keyword">let</span> inserted<span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">'push'</span><span class="token operator">:</span>
      <span class="token keyword">case</span> <span class="token string">'unshift'</span><span class="token operator">:</span>
        inserted <span class="token operator">=</span> args<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'splice'</span><span class="token operator">:</span>
        inserted <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>inserted<span class="token punctuation">)</span> ob<span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>inserted<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// notify change</span>
    ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 当调用数组方法后，手动通知视图更新</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 进行深度监控</span>
</code></pre></div><h2 id="_4-为何vue采用异步渲染"><a href="#_4-为何vue采用异步渲染" class="header-anchor">#</a> 4.为何<code>Vue</code>采用异步渲染</h2> <h3 id="理解-3"><a href="#理解-3" class="header-anchor">#</a> 理解</h3> <p>因为如果不采用异步更新，那么每次更新数据都会对当前组件进行重新渲染.所以为了性能考虑。<code>Vue</code>会在<strong>本轮数据更新后</strong>，再去<strong>异步更新视图</strong>!</p> <h3 id="原理-3"><a href="#原理-3" class="header-anchor">#</a> 原理</h3> <p><img src="/blog/assets/img/async-render.f4043c75.png" alt="为何异步渲染"></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">update</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* istanbul ignore else */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lazy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sync<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">queueWatcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 当数据发生变化时会将watcher放到一个队列中批量更新</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">queueWatcher</span> <span class="token punctuation">(</span><span class="token parameter">watcher<span class="token operator">:</span> Watcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> watcher<span class="token punctuation">.</span>id <span class="token comment">// 会对相同的watcher进行过滤</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flushing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> i <span class="token operator">=</span> queue<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> index <span class="token operator">&amp;&amp;</span> queue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">&gt;</span> watcher<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        i<span class="token operator">--</span>
      <span class="token punctuation">}</span>
      queue<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> watcher<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// queue the flush</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>waiting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      waiting <span class="token operator">=</span> <span class="token boolean">true</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>config<span class="token punctuation">.</span>async<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">flushSchedulerQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
      <span class="token function">nextTick</span><span class="token punctuation">(</span>flushSchedulerQueue<span class="token punctuation">)</span> <span class="token comment">// 调用nextTick方法 批量的进行更新</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_5-nexttick实现原理"><a href="#_5-nexttick实现原理" class="header-anchor">#</a> 5.<code>nextTick</code>实现原理</h2> <h3 id="理解-宏任务和微任务-异步方法"><a href="#理解-宏任务和微任务-异步方法" class="header-anchor">#</a> 理解:(<strong>宏任务</strong>和<strong>微任务</strong>) 异步方法</h3> <p><code>nextTick</code>方法主要是使用了<strong>宏任务</strong>和<strong>微任务</strong>,定义了一个<strong>异步方法</strong>.多次调用<code>nextTick</code> 会将方法存入队列中，通过这个<strong>异步方法</strong>清空当前队列。 所以这个<code>nextTick</code>方法就是异步方法</p> <h3 id="原理-4"><a href="#原理-4" class="header-anchor">#</a> 原理</h3> <p><img src="/blog/assets/img/nextTick.78e2267c.png" alt="nextTick原理剖析"></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> timerFunc<span class="token punctuation">;</span> <span class="token comment">// 会定义一个异步方法</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Promise <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isNative</span><span class="token punctuation">(</span>Promise<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// promise</span>
  <span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isIOS<span class="token punctuation">)</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>noop<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  isUsingMicroTask <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
  <span class="token operator">!</span>isIE <span class="token operator">&amp;&amp;</span>
  <span class="token keyword">typeof</span> MutationObserver <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> <span class="token comment">// MutationObserver</span>
  <span class="token punctuation">(</span><span class="token function">isNative</span><span class="token punctuation">(</span>MutationObserver<span class="token punctuation">)</span> <span class="token operator">||</span>
    MutationObserver<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object MutationObserverConstructor]'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token comment">// HTML5 Api: https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver/observe</span>
  <span class="token comment">// MutationObserver的 observe() 方法配置了 MutationObserver 对象的回调方法以开始接收与给定选项匹配的DOM变化的通知。根据配置，观察者会观察 DOM 树中的单个 Node，也可能会观察被指定节点的部分或者所有的子孙节点。</span>
  <span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> textNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 监听文字变化后会自动触发回调</span>
  observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>textNode<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    characterData<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    counter <span class="token operator">=</span> <span class="token punctuation">(</span>counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">;</span>
    textNode<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  isUsingMicroTask <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> setImmediate <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// setImmediate</span>
  <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setImmediate</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// setTimeout</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// nextTick实现</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token parameter">cb<span class="token operator">?</span><span class="token operator">:</span> Function<span class="token punctuation">,</span> ctx<span class="token operator">?</span><span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> _resolve<span class="token punctuation">;</span>
  callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> <span class="token string">'nextTick'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">_resolve</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pending <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token function">timerFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_6-vue中computed的特点"><a href="#_6-vue中computed的特点" class="header-anchor">#</a> 6.<code>Vue</code>中<code>Computed</code>的特点</h2> <h3 id="理解-4"><a href="#理解-4" class="header-anchor">#</a> 理解</h3> <ul><li>默认<code>computed</code>也是一个<code>watcher</code>是具备<strong>缓存</strong>的，只要当<strong>依赖的属性发生变化时才会更新视图</strong></li></ul> <h3 id="原理-5"><a href="#原理-5" class="header-anchor">#</a> 原理:</h3> <p><img src="/blog/assets/img/computed.c4b5a221.png" alt="计算属性"></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">initComputed</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token operator">:</span> Component<span class="token punctuation">,</span> computed<span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> watchers <span class="token operator">=</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_computedWatchers <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> isSSR <span class="token operator">=</span> <span class="token function">isServerRendering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> computed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> userDef <span class="token operator">=</span> computed<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> getter <span class="token operator">=</span> <span class="token keyword">typeof</span> userDef <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> userDef <span class="token operator">:</span> userDef<span class="token punctuation">.</span>get<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isSSR<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// create internal watcher for the computed property.</span>
      watchers<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> getter <span class="token operator">||</span> noop<span class="token punctuation">,</span> noop<span class="token punctuation">,</span> computedWatcherOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// component-defined computed properties are already defined on the</span>
    <span class="token comment">// component prototype. We only need to define computed properties defined</span>
    <span class="token comment">// at instantiation here.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> vm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">defineComputed</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> userDef<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> vm<span class="token punctuation">.</span>$data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The computed property &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; is already defined in data.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>props <span class="token operator">&amp;&amp;</span> key <span class="token keyword">in</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The computed property &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; is already defined as a prop.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">createComputedGetter</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">computedGetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> watcher <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_computedWatchers <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_computedWatchers<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">.</span>dirty<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果依赖的值没发生变化,就不会重新求值</span>
        watcher<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        watcher<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> watcher<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_7-watch中的deep-true-是如何实现的"><a href="#_7-watch中的deep-true-是如何实现的" class="header-anchor">#</a> 7.<code>Watch</code>中的<code>deep:true</code> 是如何实现的</h2> <h3 id="理解-5"><a href="#理解-5" class="header-anchor">#</a> 理解</h3> <ul><li>深度监听，当用户指定了<code>watch</code>中的 deep 属性为<code>true</code>时，如果当前监控的值是数组或者对象类型。会对数组元素或者对象中的每一项进行求值，此时会将当前<code>watcher</code>存入到<strong>对应属性的依赖</strong>中，这样数组元素或者对象发生变化时也会通知数据更新</li></ul> <h3 id="原理-6"><a href="#原理-6" class="header-anchor">#</a> 原理:</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">get</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">pushTarget</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">// 先将当前依赖放到 Dep.target上</span>
    <span class="token keyword">let</span> value
    <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">getter for watcher &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>expression<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> e
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>deep<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果需要深度监控</span>
        <span class="token function">traverse</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token comment">// 会对对象中的每一项取值,取值时会执行对应的get方法</span>
      <span class="token punctuation">}</span>
      <span class="token function">popTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> value
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">_traverse</span> <span class="token punctuation">(</span><span class="token parameter">val<span class="token operator">:</span> any<span class="token punctuation">,</span> seen<span class="token operator">:</span> SimpleSet</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> i<span class="token punctuation">,</span> keys
  <span class="token keyword">const</span> isA <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>isA <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> Object<span class="token punctuation">.</span><span class="token function">isFrozen</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">||</span> val <span class="token keyword">instanceof</span> <span class="token class-name">VNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>val<span class="token punctuation">.</span>__ob__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> depId <span class="token operator">=</span> val<span class="token punctuation">.</span>__ob__<span class="token punctuation">.</span>dep<span class="token punctuation">.</span>id
    <span class="token keyword">if</span> <span class="token punctuation">(</span>seen<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>depId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    seen<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>depId<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isA<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    i <span class="token operator">=</span> val<span class="token punctuation">.</span>length
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token function">_traverse</span><span class="token punctuation">(</span>val<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> seen<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
    i <span class="token operator">=</span> keys<span class="token punctuation">.</span>length
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token function">_traverse</span><span class="token punctuation">(</span>val<span class="token punctuation">[</span>keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> seen<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="_8-vue组件的生命周期"><a href="#_8-vue组件的生命周期" class="header-anchor">#</a> 8.<code>Vue</code>组件的生命周期</h2> <p><img src="/blog/assets/img/component-lifecycle.dc7a0ef0.png" alt="生命周期"></p> <h3 id="理解-6"><a href="#理解-6" class="header-anchor">#</a> 理解</h3> <h4 id="要掌握每个生命周期什么时候被调用"><a href="#要掌握每个生命周期什么时候被调用" class="header-anchor">#</a> 要掌握每个生命周期什么时候被调用</h4> <ul><li><code>beforeCreate</code> 在实例初始化之后，数据观测(data observer) 之前被调用。</li> <li><code>created</code> 实例已经创建完成之后被调用。在这一步，实例已完成以下的配置：数据观测(data observer)，属性和方法的运算， watch/event 事件回调。这里没有$el</li> <li><code>beforeMount</code> 在挂载开始之前被调用：相关的 render 函数首次被调用。</li> <li><code>mounted</code> el 被新创建的 <code>vm.$el</code> 替换，并挂载到实例上去之后调用该钩子。</li> <li><code>beforeUpdate</code> 数据更新时调用，发生在虚拟 DOM 重新渲染和打补丁之前。</li> <li><code>updated</code> 由于数据更改导致的虚拟 DOM 重新渲染和打补丁，在这之后会调用该钩子。</li> <li><code>beforeDestroy</code> 实例销毁之前调用。在这一步，实例仍然完全可用。</li> <li><code>destroyed</code> <code>Vue</code> 实例销毁后调用。调用后，<code>Vue</code> 实例指示的所有东西都会解绑定，所有的事件监听器会被移除，所有的子实例也会被销毁。 该钩子在服务器端渲染期间不被调用。</li></ul> <h4 id="要掌握每个生命周期内部可以做什么事"><a href="#要掌握每个生命周期内部可以做什么事" class="header-anchor">#</a> 要掌握每个生命周期内部可以做什么事</h4> <ul><li><code>created</code> 实例已经创建完成，因为它是最早触发的原因可以进行一些数据，资源的请求。</li> <li><code>mounted</code> 实例已经挂载完成，可以进行一些 DOM 操作</li> <li><code>beforeUpdate</code> 可以在这个钩子中进一步地更改状态，这不会触发附加的重渲染过程。</li> <li><code>updated</code> 可以执行依赖于 DOM 的操作。然而在大多数情况下，你应该避免在此期间更改状态，因为这可能会导致更新无限循环。 该钩子在服务器端渲染期间不被调用。</li> <li><code>destroyed</code> 可以执行一些优化操作,清空定时器，解除绑定事件</li></ul> <p><img src="/blog/assets/img/lifecycle.b3251a15.png" alt="vue-lifecycle"></p> <h3 id="原理-7"><a href="#原理-7" class="header-anchor">#</a> 原理</h3> <p><img src="/blog/assets/img/lifecycle2.2be8e829.png" alt="生命周期"></p> <h2 id="_9-ajax请求放在哪个生命周期中"><a href="#_9-ajax请求放在哪个生命周期中" class="header-anchor">#</a> 9.<code>ajax</code>请求放在哪个生命周期中</h2> <h3 id="理解-7"><a href="#理解-7" class="header-anchor">#</a> 理解</h3> <ul><li>在 <code>created</code> 的时候，视图中的<code>dom</code>并没有渲染出来，所以此时如果直接去操<code>dom</code>节点，无法找到相关的元素</li> <li>在 <code>mounted</code> 中，由于此时<code>dom</code>已经渲染出来了，所以可以直接操作<code>dom</code>节点</li></ul> <p>一般情况下都放到<code>mounted</code>中,保证逻辑的统一性,因为生命周期是同步执行的，<code>ajax</code>是异步执行的</p> <blockquote><p>服务端渲染不支持 mounted 方法，所以在服务端渲染的情况下统一放到 <code>created</code> 中</p></blockquote> <h2 id="_10-何时需要使用beforedestroy"><a href="#_10-何时需要使用beforedestroy" class="header-anchor">#</a> 10.何时需要使用<code>beforeDestroy</code></h2> <h3 id="理解-8"><a href="#理解-8" class="header-anchor">#</a> 理解</h3> <ul><li>可能在当前页面中使用了<code>$on</code>方法，那需要在<strong>组件销毁前解绑</strong>。</li> <li><strong>清除</strong>自己定义的定时器</li> <li><strong>解除事件的绑定</strong> <code>scroll mousemove ....</code></li></ul> <h2 id="_11-vue中模板编译原理"><a href="#_11-vue中模板编译原理" class="header-anchor">#</a> 11.<code>Vue</code>中模板编译原理</h2> <ul><li>将<code>template</code>转化成<code>render</code>函数</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">baseCompile</span> <span class="token punctuation">(</span>
  <span class="token parameter">template<span class="token operator">:</span> string<span class="token punctuation">,</span>
  options<span class="token operator">:</span> CompilerOptions</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token comment">// 1.将模板转化成ast语法树</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>optimize <span class="token operator">!==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>           <span class="token comment">// 2.优化树</span>
    <span class="token function">optimize</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token function">generate</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> options<span class="token punctuation">)</span>         <span class="token comment">// 3.生成树</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    ast<span class="token punctuation">,</span>
    render<span class="token operator">:</span> code<span class="token punctuation">.</span>render<span class="token punctuation">,</span>
    staticRenderFns<span class="token operator">:</span> code<span class="token punctuation">.</span>staticRenderFns
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> ncname <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[a-zA-Z_][\\-\\.0-9_a-zA-Z]*</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">const</span> qnameCapture <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">((?:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ncname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\:)?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ncname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">const</span> startTagOpen <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^&lt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>qnameCapture<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 标签开头的正则 捕获的内容是标签名</span>
<span class="token keyword">const</span> endTag <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^&lt;\\/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>qnameCapture<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">[^&gt;]*&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 匹配标签结尾的  &lt;/div&gt;</span>
<span class="token keyword">const</span> attribute <span class="token operator">=</span> <span class="token regex">/^\s*([^\s&quot;'&lt;&gt;\/=]+)(?:\s*(=)\s*(?:&quot;([^&quot;]*)&quot;+|'([^']*)'+|([^\s&quot;'=&lt;&gt;`]+)))?/</span><span class="token punctuation">;</span> <span class="token comment">// 匹配属性的</span>
<span class="token keyword">const</span> startTagClose <span class="token operator">=</span> <span class="token regex">/^\s*(\/?)&gt;/</span><span class="token punctuation">;</span> <span class="token operator">/</span><span class="token operator">/</span> 匹配标签结束的  <span class="token operator">&gt;</span>
<span class="token keyword">let</span> root<span class="token punctuation">;</span>
<span class="token keyword">let</span> currentParent<span class="token punctuation">;</span>
<span class="token keyword">let</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">createASTElement</span><span class="token punctuation">(</span><span class="token parameter">tagName<span class="token punctuation">,</span> attrs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    tag<span class="token operator">:</span> tagName<span class="token punctuation">,</span>
    type<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    attrs<span class="token punctuation">,</span>
    parent<span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token parameter">tagName<span class="token punctuation">,</span> attrs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> element <span class="token operator">=</span> <span class="token function">createASTElement</span><span class="token punctuation">(</span>tagName<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>root<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    root <span class="token operator">=</span> element<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  currentParent <span class="token operator">=</span> element<span class="token punctuation">;</span>
  stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">chars</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  currentParent<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    text
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token parameter">tagName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> element <span class="token operator">=</span> stack<span class="token punctuation">[</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  stack<span class="token punctuation">.</span>length<span class="token operator">--</span><span class="token punctuation">;</span>
  currentParent <span class="token operator">=</span> stack<span class="token punctuation">[</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>currentParent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    element<span class="token punctuation">.</span>parent <span class="token operator">=</span> currentParent<span class="token punctuation">;</span>
    currentParent<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">parseHTML</span><span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>html<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> textEnd <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'&lt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>textEnd <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> startTagMatch <span class="token operator">=</span> <span class="token function">parseStartTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>startTagMatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">start</span><span class="token punctuation">(</span>startTagMatch<span class="token punctuation">.</span>tagName<span class="token punctuation">,</span> startTagMatch<span class="token punctuation">.</span>attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> endTagMatch <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>endTag<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>endTagMatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">advance</span><span class="token punctuation">(</span>endTagMatch<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">end</span><span class="token punctuation">(</span>endTagMatch<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> text<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>textEnd <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      text <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> textEnd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">advance</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">chars</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">advance</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    html <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">parseStartTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> start <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>startTagOpen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>start<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> match <span class="token operator">=</span> <span class="token punctuation">{</span>
        tagName<span class="token operator">:</span> start<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        attrs<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token function">advance</span><span class="token punctuation">(</span>start<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> attr<span class="token punctuation">,</span> end<span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>end <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>startTagClose<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>attr <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>attribute<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">advance</span><span class="token punctuation">(</span>attr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        match<span class="token punctuation">.</span>attrs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> attr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> value<span class="token operator">:</span> attr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>end<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">advance</span><span class="token punctuation">(</span>end<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> match<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">/</span><span class="token operator">/</span> 生成语法树
<span class="token function">parseHTML</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div id=&quot;container&quot;&gt;&lt;p&gt;hello&lt;span&gt;zf&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">generate</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> `<span class="token function">_v</span><span class="token punctuation">(</span>$<span class="token punctuation">{</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">;
  }
}
function genChildren(el) {
  const children = el.children;
  if (el.children) {
    return </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">[</span>$<span class="token punctuation">{</span>children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=&gt;</span> <span class="token function">gen</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">;
  } else {
    return false;
  }
}
function genProps(attrs) {
  let str = '';
  for (let i = 0; i &lt; attrs.length; i++) {
    let attr = attrs[i];
    str += </span><span class="token template-punctuation string">`</span></span>$<span class="token punctuation">{</span>attr<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">:</span>$<span class="token punctuation">{</span>attr<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">;
  }
  return </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">{</span>attrs<span class="token operator">:</span><span class="token punctuation">{</span>$<span class="token punctuation">{</span>str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">;
}
function generate(el) {
  let children = genChildren(el);
  let code = </span><span class="token template-punctuation string">`</span></span><span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">'${el.tag}'</span>$<span class="token punctuation">{</span>el<span class="token punctuation">.</span>attrs<span class="token punctuation">.</span>length <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">genProps</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>attrs<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">}</span>$<span class="token punctuation">{</span>
    children <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>children<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">;
  return code;
}
// 根据语法树生成新的代码
let code = generate(root);
let render = </span><span class="token template-punctuation string">`</span></span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> $<span class="token punctuation">{</span>code<span class="token punctuation">}</span><span class="token punctuation">}</span>`<span class="token punctuation">;</span>

<span class="token comment">// 包装成函数</span>
<span class="token keyword">let</span> renderFn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>renderFn<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_12-vue中v-if和v-show的区别"><a href="#_12-vue中v-if和v-show的区别" class="header-anchor">#</a> 12.<code>Vue</code>中<code>v-if</code>和<code>v-show</code>的区别</h2> <h3 id="理解-9"><a href="#理解-9" class="header-anchor">#</a> 理解</h3> <ul><li><code>v-if</code>如果条件不成立不会渲染当前指令所在节点的<code>dom</code>元素</li> <li><code>v-show</code>只是切换当前<code>dom</code>的显示或者隐藏</li></ul> <h3 id="原理-8"><a href="#原理-8" class="header-anchor">#</a> 原理</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> VueTemplateCompiler <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-template-compiler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> r1 <span class="token operator">=</span> VueTemplateCompiler<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div v-if=&quot;true&quot;&gt;&lt;span v-for=&quot;i in 3&quot;&gt;hello&lt;/span&gt;&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/**
with(this) {
    return (true) ? _c('div', _l((3), function (i) {
        return _c('span', [_v(&quot;hello&quot;)])
    }), 0) : _e()
}
*/</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> VueTemplateCompiler <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-template-compiler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> r2 <span class="token operator">=</span> VueTemplateCompiler<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div v-show=&quot;true&quot;&gt;&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/**
with(this) {
    return _c('div', {
        directives: [{
            name: &quot;show&quot;,
            rawName: &quot;v-show&quot;,
            value: (true),
            expression: &quot;true&quot;
        }]
    })
}
 */</span>

<span class="token comment">// v-show 操作的是样式  定义在platforms/web/runtime/directives/show.js</span>
<span class="token function">bind</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token punctuation">{</span> value <span class="token punctuation">}</span><span class="token operator">:</span> VNodeDirective<span class="token punctuation">,</span> vnode<span class="token operator">:</span> VNodeWithData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vnode <span class="token operator">=</span> <span class="token function">locateNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>
    <span class="token keyword">const</span> transition <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data <span class="token operator">&amp;&amp;</span> vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>transition
    <span class="token keyword">const</span> originalDisplay <span class="token operator">=</span> el<span class="token punctuation">.</span>__vOriginalDisplay <span class="token operator">=</span>
      el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">===</span> <span class="token string">'none'</span> <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&amp;&amp;</span> transition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>show <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token function">enter</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> originalDisplay
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> value <span class="token operator">?</span> originalDisplay <span class="token operator">:</span> <span class="token string">'none'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_13-为什么v-for和v-if不能连用"><a href="#_13-为什么v-for和v-if不能连用" class="header-anchor">#</a> 13.为什么<code>V-for</code>和<code>v-if</code>不能连用</h2> <h3 id="理解-10"><a href="#理解-10" class="header-anchor">#</a> 理解:</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> VueTemplateCompiler <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-template-compiler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> r1 <span class="token operator">=</span> VueTemplateCompiler<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div v-if=&quot;false&quot; v-for=&quot;i in 3&quot;&gt;hello&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/**
with(this) {
    return _l((3), function (i) {
        return (false) ? _c('div', [_v(&quot;hello&quot;)]) : _e()
    })
}
*/</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r1<span class="token punctuation">.</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>v-for</code>会比<code>v-if</code>的优先级高一些,如果连用的话会把<code>v-if</code>给每个元素都添加一下,会造成性能问题</li></ul> <h2 id="_14-用vnode来描述一个dom结构"><a href="#_14-用vnode来描述一个dom结构" class="header-anchor">#</a> 14.用<code>vnode</code>来描述一个<code>DOM</code>结构</h2> <ul><li>虚拟节点就是用一个对象来描述真实的<code>dom</code>元素</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">$createElement</span><span class="token punctuation">(</span><span class="token parameter">tag<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token operator">...</span>children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> key <span class="token operator">=</span> data<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
  <span class="token keyword">delete</span> data<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
  children <span class="token operator">=</span> children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> child <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> child<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">vnode</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> child<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">vnode</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> props<span class="token punctuation">,</span> key<span class="token punctuation">,</span> children<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">vnode</span><span class="token punctuation">(</span><span class="token parameter">tag<span class="token punctuation">,</span> data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> children<span class="token punctuation">,</span> text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    tag<span class="token punctuation">,</span> <span class="token comment">// 表示的是当前的标签名</span>
    data<span class="token punctuation">,</span> <span class="token comment">// 表示的是当前标签上的属性</span>
    key<span class="token punctuation">,</span> <span class="token comment">// 唯一表示用户可能传递</span>
    children<span class="token punctuation">,</span>
    text
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_15-diff算法的时间复杂度"><a href="#_15-diff算法的时间复杂度" class="header-anchor">#</a> 15.<code>diff</code>算法的时间复杂度</h2> <p>两个树的完全的<code>diff</code>算法是一个时间复杂度为 <code>O(n3)</code>,<code>Vue</code>进行了优化·<em>O(n3)</em> <em>复杂度</em>的问题转换成 O(n) <em>复杂度</em>的问题(只比较同级不考虑跨级问题) 在前端当中， 你很少会跨越层级地移动 Dom 元素。 所以 Virtual Dom 只会对同一个层级的元素进行对比。</p> <h2 id="_16-简述vue中diff算法原理"><a href="#_16-简述vue中diff算法原理" class="header-anchor">#</a> 16.简述<code>Vue</code>中<code>diff</code>算法原理</h2> <h3 id="理解-11"><a href="#理解-11" class="header-anchor">#</a> 理解</h3> <ul><li>1.先同级比较，在比较子节点</li> <li>2.先判断一方有儿子一方没儿子的情况</li> <li>3.比较都有儿子的情况</li> <li>4.递归比较子节点</li></ul> <p><img src="/blog/assets/img/vue-diff.331fe4de.jpg" alt="img"></p> <h3 id="原理-9"><a href="#原理-9" class="header-anchor">#</a> 原理</h3> <blockquote><p><code>core/vdom/patch.js</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> oldCh <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>children<span class="token punctuation">;</span> <span class="token comment">// 老的儿子</span>
<span class="token keyword">const</span> ch <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children<span class="token punctuation">;</span> <span class="token comment">// 新的儿子</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 比较孩子</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCh <span class="token operator">!==</span> ch<span class="token punctuation">)</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> ch<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> removeOnly<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 新的儿子有 老的没有</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> nodeOps<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">addVnodes</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> ch<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ch<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果老的有新的没有 就删除</span>
    <span class="token function">removeVnodes</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 老的有文本 新的没文本</span>
    nodeOps<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将老的清空</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text <span class="token operator">!==</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 文本不相同替换</span>
  nodeOps<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span><span class="token parameter">parentElm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> removeOnly</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> oldStartIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> newStartIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> oldEndIdx <span class="token operator">=</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>oldEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> newEndIdx <span class="token operator">=</span> newCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span>newEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> oldKeyToIdx<span class="token punctuation">,</span> idxInOld<span class="token punctuation">,</span> vnodeToMove<span class="token punctuation">,</span> refElm<span class="token punctuation">;</span>

  <span class="token comment">// removeOnly is a special flag used only by &lt;transition-group&gt;</span>
  <span class="token comment">// to ensure removed elements stay in correct relative positions</span>
  <span class="token comment">// during leaving transitions</span>
  <span class="token keyword">const</span> canMove <span class="token operator">=</span> <span class="token operator">!</span>removeOnly<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">checkDuplicateKeys</span><span class="token punctuation">(</span>newCh<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span>oldStartIdx <span class="token operator">&lt;=</span> oldEndIdx <span class="token operator">&amp;&amp;</span> newStartIdx <span class="token operator">&lt;=</span> newEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Vnode has been moved left</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newStartIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
      newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newEndIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
      newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Vnode moved right</span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newEndIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      canMove <span class="token operator">&amp;&amp;</span>
        nodeOps<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> nodeOps<span class="token punctuation">.</span><span class="token function">nextSibling</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
      newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Vnode moved left</span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newStartIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      canMove <span class="token operator">&amp;&amp;</span> nodeOps<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> oldEndVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
      oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
      newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>oldKeyToIdx<span class="token punctuation">)</span><span class="token punctuation">)</span> oldKeyToIdx <span class="token operator">=</span> <span class="token function">createKeyToOldIdx</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">,</span> oldStartIdx<span class="token punctuation">,</span> oldEndIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      idxInOld <span class="token operator">=</span> <span class="token function">isDef</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">.</span>key<span class="token punctuation">)</span>
        <span class="token operator">?</span> oldKeyToIdx<span class="token punctuation">[</span>newStartVnode<span class="token punctuation">.</span>key<span class="token punctuation">]</span>
        <span class="token operator">:</span> <span class="token function">findIdxInOld</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> oldStartIdx<span class="token punctuation">,</span> oldEndIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>idxInOld<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// New element</span>
        <span class="token function">createElm</span><span class="token punctuation">(</span>
          newStartVnode<span class="token punctuation">,</span>
          insertedVnodeQueue<span class="token punctuation">,</span>
          parentElm<span class="token punctuation">,</span>
          oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span>
          <span class="token boolean">false</span><span class="token punctuation">,</span>
          newCh<span class="token punctuation">,</span>
          newStartIdx
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        vnodeToMove <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>idxInOld<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>vnodeToMove<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">patchVnode</span><span class="token punctuation">(</span>vnodeToMove<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newStartIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
          oldCh<span class="token punctuation">[</span>idxInOld<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
          canMove <span class="token operator">&amp;&amp;</span> nodeOps<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> vnodeToMove<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// same key but different element. treat as new element</span>
          <span class="token function">createElm</span><span class="token punctuation">(</span>
            newStartVnode<span class="token punctuation">,</span>
            insertedVnodeQueue<span class="token punctuation">,</span>
            parentElm<span class="token punctuation">,</span>
            oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span>
            <span class="token boolean">false</span><span class="token punctuation">,</span>
            newCh<span class="token punctuation">,</span>
            newStartIdx
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>oldStartIdx <span class="token operator">&gt;</span> oldEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    refElm <span class="token operator">=</span> <span class="token function">isUndef</span><span class="token punctuation">(</span>newCh<span class="token punctuation">[</span>newEndIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> newCh<span class="token punctuation">[</span>newEndIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>elm<span class="token punctuation">;</span>
    <span class="token function">addVnodes</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> refElm<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newStartIdx<span class="token punctuation">,</span> newEndIdx<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>newStartIdx <span class="token operator">&gt;</span> newEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">removeVnodes</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">,</span> oldStartIdx<span class="token punctuation">,</span> oldEndIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_17-v-for中为什么要用key-图解"><a href="#_17-v-for中为什么要用key-图解" class="header-anchor">#</a> 17.<code>v-for</code>中为什么要用<code>key</code> (图解)</h2> <p><img src="/blog/assets/img/diff-key.5862ebbc.jpg" alt="vue-diff-key"></p> <h2 id="_18-描述组件渲染和更新过程"><a href="#_18-描述组件渲染和更新过程" class="header-anchor">#</a> 18.描述组件渲染和更新过程</h2> <h3 id="理解-12"><a href="#理解-12" class="header-anchor">#</a> 理解</h3> <ul><li>渲染组件时，会通过<code>Vue.extend</code>方法构建子组件的构造函数，并进行实例化。最终手动调用<code>$mount()</code>进行挂载。更新组件时会进行<code>patchVnode</code>流程.核心就是 diff 算法</li></ul> <p><img src="/blog/assets/img/render-course.4773d685.png" alt="组件渲染流程"></p> <h2 id="_19-组件中的-data为什么是一个函数"><a href="#_19-组件中的-data为什么是一个函数" class="header-anchor">#</a> 19.组件中的 <code>data</code>为什么是一个函数?</h2> <h3 id="理解："><a href="#理解：" class="header-anchor">#</a> 理解：</h3> <p>同一个组件被复用多次，会创建多个实例。这些实例用的是同一个构造函数，如果<code>data</code>是一个对象的话。那么所有组件都共享了同一个对象。为了保证组件的数据独立性要求每个组件必须通过<code>data</code>函数返回一个对象作为组件的状态。</p> <h3 id="原理-10"><a href="#原理-10" class="header-anchor">#</a> 原理:</h3> <blockquote><p><code>core/global-api/extend.js line:33</code></p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Sub<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span>Super<span class="token punctuation">.</span>options<span class="token punctuation">,</span> extendOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">mergeField</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> strat <span class="token operator">=</span> strats<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">||</span> defaultStrat<span class="token punctuation">;</span>
    options<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">strat</span><span class="token punctuation">(</span>parent<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> child<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> vm<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
strats<span class="token punctuation">.</span><span class="token function-variable function">data</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">parentVal<span class="token operator">:</span> any<span class="token punctuation">,</span> childVal<span class="token operator">:</span> any<span class="token punctuation">,</span> vm<span class="token operator">?</span><span class="token operator">:</span> Component</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token operator">?</span>Function <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 合并是会判断子类的data必须是一个函数</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>childVal <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> childVal <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span>
        <span class="token function">warn</span><span class="token punctuation">(</span>
          <span class="token string">'The &quot;data&quot; option should be a function '</span> <span class="token operator">+</span>
            <span class="token string">'that returns a per-instance value in component '</span> <span class="token operator">+</span>
            <span class="token string">'definitions.'</span><span class="token punctuation">,</span>
          vm
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> parentVal<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">mergeDataOrFn</span><span class="token punctuation">(</span>parentVal<span class="token punctuation">,</span> childVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">mergeDataOrFn</span><span class="token punctuation">(</span>parentVal<span class="token punctuation">,</span> childVal<span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>一个组件被使用多次，用的都是同一个构造函数。为了保证组件的不同的实例 data 不冲突，要求 data 必须是一个函数，这样组件间不会相互影响</li></ul> <h2 id="_20-vue中事件绑定的原理"><a href="#_20-vue中事件绑定的原理" class="header-anchor">#</a> 20.<code>Vue</code>中事件绑定的原理</h2> <h3 id="理解-13"><a href="#理解-13" class="header-anchor">#</a> 理解:</h3> <ul><li>1.原生<code>dom</code>事件的绑定,采用的是<code>addEventListener</code>实现</li> <li>2.组件绑定事件采用的是<code>$on</code>方法</li></ul> <h3 id="原理-11"><a href="#原理-11" class="header-anchor">#</a> 原理:</h3> <ul><li>事件的编译：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> compiler <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-template-compiler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> r1 <span class="token operator">=</span> compiler<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">'&lt;div @click=&quot;fn()&quot;&gt;&lt;/div&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> r2 <span class="token operator">=</span> compiler<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">'&lt;my-component @click.native=&quot;fn&quot; @click=&quot;fn1&quot;&gt;&lt;/my-component&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {on:{click}}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {nativeOnOn:{click},on:{click}}</span>
</code></pre></div><p><img src="/blog/assets/img/event-init.f692c0a2.png" alt="事件初始化"></p> <h4 id="_1-原生dom的绑定"><a href="#_1-原生dom的绑定" class="header-anchor">#</a> 1.原生<code>dom</code>的绑定</h4> <ul><li><code>Vue</code>在创建真是<code>dom</code>时会调用<code>createElm</code>,默认会调用<code>invokeCreateHooks</code></li> <li>会遍历当前平台下相对的属性处理代码,其中就有<code>updateDOMListeners</code>方法,内部会传入<code>add</code>方法</li></ul> <p>yuan</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">updateDOMListeners</span><span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token operator">:</span> VNodeWithData<span class="token punctuation">,</span> vnode<span class="token operator">:</span> VNodeWithData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>on<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isUndef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>on<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> on <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>on <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> oldOn <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>on <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  target <span class="token operator">=</span> vnode<span class="token punctuation">.</span>elm<span class="token punctuation">;</span>
  <span class="token function">normalizeEvents</span><span class="token punctuation">(</span>on<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">updateListeners</span><span class="token punctuation">(</span>on<span class="token punctuation">,</span> oldOn<span class="token punctuation">,</span> add<span class="token punctuation">,</span> remove<span class="token punctuation">,</span> createOnceHandler<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  target <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token operator">:</span> string<span class="token punctuation">,</span> handler<span class="token operator">:</span> Function<span class="token punctuation">,</span> capture<span class="token operator">:</span> boolean<span class="token punctuation">,</span> passive<span class="token operator">:</span> boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  target<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
    <span class="token comment">// 给当前的dom添加事件</span>
    name<span class="token punctuation">,</span>
    handler<span class="token punctuation">,</span>
    supportsPassive <span class="token operator">?</span> <span class="token punctuation">{</span> capture<span class="token punctuation">,</span> passive <span class="token punctuation">}</span> <span class="token operator">:</span> capture
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>vue</code>中绑定事件是直接绑定给真实<code>dom</code>元素的</p></blockquote> <ul><li>2.组件中绑定事件</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">updateComponentListeners</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token operator">:</span> Component<span class="token punctuation">,</span> listeners<span class="token operator">:</span> Object<span class="token punctuation">,</span> oldListeners<span class="token operator">:</span> <span class="token operator">?</span>Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  target <span class="token operator">=</span> vm<span class="token punctuation">;</span>
  <span class="token function">updateListeners</span><span class="token punctuation">(</span>listeners<span class="token punctuation">,</span> oldListeners <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> add<span class="token punctuation">,</span> remove<span class="token punctuation">,</span> createOnceHandler<span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">;</span>
  target <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  target<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>组件绑定事件是通过<code>vue</code>中自定义的<code>$on</code>方法来实现的</p></blockquote> <h2 id="_21-v-model中的实现原理及如何自定义v-model"><a href="#_21-v-model中的实现原理及如何自定义v-model" class="header-anchor">#</a> 21.<code>v-model</code>中的实现原理及如何自定义<code>v-model</code></h2> <h3 id="理解-14"><a href="#理解-14" class="header-anchor">#</a> 理解:</h3> <p>组件的<code>v-model</code>是<code>value+input方法</code>的语法糖</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-checkbox</span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-checkbox</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-checkbox</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>check<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-checkbox</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>可以自己重新定义<code>v-model</code>的含义</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'el-checkbox'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;input type=&quot;checkbox&quot; :checked=&quot;check&quot; @change=&quot;$emit('change',$event.target.checked)&quot;&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  model<span class="token operator">:</span> <span class="token punctuation">{</span>
    prop<span class="token operator">:</span> <span class="token string">'check'</span><span class="token punctuation">,</span> <span class="token comment">// 更改默认的value的名字</span>
    event<span class="token operator">:</span> <span class="token string">'change'</span> <span class="token comment">// 更改默认的方法名</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    check<span class="token operator">:</span> Boolean
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="原理-12"><a href="#原理-12" class="header-anchor">#</a> 原理:</h3> <ul><li>会将组件的<code>v-model</code>默认转化成 value+input</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> VueTemplateCompiler <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-template-compiler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ele <span class="token operator">=</span> VueTemplateCompiler<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">'&lt;el-checkbox v-model=&quot;check&quot;&gt;&lt;/el-checkbox&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// with(this) {</span>
<span class="token comment">//     return _c('el-checkbox', {</span>
<span class="token comment">//         model: {</span>
<span class="token comment">//             value: (check),</span>
<span class="token comment">//             callback: function ($$v) {</span>
<span class="token comment">//                 check = $$v</span>
<span class="token comment">//             },</span>
<span class="token comment">//             expression: &quot;check&quot;</span>
<span class="token comment">//         }</span>
<span class="token comment">//     })</span>
<span class="token comment">// }</span>
</code></pre></div><blockquote><p><code>core/vdom/create-component.js line:155</code></p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">transformModel</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> data<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> prop <span class="token operator">=</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>model <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>model<span class="token punctuation">.</span>prop<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'value'</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> event <span class="token operator">=</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>model <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>model<span class="token punctuation">.</span>event<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'input'</span><span class="token punctuation">;</span>
  <span class="token punctuation">(</span>data<span class="token punctuation">.</span>attrs <span class="token operator">||</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>attrs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">.</span>model<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token keyword">const</span> on <span class="token operator">=</span> data<span class="token punctuation">.</span>on <span class="token operator">||</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>on <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> existing <span class="token operator">=</span> on<span class="token punctuation">[</span>event<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> callback <span class="token operator">=</span> data<span class="token punctuation">.</span>model<span class="token punctuation">.</span>callback<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>existing<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>existing<span class="token punctuation">)</span> <span class="token operator">?</span> existing<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> existing <span class="token operator">!==</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      on<span class="token punctuation">[</span>event<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>callback<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>existing<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    on<span class="token punctuation">[</span>event<span class="token punctuation">]</span> <span class="token operator">=</span> callback<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>原生的 <code>v-model</code>，会根据标签的不同生成不同的事件和属性</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> VueTemplateCompiler <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-template-compiler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ele <span class="token operator">=</span> VueTemplateCompiler<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">'&lt;input v-model=&quot;value&quot;/&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/** 
with(this) {
    return _c('input', {
        directives: [{
            name: &quot;model&quot;,
            rawName: &quot;v-model&quot;,
            value: (value),
            expression: &quot;value&quot;
        }],
        domProps: {
            &quot;value&quot;: (value)
        },
        on: {
            &quot;input&quot;: function ($event) {
                if ($event.target.composing) return;
                value = $event.target.value
            }
        }
    })
}
*/</span>
</code></pre></div><blockquote><p>编译时：不同的标签解析出的内容不一样 <code>platforms/web/compiler/directives/model.js</code></p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>component<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">genComponentModel</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> value<span class="token punctuation">,</span> modifiers<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// component v-model doesn't need extra runtime</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>tag <span class="token operator">===</span> <span class="token string">'select'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">genSelect</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> value<span class="token punctuation">,</span> modifiers<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>tag <span class="token operator">===</span> <span class="token string">'input'</span> <span class="token operator">&amp;&amp;</span> type <span class="token operator">===</span> <span class="token string">'checkbox'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">genCheckboxModel</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> value<span class="token punctuation">,</span> modifiers<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>tag <span class="token operator">===</span> <span class="token string">'input'</span> <span class="token operator">&amp;&amp;</span> type <span class="token operator">===</span> <span class="token string">'radio'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">genRadioModel</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> value<span class="token punctuation">,</span> modifiers<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>tag <span class="token operator">===</span> <span class="token string">'input'</span> <span class="token operator">||</span> tag <span class="token operator">===</span> <span class="token string">'textarea'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">genDefaultModel</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> value<span class="token punctuation">,</span> modifiers<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>config<span class="token punctuation">.</span><span class="token function">isReservedTag</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">genComponentModel</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> value<span class="token punctuation">,</span> modifiers<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// component v-model doesn't need extra runtime</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>运行时：会对元素处理一些关于输入法的问题 <code>platforms/web/runtime/directives/model.js</code></p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">inserted</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> oldVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">'select'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// #6903</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>elm <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>oldVnode<span class="token punctuation">.</span>elm<span class="token punctuation">.</span>_vOptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">mergeVNodeHook</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> <span class="token string">'postpatch'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        directive<span class="token punctuation">.</span><span class="token function">componentUpdated</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">setSelected</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>context<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    el<span class="token punctuation">.</span>_vOptions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>options<span class="token punctuation">,</span> getValue<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">'textarea'</span> <span class="token operator">||</span> <span class="token function">isTextInputType</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    el<span class="token punctuation">.</span>_vModifiers <span class="token operator">=</span> binding<span class="token punctuation">.</span>modifiers
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>binding<span class="token punctuation">.</span>modifiers<span class="token punctuation">.</span>lazy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'compositionstart'</span><span class="token punctuation">,</span> onCompositionStart<span class="token punctuation">)</span>
      el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'compositionend'</span><span class="token punctuation">,</span> onCompositionEnd<span class="token punctuation">)</span>
      <span class="token comment">// Safari &lt; 10.2 &amp; UIWebView doesn't fire compositionend when</span>
      <span class="token comment">// switching focus before confirming composition choice</span>
      <span class="token comment">// this also fixes the issue where some browsers e.g. iOS Chrome</span>
      <span class="token comment">// fires &quot;change&quot; instead of &quot;input&quot; on autocomplete.</span>
      el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> onCompositionEnd<span class="token punctuation">)</span>
      <span class="token comment">/* istanbul ignore if */</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>isIE9<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        el<span class="token punctuation">.</span>vmodel <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_22-vue中v-html会导致哪些问题"><a href="#_22-vue中v-html会导致哪些问题" class="header-anchor">#</a> 22.<code>Vue</code>中<code>v-html</code>会导致哪些问题?</h2> <h3 id="理解-15"><a href="#理解-15" class="header-anchor">#</a> 理解:</h3> <ul><li>可能会导致<code>xss</code>攻击</li> <li><code>v-html</code>会替换掉标签内部的子元素</li></ul> <h3 id="原理-13"><a href="#原理-13" class="header-anchor">#</a> 原理:</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> template <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-template-compiler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> r <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div v-html=&quot;'&lt;span&gt;hello&lt;/span&gt;'&quot;&gt;&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// with(this){return _c('div',{domProps:{&quot;innerHTML&quot;:_s('&lt;span&gt;hello&lt;/span&gt;')}})}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// _c 定义在core/instance/render.js</span>
<span class="token comment">// _s 定义在core/instance/render-helpers/index,js</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'textContent'</span> <span class="token operator">||</span> key <span class="token operator">===</span> <span class="token string">'innerHTML'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>children<span class="token punctuation">)</span> vnode<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">===</span> oldProps<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
  <span class="token comment">// #6601 work around Chrome version &lt;= 55 bug where single textNode</span>
  <span class="token comment">// replaced by innerHTML/textContent retains its parentNode property</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>elm<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    elm<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>elm<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_23-vue-父子组件生命周期调用顺序"><a href="#_23-vue-父子组件生命周期调用顺序" class="header-anchor">#</a> 23. Vue 父子组件生命周期调用顺序</h2> <h3 id="理解-16"><a href="#理解-16" class="header-anchor">#</a> 理解:</h3> <p>组件的调用顺序都是先父后子，渲染完成的顺序肯定是先子后父</p> <p>组件的销毁操作是先父后子，销毁完成的顺序是先子后父</p> <h3 id="原理-14"><a href="#原理-14" class="header-anchor">#</a> 原理:</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">patch</span> <span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> hydrating<span class="token punctuation">,</span> removeOnly</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">invokeDestroyHook</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> isInitialPatch <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">const</span> insertedVnodeQueue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 定义收集所有组件的insert hook方法的数组</span>
    <span class="token comment">// somthing ...</span>
    <span class="token function">createElm</span><span class="token punctuation">(</span>
        vnode<span class="token punctuation">,</span>
        insertedVnodeQueue<span class="token punctuation">,</span>
        oldElm<span class="token punctuation">.</span>_leaveCb <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> parentElm<span class="token punctuation">,</span>
        nodeOps<span class="token punctuation">.</span><span class="token function">nextSibling</span><span class="token punctuation">(</span>oldElm<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token comment">// somthing...</span>
    <span class="token comment">// 最终会依次调用收集的insert hook</span>
    <span class="token function">invokeInsertHook</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> isInitialPatch<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> vnode<span class="token punctuation">.</span>elm
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">createElm</span> <span class="token punctuation">(</span>
    <span class="token parameter">vnode<span class="token punctuation">,</span>
    insertedVnodeQueue<span class="token punctuation">,</span>
    parentElm<span class="token punctuation">,</span>
    refElm<span class="token punctuation">,</span>
    nested<span class="token punctuation">,</span>
    ownerArray<span class="token punctuation">,</span>
    index</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// createChildren会递归创建儿子组件</span>
        <span class="token function">createChildren</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> children<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>
        <span class="token comment">// something...</span>
  <span class="token punctuation">}</span>

<span class="token comment">// 将组件的vnode插入到数组中</span>
<span class="token keyword">function</span> <span class="token function">invokeCreateHooks</span> <span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> insertedVnodeQueue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>create<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cbs<span class="token punctuation">.</span>create<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>emptyNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    i <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>hook <span class="token comment">// Reuse variable</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>create<span class="token punctuation">)</span><span class="token punctuation">)</span> i<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>emptyNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>insert<span class="token punctuation">)</span><span class="token punctuation">)</span> insertedVnodeQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token comment">// insert方法中会依次调用mounted方法</span>
<span class="token function">insert</span> <span class="token punctuation">(</span><span class="token parameter">vnode<span class="token operator">:</span> MountedComponentVNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> context<span class="token punctuation">,</span> componentInstance <span class="token punctuation">}</span> <span class="token operator">=</span> vnode
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>componentInstance<span class="token punctuation">.</span>_isMounted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      componentInstance<span class="token punctuation">.</span>_isMounted <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token function">callHook</span><span class="token punctuation">(</span>componentInstance<span class="token punctuation">,</span> <span class="token string">'mounted'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">invokeInsertHook</span> <span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> queue<span class="token punctuation">,</span> initial</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// delay insert hooks for component root nodes, invoke them after the</span>
     <span class="token comment">// element is really inserted</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>initial<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>parent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         vnode<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>data<span class="token punctuation">.</span>pendingInsert <span class="token operator">=</span> queue
     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> queue<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
             queue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>queue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用insert方法</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$destroy</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'beforeDestroy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//</span>
  <span class="token comment">// invoke destroy hooks on current rendered tree</span>
  vm<span class="token punctuation">.</span><span class="token function">__patch__</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_vnode<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 先销毁儿子</span>
  <span class="token comment">// fire destroyed hook</span>
  <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'destroyed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_24-vue-组件如何通信"><a href="#_24-vue-组件如何通信" class="header-anchor">#</a> 24.Vue 组件如何通信?</h2> <ul><li>父子间通信 <strong>父-&gt;子通过 <code>props</code></strong>、<strong>子-&gt;父<code>$on、$emit</code></strong></li> <li>获取父子组件实例的方式<code>$parent、$children</code></li> <li>在父组件中提供数据子组件进行消费 <code>Provide、inject</code></li> <li><code>Ref</code> 获取实例的方式调用组件的属性或者方法</li> <li><code>Event Bus</code> 实现跨组件通信</li> <li><code>Vuex</code> 状态管理实现通信</li></ul> <h2 id="_25-vue-中相同逻辑如何抽离？"><a href="#_25-vue-中相同逻辑如何抽离？" class="header-anchor">#</a> 25.Vue 中相同逻辑如何抽离？</h2> <ul><li><code>Vue.mixin</code>用法 给组件每个生命周期，函数等都混入一些公共逻辑</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function-variable function">mixin</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">mixin<span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">,</span> mixin<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将当前定义的属性合并到每个组件中</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span><span class="token parameter">parent<span class="token operator">:</span> Object<span class="token punctuation">,</span> child<span class="token operator">:</span> Object<span class="token punctuation">,</span> vm<span class="token operator">?</span><span class="token operator">:</span> Component</span><span class="token punctuation">)</span><span class="token operator">:</span> Object <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>child<span class="token punctuation">.</span>_base<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>extends<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 递归合并extends</span>
      parent <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> child<span class="token punctuation">.</span>extends<span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>mixins<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 递归合并mixin</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> child<span class="token punctuation">.</span>mixins<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        parent <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> child<span class="token punctuation">.</span>mixins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 属性及生命周期的合并</span>
  <span class="token keyword">let</span> key<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">mergeField</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> child<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">mergeField</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">mergeField</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> strat <span class="token operator">=</span> strats<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">||</span> defaultStrat<span class="token punctuation">;</span>
    <span class="token comment">// 调用不同属性合并策略进行合并</span>
    options<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">strat</span><span class="token punctuation">(</span>parent<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> child<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> vm<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> options<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_26-为什么要使用异步组件？"><a href="#_26-为什么要使用异步组件？" class="header-anchor">#</a> 26.为什么要使用异步组件？</h2> <h3 id="理解-17"><a href="#理解-17" class="header-anchor">#</a> 理解:</h3> <p>如果组件功能多打包出的结果会变大，我们可以采用<strong>异步</strong>的方式来加载组件。主要依赖 <code>import()</code> 这个语法，可以实现<strong>文件的分割加载</strong>。</p> <div class="language-js extra-class"><pre class="language-js"><code>components<span class="token operator">:</span><span class="token punctuation">{</span>
  <span class="token function">AddCustomerSchedule</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;../components/AddCustomer&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="原理-15"><a href="#原理-15" class="header-anchor">#</a> 原理:</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createComponent</span><span class="token punctuation">(</span>
  <span class="token parameter">Ctor<span class="token operator">:</span> Class<span class="token operator">&lt;</span>Component<span class="token operator">&gt;</span> <span class="token operator">|</span> Function <span class="token operator">|</span> Object <span class="token operator">|</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> <span class="token operator">?</span>VNodeData<span class="token punctuation">,</span>
  context<span class="token operator">:</span> Component<span class="token punctuation">,</span>
  children<span class="token operator">:</span> <span class="token operator">?</span>Array<span class="token operator">&lt;</span>VNode<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  tag<span class="token operator">?</span><span class="token operator">:</span> string</span>
<span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token operator">|</span> Array<span class="token operator">&lt;</span>VNode<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token comment">// async component</span>
  <span class="token keyword">let</span> asyncFactory<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>Ctor<span class="token punctuation">.</span>cid<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    asyncFactory <span class="token operator">=</span> Ctor<span class="token punctuation">;</span>
    Ctor <span class="token operator">=</span> <span class="token function">resolveAsyncComponent</span><span class="token punctuation">(</span>asyncFactory<span class="token punctuation">,</span> baseCtor<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 默认调用此函数时返回undefiend</span>
    <span class="token comment">// 第二次渲染时Ctor不为undefined</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Ctor <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">createAsyncPlaceholder</span><span class="token punctuation">(</span>
        <span class="token comment">// 渲染占位符 空虚拟节点</span>
        asyncFactory<span class="token punctuation">,</span>
        data<span class="token punctuation">,</span>
        context<span class="token punctuation">,</span>
        children<span class="token punctuation">,</span>
        tag
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">resolveAsyncComponent</span><span class="token punctuation">(</span>
  <span class="token parameter">factory<span class="token operator">:</span> Function<span class="token punctuation">,</span>
  baseCtor<span class="token operator">:</span> Class<span class="token operator">&lt;</span>Component<span class="token operator">&gt;</span></span>
<span class="token punctuation">)</span><span class="token operator">:</span> Class<span class="token operator">&lt;</span>Component<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>resolved<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 3.在次渲染时可以拿到获取的最新组件</span>
    <span class="token keyword">return</span> factory<span class="token punctuation">.</span>resolved<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> resolve <span class="token operator">=</span> <span class="token function">once</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token operator">:</span> Object <span class="token operator">|</span> Class<span class="token operator">&lt;</span>Component<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    factory<span class="token punctuation">.</span>resolved <span class="token operator">=</span> <span class="token function">ensureCtor</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> baseCtor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sync<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">forceRender</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2. 强制更新视图重新渲染</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      owners<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> reject <span class="token operator">=</span> <span class="token function">once</span><span class="token punctuation">(</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>errorComp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      factory<span class="token punctuation">.</span>error <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token function">forceRender</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1.将resolve方法和reject方法传入，用户调用resolve方法后</span>
  sync <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> factory<span class="token punctuation">.</span>resolved<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_27-什么是作用域插槽"><a href="#_27-什么是作用域插槽" class="header-anchor">#</a> 27.什么是作用域插槽?</h2> <p><img src="/blog/assets/img/slot.f961a505.png" alt="插槽"></p> <h3 id="理解-18"><a href="#理解-18" class="header-anchor">#</a> 理解:</h3> <h4 id="_1-插槽："><a href="#_1-插槽：" class="header-anchor">#</a> 1.插槽：</h4> <p>创建组件虚拟节点时，会将组件的儿子的虚拟节点保存起来。当初始化组件时,通过插槽属性将儿子进行分类 {a:[vnode],b[vnode]}
渲染组件时会拿对应的 <code>slot</code> 属性的节点进行<strong>替换</strong>操作。（<strong>插槽的作用域为父组件</strong>）</p> <h4 id="_2-作用域插槽"><a href="#_2-作用域插槽" class="header-anchor">#</a> 2.作用域插槽:</h4> <p>作用域插槽在解析的时候，不会作为组件的孩子节点。会解析成<strong>函数</strong>，当子组件渲染时，会调用此<strong>函数</strong>进行渲染。（<strong>插槽的作用域为子组件</strong>）</p> <h3 id="原理-16"><a href="#原理-16" class="header-anchor">#</a> 原理:</h3> <h4 id="_1-插槽"><a href="#_1-插槽" class="header-anchor">#</a> 1.插槽:</h4> <p>源码是这样的:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> VueTemplateCompiler <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-template-compiler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> ele <span class="token operator">=</span> VueTemplateCompiler<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;my-component&gt;
        &lt;div slot=&quot;header&quot;&gt;node&lt;/div&gt;
        &lt;div&gt;react&lt;/div&gt;
        &lt;div slot=&quot;footer&quot;&gt;vue&lt;/div&gt;
    &lt;/my-component&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/** 
with(this) {
    return _c('my-component', [_c('div', {
        attrs: {
            &quot;slot&quot;: &quot;header&quot;
        },
        slot: &quot;header&quot;
    }, [_v(&quot;node&quot;)]), _v(&quot; &quot;), _c('div', [_v(&quot;react&quot;)]), _v(&quot; &quot;), _c('div', {
        attrs: {
            &quot;slot&quot;: &quot;footer&quot;
        },
        slot: &quot;footer&quot;
    }, [_v(&quot;vue&quot;)])])
}
*/</span>

<span class="token keyword">const</span> VueTemplateCompiler <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-template-compiler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> ele <span class="token operator">=</span> VueTemplateCompiler<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;div&gt;
        &lt;slot name=&quot;header&quot;&gt;&lt;/slot&gt;
        &lt;slot name=&quot;footer&quot;&gt;&lt;/slot&gt;
        &lt;slot&gt;&lt;/slot&gt;
    &lt;/div&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/**
with(this) {
    return _c('div', [_t(&quot;header&quot;), _v(&quot; &quot;), _t(&quot;footer&quot;), _v(&quot; &quot;), _t(&quot;default&quot;)], 2)
}
**/</span>
<span class="token comment">// _t定义在 core/instance/render-helpers/index.js</span>
</code></pre></div><h3 id="作用域插槽"><a href="#作用域插槽" class="header-anchor">#</a> 作用域插槽:</h3> <p>对应的源码是这样的</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> ele <span class="token operator">=</span> VueTemplateCompiler<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;app&gt;
        &lt;div slot-scope=&quot;msg&quot; slot=&quot;footer&quot;&gt;{{msg.a}}&lt;/div&gt;
    &lt;/app&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/**
with(this) {
    return _c('app', {
        scopedSlots: _u([{ // 作用域插槽的内容会被渲染成一个函数
            key: &quot;footer&quot;,
            fn: function (msg) {
                return _c('div', {}, [_v(_s(msg.a))])
            }
        }])
    })
    }
}
*/</span>
<span class="token keyword">const</span> VueTemplateCompiler <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue-template-compiler'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

VueTemplateCompiler<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;div&gt;
        &lt;slot name=&quot;footer&quot; a=&quot;1&quot; b=&quot;2&quot;&gt;&lt;/slot&gt;
    &lt;/div&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/**
with(this) {
    return _c('div', [_t(&quot;footer&quot;, null, {
        &quot;a&quot;: &quot;1&quot;,
        &quot;b&quot;: &quot;2&quot;
    })], 2)
}
**/</span>
</code></pre></div><h2 id="_28-谈谈你对-keep-alive-的了解？"><a href="#_28-谈谈你对-keep-alive-的了解？" class="header-anchor">#</a> 28.谈谈你对 keep-alive 的了解？</h2> <h3 id="理解-19"><a href="#理解-19" class="header-anchor">#</a> 理解:</h3> <p><code>keep-alive</code> 可以实现<strong>组件的缓存</strong>，当组件切换时不会对当前组件进行卸载,常用的 2 个属性 <code>include/exclude</code>,2 个生命周期 <code>activated,deactivated</code></p> <h3 id="原理-17"><a href="#原理-17" class="header-anchor">#</a> 原理:</h3> <blockquote><p>代码位置：core/components/keep-alive.js</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span>
  abstract<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 抽象组件</span>

  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    include<span class="token operator">:</span> patternTypes<span class="token punctuation">,</span>
    exclude<span class="token operator">:</span> patternTypes<span class="token punctuation">,</span>
    max<span class="token operator">:</span> <span class="token punctuation">[</span>String<span class="token punctuation">,</span> Number<span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cache <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建缓存列表</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 创建缓存组件的key列表</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">destroyed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// keep-alive销毁时 会清空所有的缓存和key</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 循环销毁</span>
      <span class="token function">pruneCacheEntry</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>keys<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 会监控include 和 include属性 进行组件的缓存处理</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span><span class="token string">'include'</span><span class="token punctuation">,</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">pruneCache</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token function">matches</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span><span class="token string">'exclude'</span><span class="token punctuation">,</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">pruneCache</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token function">matches</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> slot <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span>default<span class="token punctuation">;</span> <span class="token comment">// 会拿默认插槽</span>
    <span class="token keyword">const</span> vnode<span class="token operator">:</span> VNode <span class="token operator">=</span> <span class="token function">getFirstComponentChild</span><span class="token punctuation">(</span>slot<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 只缓存第一个组件</span>
    <span class="token keyword">const</span> componentOptions<span class="token operator">:</span> <span class="token operator">?</span>VNodeComponentOptions <span class="token operator">=</span> vnode <span class="token operator">&amp;&amp;</span> vnode<span class="token punctuation">.</span>componentOptions<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>componentOptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// check pattern</span>
      <span class="token keyword">const</span> name<span class="token operator">:</span> <span class="token operator">?</span>string <span class="token operator">=</span> <span class="token function">getComponentName</span><span class="token punctuation">(</span>componentOptions<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取出组件的名字</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> include<span class="token punctuation">,</span> exclude <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>
        <span class="token comment">// 判断是否缓存</span>
        <span class="token comment">// not included</span>
        <span class="token punctuation">(</span>include <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>name <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">matches</span><span class="token punctuation">(</span>include<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
        <span class="token comment">// excluded</span>
        <span class="token punctuation">(</span>exclude <span class="token operator">&amp;&amp;</span> name <span class="token operator">&amp;&amp;</span> <span class="token function">matches</span><span class="token punctuation">(</span>exclude<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> vnode<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">const</span> <span class="token punctuation">{</span> cache<span class="token punctuation">,</span> keys <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> key<span class="token operator">:</span> <span class="token operator">?</span>string <span class="token operator">=</span>
        vnode<span class="token punctuation">.</span>key <span class="token operator">==</span> <span class="token keyword">null</span>
          <span class="token operator">?</span> <span class="token comment">// same constructor may get registered as different local components</span>
            <span class="token comment">// so cid alone is not enough (#3269)</span>
            componentOptions<span class="token punctuation">.</span>Ctor<span class="token punctuation">.</span>cid <span class="token operator">+</span> <span class="token punctuation">(</span>componentOptions<span class="token punctuation">.</span>tag <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">::</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>componentOptions<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span>
          <span class="token operator">:</span> vnode<span class="token punctuation">.</span>key<span class="token punctuation">;</span> <span class="token comment">// 如果组件没key 就自己通过 组件的标签和key和cid 拼接一个key</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        vnode<span class="token punctuation">.</span>componentInstance <span class="token operator">=</span> cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>componentInstance<span class="token punctuation">;</span> <span class="token comment">//  直接拿到组件实例</span>
        <span class="token comment">// make current key freshest</span>
        <span class="token function">remove</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 删除当前的  [b,c,d,e,a]   // LRU 最近最久未使用法</span>
        keys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 并将key放到后面[b,a]</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> vnode<span class="token punctuation">;</span> <span class="token comment">// 缓存vnode</span>
        keys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将key 存入</span>
        <span class="token comment">// prune oldest entry</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>max <span class="token operator">&amp;&amp;</span> keys<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>max<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 缓存的太多超过了max 就需要删除掉</span>
          <span class="token function">pruneCacheEntry</span><span class="token punctuation">(</span>cache<span class="token punctuation">,</span> keys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> keys<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_vnode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 要删除第0个 但是现在渲染的就是第0个</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>keepAlive <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 并且标准keep-alive下的组件是一个缓存组件</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> vnode <span class="token operator">||</span> <span class="token punctuation">(</span>slot <span class="token operator">&amp;&amp;</span> slot<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回当前的虚拟节点</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_29-vue-中常见性能优化"><a href="#_29-vue-中常见性能优化" class="header-anchor">#</a> 29.Vue 中常见性能优化</h2> <h3 id="_1-编码优化"><a href="#_1-编码优化" class="header-anchor">#</a> 1.编码优化:</h3> <ul><li><p>1.不要将所有的数据都放在 <code>data</code> 中，<code>data</code> 中的数据都会增加 <code>getter</code> 和 <code>setter</code>，会收集对应的 <code>watcher</code></p></li> <li><p>2.<code>vue</code> 在 <code>v-for</code> 时给每项元素绑定事件需要用<strong>事件代理(事件委托)</strong></p></li> <li><p>3.<code>SPA</code> 页面采用 <code>keep-alive</code> 缓存组件</p></li> <li><p>4.拆分组件( 提高复用性、增加代码的可维护性,减少不必要的渲染 )</p></li> <li><p>5.<code>v-if</code> 当值为 false 时内部指令不会执行,具有<strong>阻断</strong>功能，很多情况下使用 <code>v-if</code> 替代 <code>v-show</code></p></li> <li><p>6.key 保证唯一性 ( 默认 vue 会采用就地复用策略 )</p></li> <li><p>7.<code>Object.freeze</code> 冻结数据</p></li> <li><p>8.合理使用<strong>路由懒加载</strong>、<strong>异步组件</strong></p></li> <li><p>9.尽量采用 <code>runtime</code> 运行时版本</p></li> <li><p>10.数据持久化的问题 （防抖、节流）</p></li></ul> <h3 id="_2-vue-加载性能优化"><a href="#_2-vue-加载性能优化" class="header-anchor">#</a> 2.Vue 加载性能优化:</h3> <ul><li><p>第三方模块按需导入 (<a href="https://www.npmjs.com/package/babel-plugin-component" target="_blank" rel="noopener noreferrer"><code>babel-plugin-component</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)</p></li> <li><p><a href="https://tangbc.github.io/vue-virtual-scroll-list" target="_blank" rel="noopener noreferrer">滚动到可视区域动态加载<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://github.com/hilongjw/vue-lazyload.git" target="_blank" rel="noopener noreferrer">图片懒加载<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul> <h3 id="_3-用户体验"><a href="#_3-用户体验" class="header-anchor">#</a> 3.用户体验:</h3> <ul><li><code>app-skeleton</code> 骨架屏</li> <li><code>app-shellapp</code> 壳</li> <li><code>pwa</code></li></ul> <h3 id="_4-seo-优化："><a href="#_4-seo-优化：" class="header-anchor">#</a> 4.SEO 优化：</h3> <ul><li>预渲染插件 <code>prerender-spa-plugin</code></li> <li>服务端渲染 <code>ssr</code></li></ul> <h3 id="_5-打包优化"><a href="#_5-打包优化" class="header-anchor">#</a> 5.打包优化:</h3> <ul><li>使用 <code>cdn</code> 的方式加载第三方模块</li> <li>多线程打包 <code>happypack</code></li> <li><code>splitChunks</code> 抽离公共文件</li> <li><code>sourceMap</code> 生成</li></ul> <h3 id="_6-缓存，压缩"><a href="#_6-缓存，压缩" class="header-anchor">#</a> 6.缓存，压缩</h3> <ul><li>客户端缓存、服务端缓存</li> <li>服务端 <code>gzip</code> 压缩</li></ul> <h2 id="_30-vue3-0-你知道有哪些改进"><a href="#_30-vue3-0-你知道有哪些改进" class="header-anchor">#</a> 30.<code>Vue3.0</code> 你知道有哪些改进?</h2> <ul><li><p><code>Vue3</code>采用了 <code>TS</code> 来编写</p></li> <li><p>支持 <code>Composition API</code></p></li> <li><p><code>Vue3</code>中响应式数据原理改成 <code>proxy</code></p></li> <li><p><code>vdom</code> 的对比算法更新，只更新 <code>vdom</code> 的绑定了<strong>动态数据</strong>的部分</p></li></ul> <h2 id="_31-实现-hash-路由和-history-路由"><a href="#_31-实现-hash-路由和-history-路由" class="header-anchor">#</a> 31.实现 <code>hash</code> 路由和 <code>history</code> 路由</h2> <ul><li><code>onhashchange</code></li> <li><code>history.pushState</code></li></ul> <h2 id="_32-vue-router中导航守卫有哪些？"><a href="#_32-vue-router中导航守卫有哪些？" class="header-anchor">#</a> 32.<code>Vue-Router</code>中导航守卫有哪些？</h2> <h3 id="完整的导航解析流程如下"><a href="#完整的导航解析流程如下" class="header-anchor">#</a> 完整的导航解析流程如下</h3> <ol><li>导航被触发。</li> <li>在失活的组件里调用离开守卫。</li> <li>调用全局的 <code>beforeEach</code> 守卫。</li> <li>在重用的组件里调用 <code>beforeRouteUpdate</code> 守卫 (2.2+)。</li> <li>在路由配置里调用 <code>beforeEnter。</code></li> <li>解析异步路由组件。</li> <li>在被激活的组件里调用 <code>beforeRouteEnter</code>。</li> <li>调用全局的 <code>beforeResolve</code> 守卫 (2.5+)。</li> <li>导航被确认。</li> <li>调用全局的 <code>afterEach</code> 钩子。</li> <li>触发 <code>DOM</code> 更新。</li> <li>用创建好的实例调用 <code>beforeRouteEnter</code> 守卫中传给 <code>next</code> 的回调函数。</li></ol> <h2 id="_33-action-和-mutation-区别"><a href="#_33-action-和-mutation-区别" class="header-anchor">#</a> 33.action 和 mutation 区别</h2> <ul><li>mutation 是<strong>同步</strong>操作更新数据(内部会进行是否为异步方式更新数据的检测)</li> <li>action <strong>异步</strong>操作，可以获取数据后调用<code>mutation</code>提交最终数据</li></ul> <h2 id="_34-简述-vuex-工作原理"><a href="#_34-简述-vuex-工作原理" class="header-anchor">#</a> 34.简述 Vuex 工作原理</h2> <p>直接上图吧！</p> <p><img src="https://vuex.vuejs.org/vuex.png" alt="vuex"></p> <h2 id="作业"><a href="#作业" class="header-anchor">#</a> 作业:</h2> <ul><li><p>1.双向绑定和 <code>vuex</code>是否冲突?</p></li> <li><p>2.<code>Vue</code>中内置组件 <code>transition</code>、<code>transition-group</code> 的源码实现原理？</p></li> <li><p>3.说说 <code>patch</code> 函数里做了啥?</p></li> <li><p>4.知道<code>vue</code>生命周期内部怎么实现的么 ?</p></li> <li><p>5.<code>ssr</code>项目如果并发很大服务器性能怎么优化?</p></li> <li><p>6.说下项目中怎么实现<strong>权限校验</strong>?</p></li> <li><p>7.讲 <code>vue-lazyloader</code> 的原理，手写伪代码?</p></li> <li><p>8.<code>Vue.set</code>的原理?</p></li> <li><p>9.<code>vue compile</code>过程详细说一下，指令、插值表达式等<code>vue</code>语法如何生效的?</p></li></ul> <h2 id="最后"><a href="#最后" class="header-anchor">#</a> 最后</h2> <p>文中若有不准确或错误的地方，欢迎指出，有兴趣可以的关注下<a href="https://github.com/GolderBrother" target="_blank" rel="noopener noreferrer">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，一起学习呀~</p> <div class="gitalk-container"><div id="gitalk-container"></div></div> <div class="gitalk-container"><div id="gitalk-container"></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2020/9/7 下午8:45:37</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/views/vue/vue-interview.html" class="prev">30 道 Vue 面试题，内含详细讲解（涵盖入门到精通，自测 Vue 掌握程度）</a></span> <span class="next"><a href="/blog/views/react/react-hooks.html">React Hooks 相关 API 总结</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.74817549.js" defer></script><script src="/blog/assets/js/2.f761193d.js" defer></script><script src="/blog/assets/js/9.4fbaf7a8.js" defer></script><script src="/blog/assets/js/23.dbb39e0a.js" defer></script>
  </body>
</html>
